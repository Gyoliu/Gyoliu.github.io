<?xml version="1.0"?>
<rss version="2.0">
    <channel>
        <title>Gyo • Posts by &#34;default&#34; tag</title>
        <link>https://gyoliu.github.io</link>
        <description>Gyo的博客</description>
        <language>en</language>
        <pubDate>Thu, 06 Mar 2025 16:29:54 +0800</pubDate>
        <lastBuildDate>Thu, 06 Mar 2025 16:29:54 +0800</lastBuildDate>
        <category>Cosy</category>
        <category>Linux</category>
        <category>Java</category>
        <category>Default</category>
        <category>PaddleSpeech</category>
        <category>elasticsearch</category>
        <category>hibernate</category>
        <category>JVM</category>
        <category>mysql</category>
        <category>证书</category>
        <category>nginx</category>
        <category>openssl</category>
        <category>Spring Cloud</category>
        <category>spring</category>
        <item>
            <guid isPermalink="true">https://gyoliu.github.io/2025/03/06/XtraBackup-mysql-backup/</guid>
            <title>XtraBackup mysql backup</title>
            <link>https://gyoliu.github.io/2025/03/06/XtraBackup-mysql-backup/</link>
            <category>Default</category>
            <pubDate>Thu, 06 Mar 2025 16:29:54 +0800</pubDate>
            <description><![CDATA[ &lt;h1 id=&#34;1-安装-Percona-XtraBackup&#34;&gt;&lt;a href=&#34;#1-安装-Percona-XtraBackup&#34; class=&#34;headerlink&#34; title=&#34;1. 安装 Percona XtraBackup&#34;&gt;&lt;/a&gt;1. 安装 Percona XtraBackup&lt;/h1&gt;&lt;pre class=&#34;line-numbers language-bash&#34; data-language=&#34;bash&#34;&gt;&lt;code class=&#34;language-bash&#34;&gt;&lt;span class=&#34;token comment&#34;&gt;# Ubuntu/Debian&lt;/span&gt;
&lt;span class=&#34;token function&#34;&gt;wget&lt;/span&gt; https://repo.percona.com/apt/percona-release_latest.&lt;span class=&#34;token variable&#34;&gt;&lt;span class=&#34;token variable&#34;&gt;$(&lt;/span&gt;lsb_release &lt;span class=&#34;token parameter variable&#34;&gt;-sc&lt;/span&gt;&lt;span class=&#34;token variable&#34;&gt;)&lt;/span&gt;&lt;/span&gt;_all.deb
&lt;span class=&#34;token function&#34;&gt;sudo&lt;/span&gt; dpkg &lt;span class=&#34;token parameter variable&#34;&gt;-i&lt;/span&gt; percona-release_latest.&lt;span class=&#34;token variable&#34;&gt;&lt;span class=&#34;token variable&#34;&gt;$(&lt;/span&gt;lsb_release &lt;span class=&#34;token parameter variable&#34;&gt;-sc&lt;/span&gt;&lt;span class=&#34;token variable&#34;&gt;)&lt;/span&gt;&lt;/span&gt;_all.deb
&lt;span class=&#34;token function&#34;&gt;sudo&lt;/span&gt; &lt;span class=&#34;token function&#34;&gt;apt&lt;/span&gt; update
&lt;span class=&#34;token function&#34;&gt;sudo&lt;/span&gt; &lt;span class=&#34;token function&#34;&gt;apt&lt;/span&gt; &lt;span class=&#34;token function&#34;&gt;install&lt;/span&gt; percona-xtrabackup-80

&lt;span class=&#34;token comment&#34;&gt;# CentOS/RHEL&lt;/span&gt;
&lt;span class=&#34;token function&#34;&gt;sudo&lt;/span&gt; yum &lt;span class=&#34;token function&#34;&gt;install&lt;/span&gt; https://repo.percona.com/yum/percona-release-latest.noarch.rpm
&lt;span class=&#34;token function&#34;&gt;sudo&lt;/span&gt; yum &lt;span class=&#34;token function&#34;&gt;install&lt;/span&gt; percona-xtrabackup-80&lt;span aria-hidden=&#34;true&#34; class=&#34;line-numbers-rows&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;2-全量备份（Full-Backup）&#34;&gt;&lt;a href=&#34;#2-全量备份（Full-Backup）&#34; class=&#34;headerlink&#34; title=&#34;2. 全量备份（Full Backup）&#34;&gt;&lt;/a&gt;2. 全量备份（Full Backup）&lt;/h1&gt;&lt;pre class=&#34;line-numbers language-bash&#34; data-language=&#34;bash&#34;&gt;&lt;code class=&#34;language-bash&#34;&gt;&lt;span class=&#34;token comment&#34;&gt;# 创建备份目录&lt;/span&gt;
&lt;span class=&#34;token function&#34;&gt;mkdir&lt;/span&gt; &lt;span class=&#34;token parameter variable&#34;&gt;-p&lt;/span&gt; /backup/mysql/full/&lt;span class=&#34;token variable&#34;&gt;&lt;span class=&#34;token variable&#34;&gt;$(&lt;/span&gt;&lt;span class=&#34;token function&#34;&gt;date&lt;/span&gt; +%Y%m%d&lt;span class=&#34;token variable&#34;&gt;)&lt;/span&gt;&lt;/span&gt;

&lt;span class=&#34;token comment&#34;&gt;# 执行全量备份（无锁表）&lt;/span&gt;
xtrabackup &lt;span class=&#34;token parameter variable&#34;&gt;--backup&lt;/span&gt; &lt;span class=&#34;token parameter variable&#34;&gt;--user&lt;/span&gt;&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;root &lt;span class=&#34;token parameter variable&#34;&gt;--password&lt;/span&gt;&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;YourPassword --target-dir&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;/backup/mysql/full/&lt;span class=&#34;token variable&#34;&gt;&lt;span class=&#34;token variable&#34;&gt;$(&lt;/span&gt;&lt;span class=&#34;token function&#34;&gt;date&lt;/span&gt; +%Y%m%d&lt;span class=&#34;token variable&#34;&gt;)&lt;/span&gt;&lt;/span&gt;

&lt;span class=&#34;token comment&#34;&gt;# 压缩并上传至云存储（示例使用 AWS S3）&lt;/span&gt;
&lt;span class=&#34;token function&#34;&gt;tar&lt;/span&gt; &lt;span class=&#34;token parameter variable&#34;&gt;-czf&lt;/span&gt; /backup/mysql/full/&lt;span class=&#34;token variable&#34;&gt;&lt;span class=&#34;token variable&#34;&gt;$(&lt;/span&gt;&lt;span class=&#34;token function&#34;&gt;date&lt;/span&gt; +%Y%m%d&lt;span class=&#34;token variable&#34;&gt;)&lt;/span&gt;&lt;/span&gt;.tar.gz /backup/mysql/full/&lt;span class=&#34;token variable&#34;&gt;&lt;span class=&#34;token variable&#34;&gt;$(&lt;/span&gt;&lt;span class=&#34;token function&#34;&gt;date&lt;/span&gt; +%Y%m%d&lt;span class=&#34;token variable&#34;&gt;)&lt;/span&gt;&lt;/span&gt;
aws s3 &lt;span class=&#34;token function&#34;&gt;cp&lt;/span&gt; /backup/mysql/full/&lt;span class=&#34;token variable&#34;&gt;&lt;span class=&#34;token variable&#34;&gt;$(&lt;/span&gt;&lt;span class=&#34;token function&#34;&gt;date&lt;/span&gt; +%Y%m%d&lt;span class=&#34;token variable&#34;&gt;)&lt;/span&gt;&lt;/span&gt;.tar.gz s3://your-bucket/mysql-backup/full/&lt;span aria-hidden=&#34;true&#34; class=&#34;line-numbers-rows&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;3-增量备份（Incremental-Backup）&#34;&gt;&lt;a href=&#34;#3-增量备份（Incremental-Backup）&#34; class=&#34;headerlink&#34; title=&#34;3. 增量备份（Incremental Backup）&#34;&gt;&lt;/a&gt;3. 增量备份（Incremental Backup）&lt;/h1&gt;&lt;pre class=&#34;line-numbers language-bash&#34; data-language=&#34;bash&#34;&gt;&lt;code class=&#34;language-bash&#34;&gt;&lt;span class=&#34;token comment&#34;&gt;# 假设最后一次全量备份路径：/backup/mysql/full/20231001&lt;/span&gt;
&lt;span class=&#34;token comment&#34;&gt;# 创建增量备份目录&lt;/span&gt;
&lt;span class=&#34;token function&#34;&gt;mkdir&lt;/span&gt; &lt;span class=&#34;token parameter variable&#34;&gt;-p&lt;/span&gt; /backup/mysql/inc/&lt;span class=&#34;token variable&#34;&gt;&lt;span class=&#34;token variable&#34;&gt;$(&lt;/span&gt;&lt;span class=&#34;token function&#34;&gt;date&lt;/span&gt; +%Y%m%d&lt;span class=&#34;token variable&#34;&gt;)&lt;/span&gt;&lt;/span&gt;

&lt;span class=&#34;token comment&#34;&gt;# 基于全量或上一次增量备份执行增量备份&lt;/span&gt;
xtrabackup &lt;span class=&#34;token parameter variable&#34;&gt;--backup&lt;/span&gt; &lt;span class=&#34;token punctuation&#34;&gt;\&lt;/span&gt;
  &lt;span class=&#34;token parameter variable&#34;&gt;--user&lt;/span&gt;&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;root &lt;span class=&#34;token parameter variable&#34;&gt;--password&lt;/span&gt;&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;YourPassword &lt;span class=&#34;token punctuation&#34;&gt;\&lt;/span&gt;
  --target-dir&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;/backup/mysql/inc/&lt;span class=&#34;token variable&#34;&gt;&lt;span class=&#34;token variable&#34;&gt;$(&lt;/span&gt;&lt;span class=&#34;token function&#34;&gt;date&lt;/span&gt; +%Y%m%d&lt;span class=&#34;token variable&#34;&gt;)&lt;/span&gt;&lt;/span&gt; &lt;span class=&#34;token punctuation&#34;&gt;\&lt;/span&gt;
  --incremental-basedir&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;/backup/mysql/full/20231001  &lt;span class=&#34;token comment&#34;&gt;# 或上一次增量目录&lt;/span&gt;
&lt;span aria-hidden=&#34;true&#34; class=&#34;line-numbers-rows&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;

&lt;h1 id=&#34;1-恢复全量备份&#34;&gt;&lt;a href=&#34;#1-恢复全量备份&#34; class=&#34;headerlink&#34; title=&#34;1. 恢复全量备份&#34;&gt;&lt;/a&gt;1. 恢复全量备份&lt;/h1&gt;&lt;pre class=&#34;line-numbers language-bash&#34; data-language=&#34;bash&#34;&gt;&lt;code class=&#34;language-bash&#34;&gt;&lt;span class=&#34;token comment&#34;&gt;# 停止 MySQL 服务&lt;/span&gt;
systemctl stop mysql

&lt;span class=&#34;token comment&#34;&gt;# 清空数据目录（谨慎操作！）&lt;/span&gt;
&lt;span class=&#34;token function&#34;&gt;rm&lt;/span&gt; &lt;span class=&#34;token parameter variable&#34;&gt;-rf&lt;/span&gt; /var/lib/mysql/*

&lt;span class=&#34;token comment&#34;&gt;# 准备全量备份&lt;/span&gt;
xtrabackup &lt;span class=&#34;token parameter variable&#34;&gt;--prepare&lt;/span&gt; --apply-log-only --target-dir&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;/backup/mysql/full/20231001

&lt;span class=&#34;token comment&#34;&gt;# 复制数据文件到 MySQL 目录&lt;/span&gt;
xtrabackup --copy-back --target-dir&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;/backup/mysql/full/20231001

&lt;span class=&#34;token comment&#34;&gt;# 修改权限并启动 MySQL&lt;/span&gt;
&lt;span class=&#34;token function&#34;&gt;chown&lt;/span&gt; &lt;span class=&#34;token parameter variable&#34;&gt;-R&lt;/span&gt; mysql:mysql /var/lib/mysql
systemctl start mysql&lt;span aria-hidden=&#34;true&#34; class=&#34;line-numbers-rows&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;

&lt;h1 id=&#34;2-应用增量备份&#34;&gt;&lt;a href=&#34;#2-应用增量备份&#34; class=&#34;headerlink&#34; title=&#34;2. 应用增量备份&#34;&gt;&lt;/a&gt;2. 应用增量备份&lt;/h1&gt;&lt;pre class=&#34;line-numbers language-bash&#34; data-language=&#34;bash&#34;&gt;&lt;code class=&#34;language-bash&#34;&gt;&lt;span class=&#34;token comment&#34;&gt;# 准备全量备份（必须步骤）&lt;/span&gt;
xtrabackup &lt;span class=&#34;token parameter variable&#34;&gt;--prepare&lt;/span&gt; --apply-log-only --target-dir&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;/backup/mysql/full/20231001

&lt;span class=&#34;token comment&#34;&gt;# 应用第一个增量备份&lt;/span&gt;
xtrabackup &lt;span class=&#34;token parameter variable&#34;&gt;--prepare&lt;/span&gt; --apply-log-only &lt;span class=&#34;token punctuation&#34;&gt;\&lt;/span&gt;
  --target-dir&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;/backup/mysql/full/20231001 &lt;span class=&#34;token punctuation&#34;&gt;\&lt;/span&gt;
  --incremental-dir&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;/backup/mysql/inc/20231002

&lt;span class=&#34;token comment&#34;&gt;# 应用后续增量备份（按时间顺序）&lt;/span&gt;
xtrabackup &lt;span class=&#34;token parameter variable&#34;&gt;--prepare&lt;/span&gt; --apply-log-only &lt;span class=&#34;token punctuation&#34;&gt;\&lt;/span&gt;
  --target-dir&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;/backup/mysql/full/20231001 &lt;span class=&#34;token punctuation&#34;&gt;\&lt;/span&gt;
  --incremental-dir&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;/backup/mysql/inc/20231003

&lt;span class=&#34;token comment&#34;&gt;# 最后准备（确保一致性）&lt;/span&gt;
xtrabackup &lt;span class=&#34;token parameter variable&#34;&gt;--prepare&lt;/span&gt; --target-dir&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;/backup/mysql/full/20231001

&lt;span class=&#34;token comment&#34;&gt;# 复制数据并启动 MySQL（同上）&lt;/span&gt;&lt;span aria-hidden=&#34;true&#34; class=&#34;line-numbers-rows&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;

&lt;h1 id=&#34;3-通过-Binlog-恢复至最新状态&#34;&gt;&lt;a href=&#34;#3-通过-Binlog-恢复至最新状态&#34; class=&#34;headerlink&#34; title=&#34;3. 通过 Binlog 恢复至最新状态&#34;&gt;&lt;/a&gt;3. 通过 Binlog 恢复至最新状态&lt;/h1&gt;&lt;pre class=&#34;line-numbers language-bash&#34; data-language=&#34;bash&#34;&gt;&lt;code class=&#34;language-bash&#34;&gt;&lt;span class=&#34;token comment&#34;&gt;# 解析增量备份后的 Binlog 位置&lt;/span&gt;
&lt;span class=&#34;token function&#34;&gt;cat&lt;/span&gt; /backup/mysql/full/20231001/xtrabackup_binlog_info
&lt;span class=&#34;token comment&#34;&gt;# 输出示例：mysql-bin.000007 154&lt;/span&gt;

&lt;span class=&#34;token comment&#34;&gt;# 使用 mysqlbinlog 导出 SQL（从指定位置到故障时间点）&lt;/span&gt;
mysqlbinlog --start-position&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;token number&#34;&gt;154&lt;/span&gt; /var/lib/mysql/mysql-bin.000007 &lt;span class=&#34;token punctuation&#34;&gt;..&lt;/span&gt;. &lt;span class=&#34;token operator&#34;&gt;|&lt;/span&gt; mysql &lt;span class=&#34;token parameter variable&#34;&gt;-u&lt;/span&gt; root &lt;span class=&#34;token parameter variable&#34;&gt;-p&lt;/span&gt;&lt;span aria-hidden=&#34;true&#34; class=&#34;line-numbers-rows&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;1-备份脚本示例（mysql-backup-sh）&#34;&gt;&lt;a href=&#34;#1-备份脚本示例（mysql-backup-sh）&#34; class=&#34;headerlink&#34; title=&#34;1. 备份脚本示例（mysql_backup.sh）&#34;&gt;&lt;/a&gt;1. 备份脚本示例（mysql_backup.sh）&lt;/h1&gt;&lt;pre class=&#34;line-numbers language-bash&#34; data-language=&#34;bash&#34;&gt;&lt;code class=&#34;language-bash&#34;&gt;&lt;span class=&#34;token shebang important&#34;&gt;#!/bin/bash&lt;/span&gt;
&lt;span class=&#34;token comment&#34;&gt;# 全量备份（每周日执行）&lt;/span&gt;
&lt;span class=&#34;token keyword&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;token punctuation&#34;&gt;[&lt;/span&gt; &lt;span class=&#34;token variable&#34;&gt;&lt;span class=&#34;token variable&#34;&gt;$(&lt;/span&gt;&lt;span class=&#34;token function&#34;&gt;date&lt;/span&gt; +%u&lt;span class=&#34;token variable&#34;&gt;)&lt;/span&gt;&lt;/span&gt; &lt;span class=&#34;token parameter variable&#34;&gt;-eq&lt;/span&gt; &lt;span class=&#34;token number&#34;&gt;7&lt;/span&gt; &lt;span class=&#34;token punctuation&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;token keyword&#34;&gt;then&lt;/span&gt;
  &lt;span class=&#34;token assign-left variable&#34;&gt;BACKUP_DIR&lt;/span&gt;&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;token string&#34;&gt;&#34;/backup/mysql/full/&lt;span class=&#34;token variable&#34;&gt;&lt;span class=&#34;token variable&#34;&gt;$(&lt;/span&gt;&lt;span class=&#34;token function&#34;&gt;date&lt;/span&gt; +%Y%m%d&lt;span class=&#34;token variable&#34;&gt;)&lt;/span&gt;&lt;/span&gt;&#34;&lt;/span&gt;
  &lt;span class=&#34;token function&#34;&gt;mkdir&lt;/span&gt; &lt;span class=&#34;token parameter variable&#34;&gt;-p&lt;/span&gt; &lt;span class=&#34;token variable&#34;&gt;$BACKUP_DIR&lt;/span&gt;
  xtrabackup &lt;span class=&#34;token parameter variable&#34;&gt;--backup&lt;/span&gt; &lt;span class=&#34;token parameter variable&#34;&gt;--user&lt;/span&gt;&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;root &lt;span class=&#34;token parameter variable&#34;&gt;--password&lt;/span&gt;&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;YourPassword --target-dir&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;token variable&#34;&gt;$BACKUP_DIR&lt;/span&gt;
  &lt;span class=&#34;token function&#34;&gt;tar&lt;/span&gt; &lt;span class=&#34;token parameter variable&#34;&gt;-czf&lt;/span&gt; &lt;span class=&#34;token variable&#34;&gt;$BACKUP_DIR&lt;/span&gt;.tar.gz &lt;span class=&#34;token variable&#34;&gt;$BACKUP_DIR&lt;/span&gt;
  aws s3 &lt;span class=&#34;token function&#34;&gt;cp&lt;/span&gt; &lt;span class=&#34;token variable&#34;&gt;$BACKUP_DIR&lt;/span&gt;.tar.gz s3://your-bucket/mysql-backup/full/
&lt;span class=&#34;token comment&#34;&gt;# 增量备份（其他日期）&lt;/span&gt;
&lt;span class=&#34;token keyword&#34;&gt;else&lt;/span&gt;
  &lt;span class=&#34;token assign-left variable&#34;&gt;LAST_FULL&lt;/span&gt;&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;token variable&#34;&gt;&lt;span class=&#34;token variable&#34;&gt;$(&lt;/span&gt;&lt;span class=&#34;token function&#34;&gt;ls&lt;/span&gt; &lt;span class=&#34;token parameter variable&#34;&gt;-d&lt;/span&gt; /backup/mysql/full/* &lt;span class=&#34;token operator&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;token function&#34;&gt;sort&lt;/span&gt; &lt;span class=&#34;token operator&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;token function&#34;&gt;tail&lt;/span&gt; &lt;span class=&#34;token parameter variable&#34;&gt;-1&lt;/span&gt;&lt;span class=&#34;token variable&#34;&gt;)&lt;/span&gt;&lt;/span&gt;
  &lt;span class=&#34;token assign-left variable&#34;&gt;BACKUP_DIR&lt;/span&gt;&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;token string&#34;&gt;&#34;/backup/mysql/inc/&lt;span class=&#34;token variable&#34;&gt;&lt;span class=&#34;token variable&#34;&gt;$(&lt;/span&gt;&lt;span class=&#34;token function&#34;&gt;date&lt;/span&gt; +%Y%m%d&lt;span class=&#34;token variable&#34;&gt;)&lt;/span&gt;&lt;/span&gt;&#34;&lt;/span&gt;
  &lt;span class=&#34;token function&#34;&gt;mkdir&lt;/span&gt; &lt;span class=&#34;token parameter variable&#34;&gt;-p&lt;/span&gt; &lt;span class=&#34;token variable&#34;&gt;$BACKUP_DIR&lt;/span&gt;
  xtrabackup &lt;span class=&#34;token parameter variable&#34;&gt;--backup&lt;/span&gt; &lt;span class=&#34;token parameter variable&#34;&gt;--user&lt;/span&gt;&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;root &lt;span class=&#34;token parameter variable&#34;&gt;--password&lt;/span&gt;&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;YourPassword --target-dir&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;token variable&#34;&gt;$BACKUP_DIR&lt;/span&gt; --incremental-basedir&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;token variable&#34;&gt;$LAST_FULL&lt;/span&gt;
  &lt;span class=&#34;token function&#34;&gt;tar&lt;/span&gt; &lt;span class=&#34;token parameter variable&#34;&gt;-czf&lt;/span&gt; &lt;span class=&#34;token variable&#34;&gt;$BACKUP_DIR&lt;/span&gt;.tar.gz &lt;span class=&#34;token variable&#34;&gt;$BACKUP_DIR&lt;/span&gt;
  aws s3 &lt;span class=&#34;token function&#34;&gt;cp&lt;/span&gt; &lt;span class=&#34;token variable&#34;&gt;$BACKUP_DIR&lt;/span&gt;.tar.gz s3://your-bucket/mysql-backup/inc/
&lt;span class=&#34;token keyword&#34;&gt;fi&lt;/span&gt;

&lt;span class=&#34;token comment&#34;&gt;# 清理旧备份（保留策略）&lt;/span&gt;
&lt;span class=&#34;token function&#34;&gt;find&lt;/span&gt; /backup/mysql/full/ &lt;span class=&#34;token parameter variable&#34;&gt;-type&lt;/span&gt; d &lt;span class=&#34;token parameter variable&#34;&gt;-mtime&lt;/span&gt; +30 &lt;span class=&#34;token parameter variable&#34;&gt;-exec&lt;/span&gt; &lt;span class=&#34;token function&#34;&gt;rm&lt;/span&gt; &lt;span class=&#34;token parameter variable&#34;&gt;-rf&lt;/span&gt; &lt;span class=&#34;token punctuation&#34;&gt;&amp;#123;&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;&amp;#125;&lt;/span&gt; &lt;span class=&#34;token punctuation&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;token function&#34;&gt;find&lt;/span&gt; /backup/mysql/inc/ &lt;span class=&#34;token parameter variable&#34;&gt;-type&lt;/span&gt; d &lt;span class=&#34;token parameter variable&#34;&gt;-mtime&lt;/span&gt; +7 &lt;span class=&#34;token parameter variable&#34;&gt;-exec&lt;/span&gt; &lt;span class=&#34;token function&#34;&gt;rm&lt;/span&gt; &lt;span class=&#34;token parameter variable&#34;&gt;-rf&lt;/span&gt; &lt;span class=&#34;token punctuation&#34;&gt;&amp;#123;&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;&amp;#125;&lt;/span&gt; &lt;span class=&#34;token punctuation&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;;&lt;/span&gt;


&lt;span class=&#34;token comment&#34;&gt;# 编辑 crontab&lt;/span&gt;
&lt;span class=&#34;token function&#34;&gt;crontab&lt;/span&gt; &lt;span class=&#34;token parameter variable&#34;&gt;-e&lt;/span&gt;

&lt;span class=&#34;token comment&#34;&gt;# 添加以下内容（每天凌晨3点执行）&lt;/span&gt;
&lt;span class=&#34;token number&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;token number&#34;&gt;3&lt;/span&gt; * * * /path/to/mysql_backup.sh&lt;span aria-hidden=&#34;true&#34; class=&#34;line-numbers-rows&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;


&lt;h1 id=&#34;命令参数&#34;&gt;&lt;a href=&#34;#命令参数&#34; class=&#34;headerlink&#34; title=&#34;命令参数&#34;&gt;&lt;/a&gt;命令参数&lt;/h1&gt;&lt;pre class=&#34;line-numbers language-bash&#34; data-language=&#34;bash&#34;&gt;&lt;code class=&#34;language-bash&#34;&gt;
&lt;span class=&#34;token parameter variable&#34;&gt;--backup&lt;/span&gt; 模式，用于在目标目录中进行备份
&lt;span class=&#34;token parameter variable&#34;&gt;--prepare&lt;/span&gt; 模式，用于从备份中恢复数据（在--backup模式下创建）
--copy-back 模式，用于从备份中复制数据到原始数据所在的位置；若要移动数据而不是复制，请使用替代的--move-back模式。
&lt;span class=&#34;token parameter variable&#34;&gt;--stats&lt;/span&gt; 模式，用于扫描指定的数据文件并打印出索引统计信息。

xtrabackup &lt;span class=&#34;token punctuation&#34;&gt;[&lt;/span&gt;--defaults-file&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;token comment&#34;&gt;#] --backup|--prepare|--copy-back|--stats [OPTIONS]&lt;/span&gt;
xtrabackup &lt;span class=&#34;token parameter variable&#34;&gt;--prepare&lt;/span&gt; --target-dir&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;/data/backup/mysql/


参数值                                参数用途
–print-defaults             输出mysql实例的参数配置信息
–no-defaults                不从任何配置文件中读取参数信息，除了登录文件
–defaults-file&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;token comment&#34;&gt;#            仅从指定的配置文件读取参数&lt;/span&gt;
–defaults-extra-file&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;token comment&#34;&gt;#      读取额外的配置信息文件&lt;/span&gt;
–defaults-group-suffix&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;token comment&#34;&gt;#    Also read groups with concat(group, suffix)&lt;/span&gt;
–login-path&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;token comment&#34;&gt;#               读取登录文件的路径&lt;/span&gt;
-v, &lt;span class=&#34;token parameter variable&#34;&gt;--version&lt;/span&gt;               打印 xtrabackup版本信息
–target-dir&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;name            备份文件的目录，默认为当前目录xtrabackup_backupfiles/
–backup                     备份操作,备份到target-dir指定的目录
–stats                      计算datadir的统计信息&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;推荐mysqld离线&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt; calc statistic of datadir &lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;offline mysqld is recommended&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;
–prepare                    指定备份的准备阶段 （准备一个在备份上启动mysql服务器的备份。）
–export                     当在prepare阶段创建文件到另外的一个数据库 create files to &lt;span class=&#34;token function&#34;&gt;import&lt;/span&gt; to another database when prepare.
–apply-log-only             一般情况下,在备份完成后，数据尚且不能用于恢复操作，因为备份的数据中可能会包含尚未提交的事务或已经提交但尚未同步至数据文件中的事务。
                            因此，此时数据 文件仍处理不一致状态。
–apply-log                  它的作用是通过回滚未提交的事务及同步已经提交的事务至数据文件使数据文件处于一致性状态。
–print-param                输出mysqld copyback必须的参数  print parameter of mysqld needed &lt;span class=&#34;token keyword&#34;&gt;for&lt;/span&gt; copyback.
–use-memory&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;                备份的时候指定的内存，该选项表示和–apply-log选项一起使用，
                            prepare 备份的时候，xtrabackup做crash recovery分配的内存大小，单位字节。也可&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;1MB,1M,1G,1GB&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;，推荐1G。用于替代buffer_pool_size
–throttle&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;token comment&#34;&gt;#                 和–backup一起使用，指定每秒操作读写对的数量。&lt;/span&gt;
–log&lt;span class=&#34;token punctuation&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;name&lt;span class=&#34;token punctuation&#34;&gt;]&lt;/span&gt;                 忽略MySQL选项兼容性的选项
–log-copy-interval&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;token comment&#34;&gt;#        日志复制线程完成的检查之间的时间间隔（以毫秒为单位,默认为1秒）。&lt;/span&gt;
–extra-lsndir&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;name          和–backup一起使用,在当前目录保存一份额外的xtrabackup_checkpoints文件
–to-archived-lsn&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;token comment&#34;&gt;#          指定prepare备份时apply事务日志的LSN，只能和xtarbackup --prepare选项一起用。&lt;/span&gt;
–tables&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;name                通过正则表达式过滤表
–tables-file&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;name           按文件中的精确的database.table名称列表进行筛选。
–databases&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;name             按照数据库进行过滤
–databases-file&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;name        按照文件中的数据进行过滤
–tables-exclude&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;name        操作方式和–tables一样，但是匹配的表名将不备份，此参数的优先级高于–tables.
–databases-exclude&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;name     操作方式和–databases一样，但是匹配的库名将不被备份，优先级高于–databases.
–create-ib-logfile          此参数当前不生效，无效参数
–stream&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;name                该选项表示流式备份的格式，backup完成之后以指定格式到STDOUT，目前只支持tar&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;token number&#34;&gt;8.0&lt;/span&gt;版本仅支持&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;和xbstream
–decompress                 该选项表示解压–compress选项压缩的文件，解压.qp扩展文件。
–compress&lt;span class=&#34;token punctuation&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;name&lt;span class=&#34;token punctuation&#34;&gt;]&lt;/span&gt;            压缩所有输出数据，包括事务日志文件和元数据文件，通过指定的压缩算法，
                            目前唯一支持的算法是quicklz.结果文件是qpress归档格式，
                            每个xtrabackup创建的*.qp文件都可以通过qpress程序提取或者解压缩
–compress-threads&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;          &lt;span class=&#34;token comment&#34;&gt;# 备份压缩的并行线程，默认为1.并行压缩（‘compress-threads’）可以和并行文件拷贝(‘parallel’)一起使用。&lt;/span&gt;
                            例如:’–parallel&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;token number&#34;&gt;4&lt;/span&gt; &lt;span class=&#34;token parameter variable&#34;&gt;--compress&lt;/span&gt; --compress-threads&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;token number&#34;&gt;2&lt;/span&gt;’会创建4个IO线程读取数据并通过管道传送给2个压缩线程。
–compress-chunk-size&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;token comment&#34;&gt;#      压缩线程工作buffer的字节大小，默认是64K&lt;/span&gt;
–encrypt&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;name               该选项表示通过ENCRYPTION_ALGORITHM的算法加密innodb数据文件的备份，
                            目前支持的算法有ASE128,AES192,AES256。
–encrypt-key&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;name           该选项使用合适长度加密key，因为会记录到命令行，所以不推荐使用。
–encrypt-key-file&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;name      该选项表示文件必须是一个简单二进制或者文本文件，加密key可通过以下命令行命令生成：openssl rand &lt;span class=&#34;token parameter variable&#34;&gt;-base64&lt;/span&gt; &lt;span class=&#34;token number&#34;&gt;24&lt;/span&gt;。
–encrypt-threads&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;token comment&#34;&gt;#          该选项表示并行加密的worker线程数量，默认为1.&lt;/span&gt;
–encrypt-chunk-size&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;token comment&#34;&gt;#       该选项表示每个加密线程worker buffer的大小，单位是字节，默认是64K。&lt;/span&gt;
–decrypt&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;name               该选项表示解密通过–encrypt选项加密的.xbcrypt文件。
–remove-original            当删除解密和解压完后删除 .qp and .xbcrypt 文件
–rebuild_indexes            在apply事务日志之后重建innodb辅助索引，只有和–prepare一起才生效。
–rebuild_threads&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;token comment&#34;&gt;#          在紧凑备份重建辅助索引的线程数，只有和–prepare和rebuild-index一起才生效。&lt;/span&gt;
–close-files                该选项表示关闭不再访问的文件句柄，当xtrabackup打开表空间通常并不关闭文件句柄目的是正确的处理DDL操作。
                            如果表空间数量巨大，这是一种可以关闭不再访问的文件句柄的方法。使用该选项有风险，会有产生不一致备份的可能。
–core-file                  Write core on fatal signals
–copy-back                  做数据恢复时将备份数据文件拷贝到MySQL服务器的datadir。
–move-back                  这个选项与–copy-back相似，唯一的区别是它不拷贝文件，而是移动文件到目的地。
                            这个选项移除backup文件，用时候必须小心。使用场景：没有足够的磁盘空间同事保留数据文件和Backup副本
                            注意：
                            &lt;span class=&#34;token number&#34;&gt;1&lt;/span&gt;.datadir目录必须为空。除非指定innobackupex --force-non-empty-directorires选项指定，否则–copy-backup选项不会覆盖
                            &lt;span class=&#34;token number&#34;&gt;2&lt;/span&gt;.在restore之前,必须shutdown MySQL实例，你不能将一个运行中的实例restore到datadir目录中
                            &lt;span class=&#34;token number&#34;&gt;3&lt;/span&gt;.由于文件属性会被保留，大部分情况下你需要在启动实例之前将文件的属主改为mysql，这些文件将属于创建备份的用户

–galera-info                该选项表示生成了包含创建备份时候本地节点状态的文件xtrabackup_galera_info文件，该选项只适用于备份PXC。
–slave-info                 该选项表示对slave进行备份的时候使用，打印出master的名字和binlog pos，
                            同样将这些信息以change master的命令写入xtrabackup_slave_info文件。可以通过基于这份备份启动一个从库。
–no-lock                    该选项表示关闭FTWRL的表锁，只有在所有表都是Innodb表并且不关心backup的binlog pos点，
                            如果有任何DDL语句正在执行或者非InnoDB正在更新时（包括mysql库下的表），都不应该使用这个选项，
                            后果是导致备份数据不一致，如果考虑备份因为获得锁失败，可以考虑–safe-slave-backup立刻停止复制线程。
–lock-ddl                   若mysql serve支持在备份支持发出LOCK TABLES FOR BACKUP指令阻止所有的DDL操作。
–lock-ddl-timeout&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;          &lt;span class=&#34;token comment&#34;&gt;#若在指定时间内未返回值则终止备份。&lt;/span&gt;
–lock-ddl-per-table         在xtrabackup开始复制之前锁定每个表的DDL直到备份完成
–safe-slave-backup          该选项表示为保证一致性复制状态，这个选项停止SQL线程并且等到show status中的slave_open_temp_tables为0的时候开始备份，
                            如果没有打开临时表，bakcup会立刻开始，否则SQL线程启动或者关闭知道没有打开的临时表。
–safe-slave-backup-timeout  如果slave_open_temp_tables在–safe-slave-backup-timeount（默认300秒）秒之后不为0，从库sql线程会在备份完成的时候重启。
–rsync                      该选项表示通过rsync工具优化本地传输，当指定这个选项，innobackupex使用rsync拷贝非Innodb文件而替换cp，当有很多DB和表的时候会快很多，不能–stream一起使用。
–force-non-empty-directories指定该参数时候，使得 --copy-back或–move-back选项转移文件到非空目录，已存在的文件不会被覆盖。如果–copy-back和–move-back文件需要从备份目录拷贝一个在datadir已经存在的文件，会报错失败。
–no-version-check           该选项关闭版本检查，当–version-check选项开启的时候。
–tables-compatibility-check 此选项开启表存储引擎兼容性告警，默认开启。可使用–skip-tables-compatibility-check关闭。
–no-backup-locks            该选项在backup阶段控制锁，替换FLUSH TABLES WITH READ LOCK命令。默认开启，关闭需使用参数–no-backup-locks。
                            当mysql服务器不支持backup locks时候此参数无效。
-u, &lt;span class=&#34;token parameter variable&#34;&gt;--user&lt;/span&gt;&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;name             备份的用户名
-H, &lt;span class=&#34;token parameter variable&#34;&gt;--host&lt;/span&gt;&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;name             备份的IP地址
-P, &lt;span class=&#34;token parameter variable&#34;&gt;--port&lt;/span&gt;&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;token comment&#34;&gt;#                备份的端口&lt;/span&gt;
-p, --password&lt;span class=&#34;token punctuation&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;name&lt;span class=&#34;token punctuation&#34;&gt;]&lt;/span&gt;       备份时用户的密码
-S, &lt;span class=&#34;token parameter variable&#34;&gt;--socket&lt;/span&gt;&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;name           备份时连接的unix操作系统的socket文件
-h, &lt;span class=&#34;token parameter variable&#34;&gt;--datadir&lt;/span&gt;&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;name          数据恢复时候的数据目录.从my.cnf中读取，或者命令行指定。
-t, &lt;span class=&#34;token parameter variable&#34;&gt;--tmpdir&lt;/span&gt;&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;name           当使用–print-param指定的时候打印出正确的tmpdir参数。用于存储临时文件的路径，在轮训模式下可以指定多个路径，使用英文的:分隔
–parallel&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;                  指定备份时拷贝多个数据文件并发的进程数，默认值为1。
–log-bin&lt;span class=&#34;token punctuation&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;name&lt;span class=&#34;token punctuation&#34;&gt;]&lt;/span&gt;             binlog的日志序列
–incremental-lsn&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;name       和–backup一起使用。
–incremental-basedir&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;name   和–backup一起使用，仅拷贝.ibd中新增的数据到指定路径，增量备份.
–incremental-dir&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;name       和–prepare一起使用，将.delta文件和logfile保存在指定的路径.
–incremental-force-scan     该选项表示创建一份增量备份时，强制扫描所有增量备份中的数据页
–incremental-history-name   该选项表示存储在PERCONA_SCHEMA.xtrabackup_history基于增量备份的历史记录的名字。
                            Percona Xtrabackup搜索历史表查找最近（innodb_to_lsn）成功备份并且将to_lsn值作为增量备份启动出事lsn.
                            与innobackupex–incremental-history-uuid、–incremental-basedir、–incremental-lsn互斥。
                            如果没有检测到有效的lsn，xtrabackup会返回error。
                            和选项–incremental一起使用。
                            –incremental-history-uuid   该选项表示存储在percona_schema.xtrabackup_history基于增量备份的特定历史记录的UUID。
                            和选项–incremental一起使用。
innobackupex遗留参数
​
参数值                                        参数用途
–ftwrl-wait-query-type  该选项表示获得全局锁之前允许那种查询完成，默认是ALL，可选update。
–ftwrl-wait-threshold   该选项表示检测到长查询，单位是秒，表示长查询的阈值。
                        若–ftwrl-wait-timeout&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;token number&#34;&gt;0&lt;/span&gt;此参数无效，默认值为60s。
–ftwrl-wait-timeout&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;token comment&#34;&gt;#   此选项指定innobackupex在运行之前应等待阻止FTWRL的查询的时间（以秒为单位）。&lt;/span&gt;
                        如果超时到期时仍有此类查询，则innobackupex将终止并显示错误。
                        默认值为0，在这种情况下，innobackupex不会等待查询完成并立即启动FTWRL。
–kill-long-queries-timeout  该选项表示从开始执行FLUSH TABLES WITH READ LOCK到kill掉阻塞它的这些查询之间等待的秒数。默认值为0，不会kill任何查询，使用这个选项xtrabackup需要有Process和super权限。
–kill-long-query-type       该选项表示kill的类型，默认是all，可选select。
–history                    该选项表示percona server 的备份历史记录在percona_schema.xtrabackup_history表。
–debug-sleep-before-unlock  仅用于xtrabackup测试套件的debug信息
–check-privileges           在执行查询之前检查数据库用户的权限。

安全备份的参数
​
参数值                               参数用途
–server-public-key-path&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;name    File path to the server public RSA key &lt;span class=&#34;token keyword&#34;&gt;in&lt;/span&gt; PEM format.
–server-public-key-path&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;name    File path to the server public RSA key &lt;span class=&#34;token keyword&#34;&gt;in&lt;/span&gt; PEM format.
–get-server-public-key  Get server public key
–ssl-mode&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;name  SSL connection mode.
–ssl-ca&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;name    CA &lt;span class=&#34;token function&#34;&gt;file&lt;/span&gt; &lt;span class=&#34;token keyword&#34;&gt;in&lt;/span&gt; PEM format.
–ssl-capath&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;name    CA directory.
–ssl-cert&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;name  X509 cert &lt;span class=&#34;token keyword&#34;&gt;in&lt;/span&gt; PEM format.
–ssl-cipher&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;name    SSL cipher to use.
–ssl-key&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;name   X509 key &lt;span class=&#34;token keyword&#34;&gt;in&lt;/span&gt; PEM &lt;span class=&#34;token function&#34;&gt;format&lt;/span&gt;
–ssl-crl&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;name   Certificate revocation list.
–ssl-crlpath&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;name   Certificate revocation list path.
–tls-version&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;name   TLS version to use, permitted values are: TLSv1, TLSv1.1,TLSv1.2
–ssl-fips-mode&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;name SL FIPS mode to use, permitted values are: OFF, ON,STRICT&lt;span aria-hidden=&#34;true&#34; class=&#34;line-numbers-rows&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt; ]]></description>
        </item>
        <item>
            <guid isPermalink="true">https://gyoliu.github.io/2024/12/26/follow/</guid>
            <title>follow</title>
            <link>https://gyoliu.github.io/2024/12/26/follow/</link>
            <category>Default</category>
            <pubDate>Thu, 26 Dec 2024 14:41:29 +0800</pubDate>
            <description><![CDATA[ &lt;blockquote&gt;
&lt;p&gt;This message is used to verify that this feed (feedId:94993712362846208) belongs to me (userId:569moaUVDrYGrgssS2Lwv). Join me in enjoying the next generation information browser &lt;a href=&#34;https://follow.is/&#34;&gt;https://follow.is&lt;/a&gt;.&lt;/p&gt;
&lt;/blockquote&gt;
 ]]></description>
        </item>
        <item>
            <guid isPermalink="true">https://gyoliu.github.io/2024/08/29/nginx-proxy/</guid>
            <title>nginx 正向代理配置 https 支持</title>
            <link>https://gyoliu.github.io/2024/08/29/nginx-proxy/</link>
            <category>Default</category>
            <category>nginx</category>
            <pubDate>Thu, 29 Aug 2024 13:23:54 +0800</pubDate>
            <description><![CDATA[ &lt;h1 id=&#34;nginx-正向代理配置-https-支持&#34;&gt;&lt;a href=&#34;#nginx-正向代理配置-https-支持&#34; class=&#34;headerlink&#34; title=&#34;nginx 正向代理配置 https 支持&#34;&gt;&lt;/a&gt;nginx 正向代理配置 https 支持&lt;/h1&gt;&lt;pre class=&#34;line-numbers language-bash&#34; data-language=&#34;bash&#34;&gt;&lt;code class=&#34;language-bash&#34;&gt; -- 遇到很多需要的包安装下来就好

yum &lt;span class=&#34;token parameter variable&#34;&gt;-y&lt;/span&gt; &lt;span class=&#34;token function&#34;&gt;install&lt;/span&gt; perl perl-ExtUtils-Embed gperftools geoip-devel

&lt;span class=&#34;token function&#34;&gt;wget&lt;/span&gt; https://github.com/chobits/ngx_http_proxy_connect_module/archive/refs/heads/master.zip
&lt;span class=&#34;token function&#34;&gt;unzip&lt;/span&gt; master.zip
&lt;span class=&#34;token function&#34;&gt;wget&lt;/span&gt; https://nginx.org/download/nginx-1.20.2.tar.gz
&lt;span class=&#34;token function&#34;&gt;tar&lt;/span&gt; xzvf nginx-1.20.2.tar.gz

&lt;span class=&#34;token builtin class-name&#34;&gt;cd&lt;/span&gt; nginx-1.20.2

patch &lt;span class=&#34;token parameter variable&#34;&gt;-p1&lt;/span&gt; &lt;span class=&#34;token operator&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;token punctuation&#34;&gt;..&lt;/span&gt;/ngx_http_proxy_connect_module_master/patch/proxy_connect_rewrite_1018.patch

./configure &lt;span class=&#34;token parameter variable&#34;&gt;--prefix&lt;/span&gt;&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;/usr/share/nginx --sbin-path&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;/usr/sbin/nginx --modules-path&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;/usr/lib64/nginx/modules --conf-path&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;/etc/nginx/nginx.conf --error-log-path&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;/var/log/nginx/error.log --http-log-path&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;/var/log/nginx/access.log --http-client-body-temp-path&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;/var/lib/nginx/tmp/client_body --http-proxy-temp-path&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;/var/lib/nginx/tmp/proxy --http-fastcgi-temp-path&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;/var/lib/nginx/tmp/fastcgi --http-uwsgi-temp-path&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;/var/lib/nginx/tmp/uwsgi --http-scgi-temp-path&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;/var/lib/nginx/tmp/scgi --pid-path&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;/run/nginx.pid --lock-path&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;/run/lock/subsys/nginx &lt;span class=&#34;token parameter variable&#34;&gt;--user&lt;/span&gt;&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;nginx &lt;span class=&#34;token parameter variable&#34;&gt;--group&lt;/span&gt;&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;nginx --with-compat --with-debug --with-file-aio --with-google_perftools_module --with-http_addition_module --with-http_auth_request_module --with-http_dav_module --with-http_degradation_module --with-http_flv_module --with-http_gunzip_module --with-http_gzip_static_module --with-http_image_filter_module&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;dynamic --with-http_mp4_module --with-http_perl_module&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;dynamic --with-http_random_index_module --with-http_realip_module --with-http_secure_link_module --with-http_slice_module --add-module&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;..&lt;/span&gt;/ngx_http_proxy_connect_module-master --with-http_ssl_module --with-http_stub_status_module --with-http_sub_module --with-http_v2_module --with-http_xslt_module&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;dynamic --with-mail&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;dynamic --with-mail_ssl_module --with-pcre --with-pcre-jit --with-stream&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;dynamic --with-stream_ssl_module --with-stream_ssl_preread_module --with-threads

&lt;span class=&#34;token function&#34;&gt;make&lt;/span&gt; &lt;span class=&#34;token operator&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&#34;token function&#34;&gt;make&lt;/span&gt; &lt;span class=&#34;token function&#34;&gt;install&lt;/span&gt;

systemctl restart nginx

-- 测试代理
&lt;span class=&#34;token function&#34;&gt;curl&lt;/span&gt; &lt;span class=&#34;token parameter variable&#34;&gt;-x&lt;/span&gt; &lt;span class=&#34;token number&#34;&gt;117.72&lt;/span&gt;.44.94:81 https://www.qq.com --proxy-insecure &lt;span class=&#34;token parameter variable&#34;&gt;-v&lt;/span&gt;&lt;span aria-hidden=&#34;true&#34; class=&#34;line-numbers-rows&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;

&lt;h1 id=&#34;nginx-配置&#34;&gt;&lt;a href=&#34;#nginx-配置&#34; class=&#34;headerlink&#34; title=&#34;nginx 配置&#34;&gt;&lt;/a&gt;nginx 配置&lt;/h1&gt;&lt;pre class=&#34;line-numbers language-none&#34;&gt;&lt;code class=&#34;language-none&#34;&gt;server &amp;#123;
        listen                         81;

        # dns resolver used by forward proxying
        resolver                       8.8.8.8;

        # forward proxy for CONNECT requests
        proxy_connect;
        proxy_connect_allow            all;
        proxy_connect_connect_timeout  100s;
        proxy_connect_data_timeout     100s;

        # defined by yourself for non-CONNECT requests
        # Example: reverse proxy for non-CONNECT requests

        location &amp;#x2F; &amp;#123;
            proxy_pass http:&amp;#x2F;&amp;#x2F;$http_host$request_uri;
            proxy_set_header Host $http_host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        &amp;#125;

    &amp;#125;

server &amp;#123;
        listen 443 default;
        # self signed certificate generated via openssl command
        ssl_certificate_key            &amp;#x2F;root&amp;#x2F;ssl&amp;#x2F;server.key;
        ssl_certificate                &amp;#x2F;root&amp;#x2F;ssl&amp;#x2F;server.crt;
        ssl_session_cache              shared:SSL:1m;

        # dns resolver used by forward proxying
        resolver                       8.8.8.8 8.8.4.4;

        # forward proxy for CONNECT request
        proxy_connect;
        proxy_connect_allow            all;
        proxy_connect_connect_timeout  100s;
        proxy_connect_data_timeout     100s;

        # defined by yourself for non-CONNECT request
        # Example: reverse proxy for non-CONNECT requests
        location &amp;#x2F; &amp;#123;
            proxy_pass http:&amp;#x2F;&amp;#x2F;$http_host$request_uri;
            proxy_set_header Host $http_host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        &amp;#125;
&amp;#125;&lt;span aria-hidden=&#34;true&#34; class=&#34;line-numbers-rows&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
 ]]></description>
        </item>
        <item>
            <guid isPermalink="true">https://gyoliu.github.io/2024/07/29/PaddleSpeech/</guid>
            <title>基于百度飞浆平台语音识别PaddleSpeech</title>
            <link>https://gyoliu.github.io/2024/07/29/PaddleSpeech/</link>
            <category>Default</category>
            <category>PaddleSpeech</category>
            <pubDate>Mon, 29 Jul 2024 13:20:51 +0800</pubDate>
            <description><![CDATA[ &lt;h1 id=&#34;PaddleSpeech-是基于飞桨-PaddlePaddle-的语音方向的开源模型库&#34;&gt;&lt;a href=&#34;#PaddleSpeech-是基于飞桨-PaddlePaddle-的语音方向的开源模型库&#34; class=&#34;headerlink&#34; title=&#34;PaddleSpeech 是基于飞桨 PaddlePaddle 的语音方向的开源模型库&#34;&gt;&lt;/a&gt;&lt;strong&gt;PaddleSpeech&lt;/strong&gt; 是基于飞桨 &lt;a href=&#34;https://gitee.com/link?target=https://github.com/PaddlePaddle/Paddle&#34;&gt;PaddlePaddle&lt;/a&gt; 的语音方向的开源模型库&lt;/h1&gt;&lt;p&gt;&lt;a href=&#34;https://github.com/PaddlePaddle/PaddleSpeech&#34;&gt;https://github.com/PaddlePaddle/PaddleSpeech&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&#34;文本介绍-Docker-部署方式&#34;&gt;&lt;a href=&#34;#文本介绍-Docker-部署方式&#34; class=&#34;headerlink&#34; title=&#34;文本介绍 Docker 部署方式&#34;&gt;&lt;/a&gt;文本介绍 Docker 部署方式&lt;/h2&gt;&lt;p&gt;依赖环境介绍,docker 环境就不用担心这些：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;gcc &amp;gt;&amp;#x3D; 4.8.5&lt;/li&gt;
&lt;li&gt;paddlepaddle &amp;lt;&amp;#x3D; 2.5.1 桨桨 &amp;lt;&amp;#x3D; 2.5.1&lt;/li&gt;
&lt;li&gt;python &amp;gt;&amp;#x3D; 3.8 &lt;br&gt;自 2024 年 6 月以来 Docker Hub 访问不了，国内开源厂商镜像如清华等都宣布下架。&lt;/li&gt;
&lt;/ul&gt;
&lt;pre class=&#34;line-numbers language-bash&#34; data-language=&#34;bash&#34;&gt;&lt;code class=&#34;language-bash&#34;&gt;// 设置 &lt;span class=&#34;token function&#34;&gt;docker&lt;/span&gt; mirrors
&lt;span class=&#34;token function&#34;&gt;sudo&lt;/span&gt; &lt;span class=&#34;token function&#34;&gt;vim&lt;/span&gt;  /etc/docker/daemon.json
&lt;span class=&#34;token punctuation&#34;&gt;&amp;#123;&lt;/span&gt;
    &lt;span class=&#34;token string&#34;&gt;&#34;registry-mirrors&#34;&lt;/span&gt;&lt;span class=&#34;token builtin class-name&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;token punctuation&#34;&gt;[&lt;/span&gt;
        &lt;span class=&#34;token string&#34;&gt;&#34;https://registry.docker-cn.com&#34;&lt;/span&gt;,
        &lt;span class=&#34;token string&#34;&gt;&#34;https://docker.mirrors.ustc.edu.cn&#34;&lt;/span&gt;,
        &lt;span class=&#34;token string&#34;&gt;&#34;https://hub-mirror.c.163.com&#34;&lt;/span&gt;,
        &lt;span class=&#34;token string&#34;&gt;&#34;https://mirror.baidubce.com&#34;&lt;/span&gt;,
        &lt;span class=&#34;token string&#34;&gt;&#34;https://ccr.ccs.tencentyun.com&#34;&lt;/span&gt;,
        &lt;span class=&#34;token string&#34;&gt;&#34;https://dockerhub.icu/&#34;&lt;/span&gt;
    &lt;span class=&#34;token punctuation&#34;&gt;]&lt;/span&gt;
&lt;span class=&#34;token punctuation&#34;&gt;&amp;#125;&lt;/span&gt;
&lt;span class=&#34;token comment&#34;&gt;# GPU版本&lt;/span&gt;
&lt;span class=&#34;token function&#34;&gt;docker&lt;/span&gt; pull paddlecloud/paddlespeech:develop-gpu-cuda10.2-cudnn7-latest
&lt;span class=&#34;token comment&#34;&gt;# CPU版本&lt;/span&gt;
&lt;span class=&#34;token function&#34;&gt;docker&lt;/span&gt; pull paddlecloud/paddlespeech:develop-cpu-latest
&lt;span class=&#34;token comment&#34;&gt;# 或者使用 docker search paddlespeech 搜索相关的镜像版本&lt;/span&gt;
&lt;span class=&#34;token comment&#34;&gt;# 启动服务&lt;/span&gt;
&lt;span class=&#34;token function&#34;&gt;docker&lt;/span&gt; run &lt;span class=&#34;token parameter variable&#34;&gt;--name&lt;/span&gt; dev &lt;span class=&#34;token parameter variable&#34;&gt;-v&lt;/span&gt; &lt;span class=&#34;token environment constant&#34;&gt;$PWD&lt;/span&gt;:/mnt &lt;span class=&#34;token parameter variable&#34;&gt;-p&lt;/span&gt; &lt;span class=&#34;token number&#34;&gt;8888&lt;/span&gt;:8888 &lt;span class=&#34;token parameter variable&#34;&gt;-p&lt;/span&gt; &lt;span class=&#34;token number&#34;&gt;8090&lt;/span&gt;:8090 &lt;span class=&#34;token parameter variable&#34;&gt;-it&lt;/span&gt; paddlecloud/paddlespeech:develop-cpu-latest  /bin/bash

&lt;span class=&#34;token comment&#34;&gt;# 自然语言处理工具库NLTK安装&lt;/span&gt;
&lt;span class=&#34;token function&#34;&gt;docker&lt;/span&gt; 镜像内的目录是 /root/nltk_data/
可以将下载好的传输到服务器上复制到这个目录下如：cp &lt;span class=&#34;token parameter variable&#34;&gt;-r&lt;/span&gt; /mnt/nltk_data-gh-pages/packages/ /root/nltk_data/
NLTK 数据下载： https://github.com/nltk/nltk_data/archive/refs/heads/gh-pages.zip&lt;span aria-hidden=&#34;true&#34; class=&#34;line-numbers-rows&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;

&lt;pre class=&#34;line-numbers language-bash&#34; data-language=&#34;bash&#34;&gt;&lt;code class=&#34;language-bash&#34;&gt;// 设置 python pip 
pip &lt;span class=&#34;token function&#34;&gt;install&lt;/span&gt; xxx &lt;span class=&#34;token parameter variable&#34;&gt;-i&lt;/span&gt; https://mirror.baidu.com/pypi/simple
or 
pip config &lt;span class=&#34;token builtin class-name&#34;&gt;set&lt;/span&gt; global.index-url https://pypi.tuna.tsinghua.edu.cn/simple&lt;span aria-hidden=&#34;true&#34; class=&#34;line-numbers-rows&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;测试数据下载：&lt;/p&gt;
&lt;pre class=&#34;line-numbers language-bash&#34; data-language=&#34;bash&#34;&gt;&lt;code class=&#34;language-bash&#34;&gt;&lt;span class=&#34;token function&#34;&gt;wget&lt;/span&gt; &lt;span class=&#34;token parameter variable&#34;&gt;-c&lt;/span&gt; https://paddlespeech.bj.bcebos.com/PaddleAudio/zh.wav
&lt;span class=&#34;token function&#34;&gt;wget&lt;/span&gt; &lt;span class=&#34;token parameter variable&#34;&gt;-c&lt;/span&gt; https://paddlespeech.bj.bcebos.com/PaddleAudio/en.wav&lt;span aria-hidden=&#34;true&#34; class=&#34;line-numbers-rows&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;启动 WEB 服务&lt;/p&gt;
&lt;pre class=&#34;line-numbers language-bash&#34; data-language=&#34;bash&#34;&gt;&lt;code class=&#34;language-bash&#34;&gt;paddlespeech_server start &lt;span class=&#34;token parameter variable&#34;&gt;--config_file&lt;/span&gt; ./demos/speech_server/conf/application.yaml&lt;span aria-hidden=&#34;true&#34; class=&#34;line-numbers-rows&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;识别语音命令：&lt;/p&gt;
&lt;pre class=&#34;line-numbers language-bash&#34; data-language=&#34;bash&#34;&gt;&lt;code class=&#34;language-bash&#34;&gt;paddlespeech asr &lt;span class=&#34;token parameter variable&#34;&gt;--lang&lt;/span&gt; zh &lt;span class=&#34;token parameter variable&#34;&gt;--input&lt;/span&gt; zh.wav&lt;span aria-hidden=&#34;true&#34; class=&#34;line-numbers-rows&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;文字转语音命令：&lt;/p&gt;
&lt;pre class=&#34;line-numbers language-bash&#34; data-language=&#34;bash&#34;&gt;&lt;code class=&#34;language-bash&#34;&gt;paddlespeech tts &lt;span class=&#34;token parameter variable&#34;&gt;--input&lt;/span&gt; &lt;span class=&#34;token string&#34;&gt;&#34;你好，欢迎使用百度飞桨深度学习框架！&#34;&lt;/span&gt; &lt;span class=&#34;token parameter variable&#34;&gt;--output&lt;/span&gt; output.wav&lt;span aria-hidden=&#34;true&#34; class=&#34;line-numbers-rows&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;其他命令请参考开源：&lt;br&gt;&lt;a href=&#34;https://github.com/PaddlePaddle/PaddleSpeech&#34;&gt;https://github.com/PaddlePaddle/PaddleSpeech&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;docker 命令回顾&lt;/p&gt;
&lt;pre class=&#34;line-numbers language-bash&#34; data-language=&#34;bash&#34;&gt;&lt;code class=&#34;language-bash&#34;&gt;&lt;span class=&#34;token comment&#34;&gt;# 查看正在运行的 docker hub&lt;/span&gt;
&lt;span class=&#34;token function&#34;&gt;docker&lt;/span&gt; &lt;span class=&#34;token function&#34;&gt;ps&lt;/span&gt; &lt;span class=&#34;token parameter variable&#34;&gt;-a&lt;/span&gt;
&lt;span class=&#34;token comment&#34;&gt;# 进入一个正在运行的 docker hub&lt;/span&gt;
&lt;span class=&#34;token function&#34;&gt;docker&lt;/span&gt; attach 36e3553f6bb3
or 
&lt;span class=&#34;token function&#34;&gt;docker&lt;/span&gt; run &lt;span class=&#34;token parameter variable&#34;&gt;-it&lt;/span&gt; xxx /bin/bash&lt;span aria-hidden=&#34;true&#34; class=&#34;line-numbers-rows&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
 ]]></description>
        </item>
        <item>
            <guid isPermalink="true">https://gyoliu.github.io/2024/07/08/nginx-config-https/</guid>
            <title>https 证书自动续期，永久免费</title>
            <link>https://gyoliu.github.io/2024/07/08/nginx-config-https/</link>
            <category>Default</category>
            <category>证书</category>
            <category>nginx</category>
            <pubDate>Mon, 08 Jul 2024 13:15:44 +0800</pubDate>
            <description><![CDATA[ &lt;h1 id=&#34;https-证书自动续期，永久免费&#34;&gt;&lt;a href=&#34;#https-证书自动续期，永久免费&#34; class=&#34;headerlink&#34; title=&#34;https 证书自动续期，永久免费&#34;&gt;&lt;/a&gt;https 证书自动续期，永久免费&lt;/h1&gt;&lt;blockquote&gt;
&lt;p&gt;开源组织的免费证书：&lt;a href=&#34;https://letsencrypt.org/zh-cn/&#34;&gt;https://letsencrypt.org/zh-cn/&lt;/a&gt;&lt;br&gt;Let’s Encrypt 和 &lt;a href=&#34;https://tools.ietf.org/html/rfc8555&#34;&gt;ACME 协议&lt;/a&gt;的目标是实现可信数字证书的自动获取，从而简化 HTTPS 服务器部署中的人工操作。 这一目标是由 Web 服务器上的证书管理软件完成的。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&#34;入门指南&#34;&gt;&lt;a href=&#34;#入门指南&#34; class=&#34;headerlink&#34; title=&#34;入门指南&#34;&gt;&lt;/a&gt;入门指南&lt;/h1&gt;&lt;blockquote&gt;
&lt;p&gt;为了在您的网站上启用 HTTPS，您需要从证书颁发机构（CA）获取证书（一种文件）。 Let’s Encrypt 正是其中一家证书颁发机构。 要从 Let’s Encrypt 获取您网站域名的证书，您必须证明您对域名的实际控制权。 这一过程通常由 Web 主机上运行的 &lt;a href=&#34;https://tools.ietf.org/html/rfc8555&#34;&gt;ACME 协议&lt;/a&gt;客户端完成。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;申请证书的最佳方式取决于您是否具备服务器的&lt;a href=&#34;https://en.wikipedia.org/wiki/Shell_account&#34;&gt;命令行访问权限&lt;/a&gt;（也称为 SSH 权限）。 如果您仅使用控制面板（例如 &lt;a href=&#34;https://cpanel.net/&#34;&gt;cPanel&lt;/a&gt;、&lt;a href=&#34;https://www.plesk.com/&#34;&gt;Plesk&lt;/a&gt; 或 &lt;a href=&#34;https://wordpress.org/&#34;&gt;WordPress&lt;/a&gt;）管理您的网站，您很有可能没有命令行访问权限。 您可以联系您的托管服务提供商确认。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&#34;拥有命令行访问权限&#34;&gt;&lt;a href=&#34;#拥有命令行访问权限&#34; class=&#34;headerlink&#34; title=&#34;拥有命令行访问权限&#34;&gt;&lt;/a&gt;拥有命令行访问权限&lt;/h1&gt;&lt;blockquote&gt;
&lt;p&gt;我们建议大多数具有命令行访问权限的人使用 &lt;a href=&#34;https://certbot.eff.org/&#34;&gt;Certbot&lt;/a&gt; ACME 客户端。 它可以在不下线您的服务器的前提下自动执行证书颁发和安装。 对于不需要自动配置的用户，Certbot 还提供专家模式。 它易于使用，适用于许多操作系统，并且具有出色的（注：英文）文档。 前往 &lt;a href=&#34;https://certbot.eff.org/&#34;&gt;Certbot 官网&lt;/a&gt;即可获取针对各类操作系统与服务器软件的使用说明。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;如果 &lt;a href=&#34;https://certbot.eff.org/&#34;&gt;Certbot&lt;/a&gt; 不能满足您的需求，或者您想尝试别的客户端，还有&lt;a href=&#34;https://letsencrypt.org/zh-cn/docs/client-options/&#34;&gt;更多 ACME 客户端&lt;/a&gt;可供选择。 选定 ACME 客户端软件后，请参阅该客户端的文档。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;如果您正在尝试不同的 ACME 客户端，请使用我们的&lt;a href=&#34;https://letsencrypt.org/zh-cn/docs/staging-environment/&#34;&gt;临时环境&lt;/a&gt;以避免遭到&lt;a href=&#34;https://letsencrypt.org/zh-cn/docs/rate-limits/&#34;&gt;速率限制&lt;/a&gt;。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&#34;实现了-ACME-协议的客户端，官方推荐如下：&#34;&gt;&lt;a href=&#34;#实现了-ACME-协议的客户端，官方推荐如下：&#34; class=&#34;headerlink&#34; title=&#34;实现了 ACME 协议的客户端，官方推荐如下：&#34;&gt;&lt;/a&gt;实现了 ACME 协议的客户端，官方推荐如下：&lt;/h1&gt;&lt;pre class=&#34;line-numbers language-none&#34;&gt;&lt;code class=&#34;language-none&#34;&gt;https:&amp;#x2F;&amp;#x2F;certbot.eff.org&amp;#x2F;instructions?ws&amp;#x3D;nginx&amp;amp;os&amp;#x3D;centosrhel7&amp;amp;tab&amp;#x3D;wildcard&lt;span aria-hidden=&#34;true&#34; class=&#34;line-numbers-rows&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;

&lt;h1 id=&#34;阿里云-Centos-7-实现如下：&#34;&gt;&lt;a href=&#34;#阿里云-Centos-7-实现如下：&#34; class=&#34;headerlink&#34; title=&#34;阿里云 Centos 7 实现如下：&#34;&gt;&lt;/a&gt;阿里云 Centos 7 实现如下：&lt;/h1&gt;&lt;pre class=&#34;line-numbers language-bash&#34; data-language=&#34;bash&#34;&gt;&lt;code class=&#34;language-bash&#34;&gt;必备条件：
&lt;span class=&#34;token number&#34;&gt;1&lt;/span&gt;. 安装阿里云 CLI 命令行工具，参考如下：
https://help.aliyun.com/zh/cli/install-cli-on-linux?spm&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;a2c4g.11186623.0.0.5fd7606ftkgvZH
&lt;span class=&#34;token number&#34;&gt;2&lt;/span&gt;. 安装证书生成 ACME 客户端 
yum &lt;span class=&#34;token function&#34;&gt;install&lt;/span&gt; epel-release &lt;span class=&#34;token parameter variable&#34;&gt;-y&lt;/span&gt;
yum &lt;span class=&#34;token function&#34;&gt;install&lt;/span&gt; certbot &lt;span class=&#34;token parameter variable&#34;&gt;-y&lt;/span&gt;
&lt;span class=&#34;token number&#34;&gt;3&lt;/span&gt;. certbot 文档
https://eff-certbot.readthedocs.io/en/latest/using.html&lt;span class=&#34;token comment&#34;&gt;#nginx&lt;/span&gt;
&lt;span class=&#34;token number&#34;&gt;4&lt;/span&gt;. 阿里云自动续期脚本
https://github.com/justjavac/certbot-dns-aliyun?tab&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;readme-ov-file
&lt;span class=&#34;token number&#34;&gt;5&lt;/span&gt;. 成功后如下输出证书保存的路径，之后将 nginx 的证书配置指向该证书
&lt;span class=&#34;token number&#34;&gt;6&lt;/span&gt;. 重要命令 - 申请证书
certbot certonly &lt;span class=&#34;token parameter variable&#34;&gt;-d&lt;/span&gt; *.example.com &lt;span class=&#34;token parameter variable&#34;&gt;--manual&lt;/span&gt; --preferred-challenges dns --manual-auth-hook &lt;span class=&#34;token string&#34;&gt;&#34;alidns&#34;&lt;/span&gt; --manual-cleanup-hook &lt;span class=&#34;token string&#34;&gt;&#34;alidns clean&#34;&lt;/span&gt;
&lt;span class=&#34;token number&#34;&gt;7&lt;/span&gt;. 重要命令 - 续期
certbot renew &lt;span class=&#34;token parameter variable&#34;&gt;--manual&lt;/span&gt; --preferred-challenges dns --manual-auth-hook &lt;span class=&#34;token string&#34;&gt;&#34;alidns&#34;&lt;/span&gt; --manual-cleanup-hook &lt;span class=&#34;token string&#34;&gt;&#34;alidns clean&#34;&lt;/span&gt;
&lt;span class=&#34;token number&#34;&gt;8&lt;/span&gt;. 重要命令 - 自动续期
&lt;span class=&#34;token function&#34;&gt;crontab&lt;/span&gt; &lt;span class=&#34;token parameter variable&#34;&gt;-e&lt;/span&gt;
&lt;span class=&#34;token number&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;token number&#34;&gt;1&lt;/span&gt; */1 * * root certbot renew &lt;span class=&#34;token parameter variable&#34;&gt;--manual&lt;/span&gt; --preferred-challenges dns --manual-auth-hook &lt;span class=&#34;token string&#34;&gt;&#34;alidns&#34;&lt;/span&gt; --manual-cleanup-hook &lt;span class=&#34;token string&#34;&gt;&#34;alidns clean&#34;&lt;/span&gt; --deploy-hook &lt;span class=&#34;token string&#34;&gt;&#34;nginx -s reload&#34;&lt;/span&gt;&lt;span aria-hidden=&#34;true&#34; class=&#34;line-numbers-rows&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;alidns脚本如下，作用动态添加阿里云-DNS-解析用来验证：&#34;&gt;&lt;a href=&#34;#alidns脚本如下，作用动态添加阿里云-DNS-解析用来验证：&#34; class=&#34;headerlink&#34; title=&#34;alidns脚本如下，作用动态添加阿里云 DNS 解析用来验证：&#34;&gt;&lt;/a&gt;alidns&lt;strong&gt;脚本如下，作用动态添加阿里云 DNS 解析用来验证：&lt;/strong&gt;&lt;/h1&gt;&lt;pre class=&#34;line-numbers language-bash&#34; data-language=&#34;bash&#34;&gt;&lt;code class=&#34;language-bash&#34;&gt;&lt;span class=&#34;token shebang important&#34;&gt;#!/bin/bash&lt;/span&gt;
&lt;span class=&#34;token assign-left variable&#34;&gt;FLAG&lt;/span&gt;&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;token string&#34;&gt;&#34;(\.com\.cn|\.gov\.cn|\.net\.cn|\.org\.cn|\.ac\.cn|\.gd\.cn)$&#34;&lt;/span&gt;

&lt;span class=&#34;token keyword&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;token operator&#34;&gt;!&lt;/span&gt; &lt;span class=&#34;token builtin class-name&#34;&gt;command&lt;/span&gt; &lt;span class=&#34;token parameter variable&#34;&gt;-v&lt;/span&gt; aliyun &lt;span class=&#34;token operator&#34;&gt;&gt;&lt;/span&gt;/dev/null&lt;span class=&#34;token punctuation&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;token keyword&#34;&gt;then&lt;/span&gt;
	&lt;span class=&#34;token builtin class-name&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;token string&#34;&gt;&#34;错误: 你需要先安装 aliyun 命令行工具 https://help.aliyun.com/document_detail/121541.html。&#34;&lt;/span&gt; &lt;span class=&#34;token operator&#34;&gt;&lt;span class=&#34;token file-descriptor important&#34;&gt;1&lt;/span&gt;&gt;&lt;/span&gt;&lt;span class=&#34;token file-descriptor important&#34;&gt;&amp;amp;2&lt;/span&gt;
	&lt;span class=&#34;token builtin class-name&#34;&gt;exit&lt;/span&gt; &lt;span class=&#34;token number&#34;&gt;1&lt;/span&gt;
&lt;span class=&#34;token keyword&#34;&gt;fi&lt;/span&gt;

&lt;span class=&#34;token assign-left variable&#34;&gt;DOMAIN&lt;/span&gt;&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;token variable&#34;&gt;&lt;span class=&#34;token variable&#34;&gt;$(&lt;/span&gt;&lt;span class=&#34;token function&#34;&gt;expr&lt;/span&gt; match &lt;span class=&#34;token string&#34;&gt;&#34;&lt;span class=&#34;token variable&#34;&gt;$CERTBOT_DOMAIN&lt;/span&gt;&#34;&lt;/span&gt; &lt;span class=&#34;token string&#34;&gt;&#39;.*\.\(.*\..*\)&#39;&lt;/span&gt;&lt;span class=&#34;token variable&#34;&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span class=&#34;token assign-left variable&#34;&gt;SUB_DOMAIN&lt;/span&gt;&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;token variable&#34;&gt;&lt;span class=&#34;token variable&#34;&gt;$(&lt;/span&gt;&lt;span class=&#34;token function&#34;&gt;expr&lt;/span&gt; match &lt;span class=&#34;token string&#34;&gt;&#34;&lt;span class=&#34;token variable&#34;&gt;$CERTBOT_DOMAIN&lt;/span&gt;&#34;&lt;/span&gt; &lt;span class=&#34;token string&#34;&gt;&#39;\(.*\)\..*\..*&#39;&lt;/span&gt;&lt;span class=&#34;token variable&#34;&gt;)&lt;/span&gt;&lt;/span&gt;

&lt;span class=&#34;token keyword&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;token builtin class-name&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;token variable&#34;&gt;$CERTBOT_DOMAIN&lt;/span&gt; &lt;span class=&#34;token operator&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;token function&#34;&gt;grep&lt;/span&gt; &lt;span class=&#34;token parameter variable&#34;&gt;-E&lt;/span&gt; &lt;span class=&#34;token parameter variable&#34;&gt;-q&lt;/span&gt; &lt;span class=&#34;token string&#34;&gt;&#34;&lt;span class=&#34;token variable&#34;&gt;$FLAG&lt;/span&gt;&#34;&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;token keyword&#34;&gt;then&lt;/span&gt;

  &lt;span class=&#34;token assign-left variable&#34;&gt;DOMAIN&lt;/span&gt;&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;token variable&#34;&gt;&lt;span class=&#34;token variable&#34;&gt;`&lt;/span&gt;&lt;span class=&#34;token builtin class-name&#34;&gt;echo&lt;/span&gt; $CERTBOT_DOMAIN &lt;span class=&#34;token operator&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;token function&#34;&gt;grep&lt;/span&gt; &lt;span class=&#34;token parameter variable&#34;&gt;-oP&lt;/span&gt; &lt;span class=&#34;token string&#34;&gt;&#39;(?&amp;lt;=)[^.]+(&#39;&lt;/span&gt;$FLAG&lt;span class=&#34;token string&#34;&gt;&#39;)&#39;&lt;/span&gt;&lt;span class=&#34;token variable&#34;&gt;`&lt;/span&gt;&lt;/span&gt;
  &lt;span class=&#34;token assign-left variable&#34;&gt;SUB_DOMAIN&lt;/span&gt;&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;token variable&#34;&gt;&lt;span class=&#34;token variable&#34;&gt;`&lt;/span&gt;&lt;span class=&#34;token builtin class-name&#34;&gt;echo&lt;/span&gt; $CERTBOT_DOMAIN &lt;span class=&#34;token operator&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;token function&#34;&gt;grep&lt;/span&gt; &lt;span class=&#34;token parameter variable&#34;&gt;-oP&lt;/span&gt; &lt;span class=&#34;token string&#34;&gt;&#39;.*(?=\.[^.]+(&#39;&lt;/span&gt;$FLAG&lt;span class=&#34;token string&#34;&gt;&#39;))&#39;&lt;/span&gt;&lt;span class=&#34;token variable&#34;&gt;`&lt;/span&gt;&lt;/span&gt;

&lt;span class=&#34;token keyword&#34;&gt;fi&lt;/span&gt;

&lt;span class=&#34;token keyword&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;token punctuation&#34;&gt;[&lt;/span&gt; &lt;span class=&#34;token parameter variable&#34;&gt;-z&lt;/span&gt; &lt;span class=&#34;token variable&#34;&gt;$DOMAIN&lt;/span&gt; &lt;span class=&#34;token punctuation&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;token keyword&#34;&gt;then&lt;/span&gt;
    &lt;span class=&#34;token assign-left variable&#34;&gt;DOMAIN&lt;/span&gt;&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;token variable&#34;&gt;$CERTBOT_DOMAIN&lt;/span&gt;
&lt;span class=&#34;token keyword&#34;&gt;fi&lt;/span&gt;
&lt;span class=&#34;token keyword&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;token punctuation&#34;&gt;[&lt;/span&gt; &lt;span class=&#34;token operator&#34;&gt;!&lt;/span&gt; &lt;span class=&#34;token parameter variable&#34;&gt;-z&lt;/span&gt; &lt;span class=&#34;token variable&#34;&gt;$SUB_DOMAIN&lt;/span&gt; &lt;span class=&#34;token punctuation&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;token keyword&#34;&gt;then&lt;/span&gt;
    &lt;span class=&#34;token assign-left variable&#34;&gt;SUB_DOMAIN&lt;/span&gt;&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;.&lt;span class=&#34;token variable&#34;&gt;$SUB_DOMAIN&lt;/span&gt;
&lt;span class=&#34;token keyword&#34;&gt;fi&lt;/span&gt;

&lt;span class=&#34;token keyword&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;token punctuation&#34;&gt;[&lt;/span&gt; &lt;span class=&#34;token variable&#34;&gt;$#&lt;/span&gt; &lt;span class=&#34;token parameter variable&#34;&gt;-eq&lt;/span&gt; &lt;span class=&#34;token number&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;token punctuation&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;token keyword&#34;&gt;then&lt;/span&gt;
	aliyun alidns AddDomainRecord &lt;span class=&#34;token punctuation&#34;&gt;\&lt;/span&gt;
		&lt;span class=&#34;token parameter variable&#34;&gt;--DomainName&lt;/span&gt; &lt;span class=&#34;token variable&#34;&gt;$DOMAIN&lt;/span&gt; &lt;span class=&#34;token punctuation&#34;&gt;\&lt;/span&gt;
		&lt;span class=&#34;token parameter variable&#34;&gt;--RR&lt;/span&gt; &lt;span class=&#34;token string&#34;&gt;&#34;_acme-challenge&#34;&lt;/span&gt;&lt;span class=&#34;token variable&#34;&gt;$SUB_DOMAIN&lt;/span&gt; &lt;span class=&#34;token punctuation&#34;&gt;\&lt;/span&gt;
		&lt;span class=&#34;token parameter variable&#34;&gt;--Type&lt;/span&gt; &lt;span class=&#34;token string&#34;&gt;&#34;TXT&#34;&lt;/span&gt; &lt;span class=&#34;token punctuation&#34;&gt;\&lt;/span&gt;
		&lt;span class=&#34;token parameter variable&#34;&gt;--Value&lt;/span&gt; &lt;span class=&#34;token variable&#34;&gt;$CERTBOT_VALIDATION&lt;/span&gt;
	/bin/sleep &lt;span class=&#34;token number&#34;&gt;20&lt;/span&gt;
&lt;span class=&#34;token keyword&#34;&gt;else&lt;/span&gt;
	&lt;span class=&#34;token assign-left variable&#34;&gt;RecordId&lt;/span&gt;&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;token variable&#34;&gt;&lt;span class=&#34;token variable&#34;&gt;$(&lt;/span&gt;aliyun alidns DescribeDomainRecords &lt;span class=&#34;token punctuation&#34;&gt;\&lt;/span&gt;
		&lt;span class=&#34;token parameter variable&#34;&gt;--DomainName&lt;/span&gt; $DOMAIN &lt;span class=&#34;token punctuation&#34;&gt;\&lt;/span&gt;
		&lt;span class=&#34;token parameter variable&#34;&gt;--RRKeyWord&lt;/span&gt; &lt;span class=&#34;token string&#34;&gt;&#34;_acme-challenge&#34;&lt;/span&gt;$SUB_DOMAIN &lt;span class=&#34;token punctuation&#34;&gt;\&lt;/span&gt;
		&lt;span class=&#34;token parameter variable&#34;&gt;--Type&lt;/span&gt; &lt;span class=&#34;token string&#34;&gt;&#34;TXT&#34;&lt;/span&gt; &lt;span class=&#34;token punctuation&#34;&gt;\&lt;/span&gt;
		&lt;span class=&#34;token parameter variable&#34;&gt;--ValueKeyWord&lt;/span&gt; $CERTBOT_VALIDATION &lt;span class=&#34;token punctuation&#34;&gt;\&lt;/span&gt;
		&lt;span class=&#34;token operator&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;token function&#34;&gt;grep&lt;/span&gt; &lt;span class=&#34;token string&#34;&gt;&#34;RecordId&#34;&lt;/span&gt; &lt;span class=&#34;token punctuation&#34;&gt;\&lt;/span&gt;
		&lt;span class=&#34;token operator&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;token function&#34;&gt;grep&lt;/span&gt; &lt;span class=&#34;token parameter variable&#34;&gt;-Eo&lt;/span&gt; &lt;span class=&#34;token string&#34;&gt;&#34;[0-9]+&#34;&lt;/span&gt;&lt;span class=&#34;token variable&#34;&gt;)&lt;/span&gt;&lt;/span&gt;

	aliyun alidns DeleteDomainRecord &lt;span class=&#34;token punctuation&#34;&gt;\&lt;/span&gt;
		&lt;span class=&#34;token parameter variable&#34;&gt;--RecordId&lt;/span&gt; &lt;span class=&#34;token variable&#34;&gt;$RecordId&lt;/span&gt;
&lt;span class=&#34;token keyword&#34;&gt;fi&lt;/span&gt;&lt;span aria-hidden=&#34;true&#34; class=&#34;line-numbers-rows&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
 ]]></description>
        </item>
        <item>
            <guid isPermalink="true">https://gyoliu.github.io/2022/03/02/idea-plugin/</guid>
            <title>idea常用插件</title>
            <link>https://gyoliu.github.io/2022/03/02/idea-plugin/</link>
            <category>Default</category>
            <pubDate>Wed, 02 Mar 2022 12:36:04 +0800</pubDate>
            <description><![CDATA[ &lt;ul&gt;
&lt;li&gt;alibaba java coding guidelines 代码规范&lt;/li&gt;
&lt;li&gt;git commit template git提交模板&lt;/li&gt;
&lt;li&gt;ide eval reset&lt;/li&gt;
&lt;li&gt;java bean to json&lt;/li&gt;
&lt;li&gt;SequenceDiagram 代码时序图&lt;/li&gt;
&lt;li&gt;SonarLint 代码规范&lt;/li&gt;
&lt;li&gt;Translation 翻译&lt;/li&gt;
&lt;li&gt;JRebel or XRebel 热部署&lt;/li&gt;
&lt;li&gt;RESTfultoolkit&lt;/li&gt;
&lt;li&gt;MyBatisCodeHelper-Pro&lt;/li&gt;
&lt;/ul&gt;
 ]]></description>
        </item>
        <item>
            <guid isPermalink="true">https://gyoliu.github.io/2020/09/08/browser-cookies-SameSite-attribute/</guid>
            <title>浏览器 SameSite 属性设置</title>
            <link>https://gyoliu.github.io/2020/09/08/browser-cookies-SameSite-attribute/</link>
            <category>Default</category>
            <pubDate>Tue, 08 Sep 2020 16:58:59 +0800</pubDate>
            <description><![CDATA[ &lt;h3 id=&#34;1-起因&#34;&gt;&lt;a href=&#34;#1-起因&#34; class=&#34;headerlink&#34; title=&#34;1. 起因&#34;&gt;&lt;/a&gt;1. 起因&lt;/h3&gt;&lt;p&gt;Chrome 51 开始，浏览器的 Cookie 新增加了一个SameSite属性，用来防止 CSRF 攻击和用户追踪。&lt;br&gt;Chrome 浏览器版本从 80 版后 默认是将 Cookie 设置成 Lax&lt;/p&gt;
&lt;h3 id=&#34;2-SameSite-属性值&#34;&gt;&lt;a href=&#34;#2-SameSite-属性值&#34; class=&#34;headerlink&#34; title=&#34;2. SameSite 属性值&#34;&gt;&lt;/a&gt;2. SameSite 属性值&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;Strict&lt;/li&gt;
&lt;li&gt;Lax&lt;/li&gt;
&lt;li&gt;None&lt;blockquote&gt;
&lt;p&gt;Strict最为严格，完全禁止第三方 Cookie，跨站点时，任何情况下都不会发送 Cookie。换言之，只有当前网页的 URL 与请求目标一致，才会带上 Cookie。Lax规则稍稍放宽，大多数情况也是不发送第三方 Cookie，但是导航到目标网址的 Get 请求除外。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;请求类型&lt;/th&gt;
&lt;th&gt;示例&lt;/th&gt;
&lt;th&gt;正常情况&lt;/th&gt;
&lt;th&gt;Lax&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td&gt;链接&lt;/td&gt;
&lt;td&gt;《a href&amp;#x3D;”…”&amp;gt;&lt;/td&gt;
&lt;td&gt;发送 Cookie&lt;/td&gt;
&lt;td&gt;发送 Cookie&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;预加载&lt;/td&gt;
&lt;td&gt;《link rel&amp;#x3D;”prerender” href&amp;#x3D;”…”&amp;#x2F;&amp;gt;&lt;/td&gt;
&lt;td&gt;发送 Cookie&lt;/td&gt;
&lt;td&gt;发送 Cookie&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;GET 表单&lt;/td&gt;
&lt;td&gt;《form method&amp;#x3D;”GET” action&amp;#x3D;”…”&amp;gt;&lt;/td&gt;
&lt;td&gt;发送Cookie&lt;/td&gt;
&lt;td&gt;发送 Cookie&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;POST 表单&lt;/td&gt;
&lt;td&gt;《form method&amp;#x3D;”POST” action&amp;#x3D;”…”&amp;gt;&lt;/td&gt;
&lt;td&gt;发送 Cookie&lt;/td&gt;
&lt;td&gt;不发送&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;iframe&lt;/td&gt;
&lt;td&gt;《iframe src&amp;#x3D;”…”&amp;gt;&lt;/td&gt;
&lt;td&gt;发送 Cookie&lt;/td&gt;
&lt;td&gt;不发送&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;AJAX&lt;/td&gt;
&lt;td&gt;$.get(“…”)&lt;/td&gt;
&lt;td&gt;发送 Cookie&lt;/td&gt;
&lt;td&gt;不发送&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Image&lt;/td&gt;
&lt;td&gt;《img src&amp;#x3D;”…”》&lt;/td&gt;
&lt;td&gt;发送 Cookie&lt;/td&gt;
&lt;td&gt;不发送&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;p&gt;Chrome 计划将Lax变为默认设置。这时，网站可以选择显式关闭SameSite属性，&lt;strong&gt;将其设为None。不过，前提是必须同时设置Secure属性（Cookie 只能通过 HTTPS 协议发送），否则无效。&lt;/strong&gt;&lt;/p&gt;
&lt;pre class=&#34;line-numbers language-language&#34; data-language=&#34;language&#34;&gt;&lt;code class=&#34;language-language&#34;&gt;下面的设置无效。
Set-Cookie: widget_session&amp;#x3D;abc123; SameSite&amp;#x3D;None
下面的设置有效。
Set-Cookie: widget_session&amp;#x3D;abc123; SameSite&amp;#x3D;None; Secure&lt;span aria-hidden=&#34;true&#34; class=&#34;line-numbers-rows&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;3-该用哪种模式？&#34;&gt;&lt;a href=&#34;#3-该用哪种模式？&#34; class=&#34;headerlink&#34; title=&#34;3. 该用哪种模式？&#34;&gt;&lt;/a&gt;3. 该用哪种模式？&lt;/h3&gt;&lt;p&gt;假如你的网站有用 iframe 形式嵌在别的网站里的需求，那么连 Lax 你也不能用，因为 iframe 请求也是一种异步请求。或者假如别的网站有使用你的网站的 JSONP 接口，那么同样 Lax 你也不能用，比如天猫就是通过淘宝的 JSONP 接口来判断用户是否登录的。&lt;/p&gt;
&lt;p&gt;有时安全性和灵活性就是矛盾的，需要取舍。具体判断参照上面表格设置。&lt;/p&gt;
&lt;h3 id=&#34;4-解决方案&#34;&gt;&lt;a href=&#34;#4-解决方案&#34; class=&#34;headerlink&#34; title=&#34;4. 解决方案&#34;&gt;&lt;/a&gt;4. 解决方案&lt;/h3&gt;&lt;h4 id=&#34;4-1-方案1&#34;&gt;&lt;a href=&#34;#4-1-方案1&#34; class=&#34;headerlink&#34; title=&#34;4.1 方案1&#34;&gt;&lt;/a&gt;4.1 方案1&lt;/h4&gt;&lt;ol&gt;
&lt;li&gt;在chrome浏览器地址栏输入&lt;a href=&#34;chrome://flags并回车&#34;&gt;chrome://flags并回车&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;在搜索栏中输入SameSite by default cookies搜索，并禁用如图中的两项设置，改为Disabled即可&lt;/li&gt;
&lt;li&gt;重启浏览器&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id=&#34;4-2-方案2&#34;&gt;&lt;a href=&#34;#4-2-方案2&#34; class=&#34;headerlink&#34; title=&#34;4.2 方案2&#34;&gt;&lt;/a&gt;4.2 方案2&lt;/h4&gt;&lt;p&gt;如果使用的是 iframe 方式最好设置&lt;br&gt;X-Frame-OptionsHTTP 响应报头可以被用来指示一个浏览器是否应该被允许在一个以呈现页面《frame》，《iframe》或《object》标签。通过确保其内容未嵌入其他网站，网站可以使用此功能来避免 点击劫持 攻击。&lt;/p&gt;
&lt;pre class=&#34;line-numbers language-language&#34; data-language=&#34;language&#34;&gt;&lt;code class=&#34;language-language&#34;&gt;apache 配置
Header always append X-Frame-Options DENY
Header set X-Frame-Options &amp;quot;ALLOW-FROM https:&amp;#x2F;&amp;#x2F;example.com&amp;#x2F;&amp;quot;

Header always edit Set-Cookie &amp;quot;path&amp;#x3D;&amp;#x2F;&amp;quot; &amp;quot;path&amp;#x3D;&amp;#x2F;;  Secure; HttpOnly; SameSite&amp;#x3D;None;&amp;quot; 

#apache2.4 官方文档
#http:&amp;#x2F;&amp;#x2F;httpd.apache.org&amp;#x2F;docs&amp;#x2F;2.4&amp;#x2F;mod&amp;#x2F;mod_session_cookie.html
#http:&amp;#x2F;&amp;#x2F;httpd.apache.org&amp;#x2F;docs&amp;#x2F;2.4&amp;#x2F;mod&amp;#x2F;mod_usertrack.html


Nginx 配置
add_header X-Frame-Options ALLOWALL; #允许所有域名iframe
add_header X-Frame-Options DENY; #不允许任何域名iframe,包括相同的域名
add_header X-Frame-Options SANEORIGIN; #允许相同域名iframe,如a.test.com允许b.test.com
add_header X-Frame-Options ALLOW-FROM uri; #允许指定域名iframe 多个用逗号分隔
# 只支持 proxy 模式下设置
proxy_cookie_path &amp;#x2F; &amp;quot;&amp;#x2F;; httponly; secure; SameSite&amp;#x3D;None&amp;quot;;

#http:&amp;#x2F;&amp;#x2F;nginx.org&amp;#x2F;en&amp;#x2F;docs&amp;#x2F;http&amp;#x2F;ngx_http_proxy_module.html#proxy_cookie_path&lt;span aria-hidden=&#34;true&#34; class=&#34;line-numbers-rows&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt; ]]></description>
        </item>
    </channel>
</rss>
