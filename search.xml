<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>follow</title>
      <link href="/2024/12/26/follow/"/>
      <url>/2024/12/26/follow/</url>
      
        <content type="html"><![CDATA[<blockquote><p>This message is used to verify that this feed (feedId:94993712362846208) belongs to me (userId:569moaUVDrYGrgssS2Lwv). Join me in enjoying the next generation information browser <a href="https://follow.is/">https://follow.is</a>.</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> Default </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Default </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Cosyå…¥é—¨</title>
      <link href="/2024/12/24/Cosy%E5%85%A5%E9%97%A8/"/>
      <url>/2024/12/24/Cosy%E5%85%A5%E9%97%A8/</url>
      
        <content type="html"><![CDATA[<h3 id="çº¯ç²¹çš„æŠ˜è…¾-ğŸ’¡"><a href="#çº¯ç²¹çš„æŠ˜è…¾-ğŸ’¡" class="headerlink" title="çº¯ç²¹çš„æŠ˜è…¾ ğŸ’¡"></a>çº¯ç²¹çš„æŠ˜è…¾ ğŸ’¡</h3><p><a href="https://hexo.maxshader.com/posts/59577/">Cosy ä¸»é¢˜å…¥é—¨é…ç½®ğŸ’¡</a></p><blockquote><p>ä»¥è¿™ä¸ªå¼€æº Theme ä¸ºåŸºç¡€å¢åŠ äº†ä»¥ä¸‹</p></blockquote><h3 id="å¢åŠ -footer-é…ç½®-ğŸ¦¢"><a href="#å¢åŠ -footer-é…ç½®-ğŸ¦¢" class="headerlink" title="å¢åŠ  footer é…ç½® ğŸ¦¢"></a>å¢åŠ  footer é…ç½® ğŸ¦¢</h3><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token comment"># Footer info</span><span class="token key atrule">footer</span><span class="token punctuation">:</span>    <span class="token key atrule">enable</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>    <span class="token key atrule">since</span><span class="token punctuation">:</span> <span class="token number">2024</span>    <span class="token comment"># Customize the server domain name ICP</span>    <span class="token key atrule">ICP</span><span class="token punctuation">:</span>        <span class="token key atrule">enable</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>        <span class="token key atrule">code</span><span class="token punctuation">:</span> <span class="token string">"ç²¤ICPå¤‡18155512å·-1"</span>        <span class="token key atrule">link</span><span class="token punctuation">:</span> <span class="token string">"https://beian.miit.gov.cn/"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="å¢åŠ ä¸­é—´åŠ¨æ€æ¬¢è¿è¯­-ğŸ‘‹"><a href="#å¢åŠ ä¸­é—´åŠ¨æ€æ¬¢è¿è¯­-ğŸ‘‹" class="headerlink" title="å¢åŠ ä¸­é—´åŠ¨æ€æ¬¢è¿è¯­ ğŸ‘‹"></a>å¢åŠ ä¸­é—´åŠ¨æ€æ¬¢è¿è¯­ ğŸ‘‹</h3><p><a href="https://gyoliu.github.io/" title="æ•ˆæœåšå®¢ğŸ‘‹">æ•ˆæœåšå®¢</a><br><img src="/img/home.png"></p><h3 id="INFO-Error-has-occurred-during-indexing-posts-object-Object"><a href="#INFO-Error-has-occurred-during-indexing-posts-object-Object" class="headerlink" title="INFO  Error has occurred during indexing posts : [object Object]"></a>INFO  Error has occurred during indexing posts : [object Object]</h3><p><a href="https://yfzhu.cn/posts/1011/">è§£å†³æ–¹æ¡ˆ</a></p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token comment">#algolia Configuration</span><span class="token key atrule">algolia</span><span class="token punctuation">:</span>  <span class="token punctuation">...</span><span class="token punctuation">...</span>  <span class="token key atrule">chunkSize</span><span class="token punctuation">:</span> <span class="token number">5000</span>  <span class="token punctuation">...</span><span class="token punctuation">...</span>  <span class="token key atrule">fields</span><span class="token punctuation">:</span>    <span class="token punctuation">-</span> content<span class="token punctuation">:</span>strip<span class="token punctuation">:</span>truncate<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">5000</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Hexo </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Cosy </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hello World</title>
      <link href="/2024/12/20/hello-world/"/>
      <url>/2024/12/20/hello-world/</url>
      
        <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ hexo new <span class="token string">"My New Post"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ hexo server<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ hexo generate<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ hexo deploy<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>nginx æ­£å‘ä»£ç†é…ç½® https æ”¯æŒ</title>
      <link href="/2024/08/29/nginx-proxy/"/>
      <url>/2024/08/29/nginx-proxy/</url>
      
        <content type="html"><![CDATA[<h1 id="nginx-æ­£å‘ä»£ç†é…ç½®-https-æ”¯æŒ"><a href="#nginx-æ­£å‘ä»£ç†é…ç½®-https-æ”¯æŒ" class="headerlink" title="nginx æ­£å‘ä»£ç†é…ç½® https æ”¯æŒ"></a>nginx æ­£å‘ä»£ç†é…ç½® https æ”¯æŒ</h1><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"> -- é‡åˆ°å¾ˆå¤šéœ€è¦çš„åŒ…å®‰è£…ä¸‹æ¥å°±å¥½yum <span class="token parameter variable">-y</span> <span class="token function">install</span> perl perl-ExtUtils-Embed gperftools geoip-devel<span class="token function">wget</span> https://github.com/chobits/ngx_http_proxy_connect_module/archive/refs/heads/master.zip<span class="token function">unzip</span> master.zip<span class="token function">wget</span> https://nginx.org/download/nginx-1.20.2.tar.gz<span class="token function">tar</span> xzvf nginx-1.20.2.tar.gz<span class="token builtin class-name">cd</span> nginx-1.20.2patch <span class="token parameter variable">-p1</span> <span class="token operator">&lt;</span> <span class="token punctuation">..</span>/ngx_http_proxy_connect_module_master/patch/proxy_connect_rewrite_1018.patch./configure <span class="token parameter variable">--prefix</span><span class="token operator">=</span>/usr/share/nginx --sbin-path<span class="token operator">=</span>/usr/sbin/nginx --modules-path<span class="token operator">=</span>/usr/lib64/nginx/modules --conf-path<span class="token operator">=</span>/etc/nginx/nginx.conf --error-log-path<span class="token operator">=</span>/var/log/nginx/error.log --http-log-path<span class="token operator">=</span>/var/log/nginx/access.log --http-client-body-temp-path<span class="token operator">=</span>/var/lib/nginx/tmp/client_body --http-proxy-temp-path<span class="token operator">=</span>/var/lib/nginx/tmp/proxy --http-fastcgi-temp-path<span class="token operator">=</span>/var/lib/nginx/tmp/fastcgi --http-uwsgi-temp-path<span class="token operator">=</span>/var/lib/nginx/tmp/uwsgi --http-scgi-temp-path<span class="token operator">=</span>/var/lib/nginx/tmp/scgi --pid-path<span class="token operator">=</span>/run/nginx.pid --lock-path<span class="token operator">=</span>/run/lock/subsys/nginx <span class="token parameter variable">--user</span><span class="token operator">=</span>nginx <span class="token parameter variable">--group</span><span class="token operator">=</span>nginx --with-compat --with-debug --with-file-aio --with-google_perftools_module --with-http_addition_module --with-http_auth_request_module --with-http_dav_module --with-http_degradation_module --with-http_flv_module --with-http_gunzip_module --with-http_gzip_static_module --with-http_image_filter_module<span class="token operator">=</span>dynamic --with-http_mp4_module --with-http_perl_module<span class="token operator">=</span>dynamic --with-http_random_index_module --with-http_realip_module --with-http_secure_link_module --with-http_slice_module --add-module<span class="token operator">=</span><span class="token punctuation">..</span>/ngx_http_proxy_connect_module-master --with-http_ssl_module --with-http_stub_status_module --with-http_sub_module --with-http_v2_module --with-http_xslt_module<span class="token operator">=</span>dynamic --with-mail<span class="token operator">=</span>dynamic --with-mail_ssl_module --with-pcre --with-pcre-jit --with-stream<span class="token operator">=</span>dynamic --with-stream_ssl_module --with-stream_ssl_preread_module --with-threads<span class="token function">make</span> <span class="token operator">&amp;&amp;</span> <span class="token function">make</span> <span class="token function">install</span>systemctl restart nginx-- æµ‹è¯•ä»£ç†<span class="token function">curl</span> <span class="token parameter variable">-x</span> <span class="token number">117.72</span>.44.94:81 https://www.qq.com --proxy-insecure <span class="token parameter variable">-v</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="nginx-é…ç½®"><a href="#nginx-é…ç½®" class="headerlink" title="nginx é…ç½®"></a>nginx é…ç½®</h1><pre class="line-numbers language-none"><code class="language-none">server &#123;        listen                         81;        # dns resolver used by forward proxying        resolver                       8.8.8.8;        # forward proxy for CONNECT requests        proxy_connect;        proxy_connect_allow            all;        proxy_connect_connect_timeout  100s;        proxy_connect_data_timeout     100s;        # defined by yourself for non-CONNECT requests        # Example: reverse proxy for non-CONNECT requests        location &#x2F; &#123;            proxy_pass http:&#x2F;&#x2F;$http_host$request_uri;            proxy_set_header Host $http_host;            proxy_set_header X-Real-IP $remote_addr;            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;            proxy_set_header X-Forwarded-Proto $scheme;        &#125;    &#125;server &#123;        listen 443 default;        # self signed certificate generated via openssl command        ssl_certificate_key            &#x2F;root&#x2F;ssl&#x2F;server.key;        ssl_certificate                &#x2F;root&#x2F;ssl&#x2F;server.crt;        ssl_session_cache              shared:SSL:1m;        # dns resolver used by forward proxying        resolver                       8.8.8.8 8.8.4.4;        # forward proxy for CONNECT request        proxy_connect;        proxy_connect_allow            all;        proxy_connect_connect_timeout  100s;        proxy_connect_data_timeout     100s;        # defined by yourself for non-CONNECT request        # Example: reverse proxy for non-CONNECT requests        location &#x2F; &#123;            proxy_pass http:&#x2F;&#x2F;$http_host$request_uri;            proxy_set_header Host $http_host;            proxy_set_header X-Real-IP $remote_addr;            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;            proxy_set_header X-Forwarded-Proto $scheme;        &#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Default </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Default </tag>
            
            <tag> nginx </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åŸºäºç™¾åº¦é£æµ†å¹³å°è¯­éŸ³è¯†åˆ«PaddleSpeech</title>
      <link href="/2024/07/29/PaddleSpeech/"/>
      <url>/2024/07/29/PaddleSpeech/</url>
      
        <content type="html"><![CDATA[<h1 id="PaddleSpeech-æ˜¯åŸºäºé£æ¡¨-PaddlePaddle-çš„è¯­éŸ³æ–¹å‘çš„å¼€æºæ¨¡å‹åº“"><a href="#PaddleSpeech-æ˜¯åŸºäºé£æ¡¨-PaddlePaddle-çš„è¯­éŸ³æ–¹å‘çš„å¼€æºæ¨¡å‹åº“" class="headerlink" title="PaddleSpeech æ˜¯åŸºäºé£æ¡¨ PaddlePaddle çš„è¯­éŸ³æ–¹å‘çš„å¼€æºæ¨¡å‹åº“"></a><strong>PaddleSpeech</strong> æ˜¯åŸºäºé£æ¡¨ <a href="https://gitee.com/link?target=https://github.com/PaddlePaddle/Paddle">PaddlePaddle</a> çš„è¯­éŸ³æ–¹å‘çš„å¼€æºæ¨¡å‹åº“</h1><p><a href="https://github.com/PaddlePaddle/PaddleSpeech">https://github.com/PaddlePaddle/PaddleSpeech</a></p><h2 id="æ–‡æœ¬ä»‹ç»-Docker-éƒ¨ç½²æ–¹å¼"><a href="#æ–‡æœ¬ä»‹ç»-Docker-éƒ¨ç½²æ–¹å¼" class="headerlink" title="æ–‡æœ¬ä»‹ç» Docker éƒ¨ç½²æ–¹å¼"></a>æ–‡æœ¬ä»‹ç» Docker éƒ¨ç½²æ–¹å¼</h2><p>ä¾èµ–ç¯å¢ƒä»‹ç»,docker ç¯å¢ƒå°±ä¸ç”¨æ‹…å¿ƒè¿™äº›ï¼š</p><ul><li>gcc &gt;&#x3D; 4.8.5</li><li>paddlepaddle &lt;&#x3D; 2.5.1Â æ¡¨æ¡¨ &lt;&#x3D; 2.5.1</li><li>python &gt;&#x3D; 3.8Â <br>è‡ª 2024 å¹´ 6 æœˆä»¥æ¥ Docker Hub è®¿é—®ä¸äº†ï¼Œå›½å†…å¼€æºå‚å•†é•œåƒå¦‚æ¸…åç­‰éƒ½å®£å¸ƒä¸‹æ¶ã€‚</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">// è®¾ç½® <span class="token function">docker</span> mirrors<span class="token function">sudo</span> <span class="token function">vim</span>  /etc/docker/daemon.json<span class="token punctuation">&#123;</span>    <span class="token string">"registry-mirrors"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>        <span class="token string">"https://registry.docker-cn.com"</span>,        <span class="token string">"https://docker.mirrors.ustc.edu.cn"</span>,        <span class="token string">"https://hub-mirror.c.163.com"</span>,        <span class="token string">"https://mirror.baidubce.com"</span>,        <span class="token string">"https://ccr.ccs.tencentyun.com"</span>,        <span class="token string">"https://dockerhub.icu/"</span>    <span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token comment"># GPUç‰ˆæœ¬</span><span class="token function">docker</span> pull paddlecloud/paddlespeech:develop-gpu-cuda10.2-cudnn7-latest<span class="token comment"># CPUç‰ˆæœ¬</span><span class="token function">docker</span> pull paddlecloud/paddlespeech:develop-cpu-latest<span class="token comment"># æˆ–è€…ä½¿ç”¨ docker search paddlespeech æœç´¢ç›¸å…³çš„é•œåƒç‰ˆæœ¬</span><span class="token comment"># å¯åŠ¨æœåŠ¡</span><span class="token function">docker</span> run <span class="token parameter variable">--name</span> dev <span class="token parameter variable">-v</span> <span class="token environment constant">$PWD</span>:/mnt <span class="token parameter variable">-p</span> <span class="token number">8888</span>:8888 <span class="token parameter variable">-p</span> <span class="token number">8090</span>:8090 <span class="token parameter variable">-it</span> paddlecloud/paddlespeech:develop-cpu-latest  /bin/bash<span class="token comment"># è‡ªç„¶è¯­è¨€å¤„ç†å·¥å…·åº“NLTKå®‰è£…</span><span class="token function">docker</span> é•œåƒå†…çš„ç›®å½•æ˜¯ /root/nltk_data/å¯ä»¥å°†ä¸‹è½½å¥½çš„ä¼ è¾“åˆ°æœåŠ¡å™¨ä¸Šå¤åˆ¶åˆ°è¿™ä¸ªç›®å½•ä¸‹å¦‚ï¼šcp <span class="token parameter variable">-r</span> /mnt/nltk_data-gh-pages/packages/ /root/nltk_data/NLTK æ•°æ®ä¸‹è½½ï¼š https://github.com/nltk/nltk_data/archive/refs/heads/gh-pages.zip<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">// è®¾ç½® python pip pip <span class="token function">install</span> xxx <span class="token parameter variable">-i</span> https://mirror.baidu.com/pypi/simpleor pip config <span class="token builtin class-name">set</span> global.index-url https://pypi.tuna.tsinghua.edu.cn/simple<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>æµ‹è¯•æ•°æ®ä¸‹è½½ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">wget</span> <span class="token parameter variable">-c</span> https://paddlespeech.bj.bcebos.com/PaddleAudio/zh.wav<span class="token function">wget</span> <span class="token parameter variable">-c</span> https://paddlespeech.bj.bcebos.com/PaddleAudio/en.wav<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>å¯åŠ¨ WEB æœåŠ¡</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">paddlespeech_server start <span class="token parameter variable">--config_file</span> ./demos/speech_server/conf/application.yaml<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è¯†åˆ«è¯­éŸ³å‘½ä»¤ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">paddlespeech asr <span class="token parameter variable">--lang</span> zh <span class="token parameter variable">--input</span> zh.wav<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æ–‡å­—è½¬è¯­éŸ³å‘½ä»¤ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">paddlespeech tts <span class="token parameter variable">--input</span> <span class="token string">"ä½ å¥½ï¼Œæ¬¢è¿ä½¿ç”¨ç™¾åº¦é£æ¡¨æ·±åº¦å­¦ä¹ æ¡†æ¶ï¼"</span> <span class="token parameter variable">--output</span> output.wav<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å…¶ä»–å‘½ä»¤è¯·å‚è€ƒå¼€æºï¼š<br><a href="https://github.com/PaddlePaddle/PaddleSpeech">https://github.com/PaddlePaddle/PaddleSpeech</a></p><p>docker å‘½ä»¤å›é¡¾</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># æŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„ docker hub</span><span class="token function">docker</span> <span class="token function">ps</span> <span class="token parameter variable">-a</span><span class="token comment"># è¿›å…¥ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„ docker hub</span><span class="token function">docker</span> attach 36e3553f6bb3or <span class="token function">docker</span> run <span class="token parameter variable">-it</span> xxx /bin/bash<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Default </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Default </tag>
            
            <tag> PaddleSpeech </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>https è¯ä¹¦è‡ªåŠ¨ç»­æœŸï¼Œæ°¸ä¹…å…è´¹</title>
      <link href="/2024/07/08/nginx-config-https/"/>
      <url>/2024/07/08/nginx-config-https/</url>
      
        <content type="html"><![CDATA[<h1 id="https-è¯ä¹¦è‡ªåŠ¨ç»­æœŸï¼Œæ°¸ä¹…å…è´¹"><a href="#https-è¯ä¹¦è‡ªåŠ¨ç»­æœŸï¼Œæ°¸ä¹…å…è´¹" class="headerlink" title="https è¯ä¹¦è‡ªåŠ¨ç»­æœŸï¼Œæ°¸ä¹…å…è´¹"></a>https è¯ä¹¦è‡ªåŠ¨ç»­æœŸï¼Œæ°¸ä¹…å…è´¹</h1><blockquote><p>å¼€æºç»„ç»‡çš„å…è´¹è¯ä¹¦ï¼š<a href="https://letsencrypt.org/zh-cn/">https://letsencrypt.org/zh-cn/</a><br>Letâ€™sÂ Encrypt å’Œ <a href="https://tools.ietf.org/html/rfc8555">ACME åè®®</a>çš„ç›®æ ‡æ˜¯å®ç°å¯ä¿¡æ•°å­—è¯ä¹¦çš„è‡ªåŠ¨è·å–ï¼Œä»è€Œç®€åŒ– HTTPS æœåŠ¡å™¨éƒ¨ç½²ä¸­çš„äººå·¥æ“ä½œã€‚ è¿™ä¸€ç›®æ ‡æ˜¯ç”± Web æœåŠ¡å™¨ä¸Šçš„è¯ä¹¦ç®¡ç†è½¯ä»¶å®Œæˆçš„ã€‚</p></blockquote><h1 id="å…¥é—¨æŒ‡å—"><a href="#å…¥é—¨æŒ‡å—" class="headerlink" title="å…¥é—¨æŒ‡å—"></a>å…¥é—¨æŒ‡å—</h1><blockquote><p>ä¸ºäº†åœ¨æ‚¨çš„ç½‘ç«™ä¸Šå¯ç”¨ HTTPSï¼Œæ‚¨éœ€è¦ä»è¯ä¹¦é¢å‘æœºæ„ï¼ˆCAï¼‰è·å–è¯ä¹¦ï¼ˆä¸€ç§æ–‡ä»¶ï¼‰ã€‚ Letâ€™s Encrypt æ­£æ˜¯å…¶ä¸­ä¸€å®¶è¯ä¹¦é¢å‘æœºæ„ã€‚ è¦ä» Letâ€™s Encrypt è·å–æ‚¨ç½‘ç«™åŸŸåçš„è¯ä¹¦ï¼Œæ‚¨å¿…é¡»è¯æ˜æ‚¨å¯¹åŸŸåçš„å®é™…æ§åˆ¶æƒã€‚ è¿™ä¸€è¿‡ç¨‹é€šå¸¸ç”± Web ä¸»æœºä¸Šè¿è¡Œçš„ <a href="https://tools.ietf.org/html/rfc8555">ACME åè®®</a>å®¢æˆ·ç«¯å®Œæˆã€‚</p></blockquote><blockquote><p>ç”³è¯·è¯ä¹¦çš„æœ€ä½³æ–¹å¼å–å†³äºæ‚¨æ˜¯å¦å…·å¤‡æœåŠ¡å™¨çš„<a href="https://en.wikipedia.org/wiki/Shell_account">å‘½ä»¤è¡Œè®¿é—®æƒé™</a>ï¼ˆä¹Ÿç§°ä¸º SSH æƒé™ï¼‰ã€‚ å¦‚æœæ‚¨ä»…ä½¿ç”¨æ§åˆ¶é¢æ¿ï¼ˆä¾‹å¦‚ <a href="https://cpanel.net/">cPanel</a>ã€<a href="https://www.plesk.com/">Plesk</a> æˆ– <a href="https://wordpress.org/">WordPress</a>ï¼‰ç®¡ç†æ‚¨çš„ç½‘ç«™ï¼Œæ‚¨å¾ˆæœ‰å¯èƒ½æ²¡æœ‰å‘½ä»¤è¡Œè®¿é—®æƒé™ã€‚ æ‚¨å¯ä»¥è”ç³»æ‚¨çš„æ‰˜ç®¡æœåŠ¡æä¾›å•†ç¡®è®¤ã€‚</p></blockquote><h1 id="æ‹¥æœ‰å‘½ä»¤è¡Œè®¿é—®æƒé™"><a href="#æ‹¥æœ‰å‘½ä»¤è¡Œè®¿é—®æƒé™" class="headerlink" title="æ‹¥æœ‰å‘½ä»¤è¡Œè®¿é—®æƒé™"></a>æ‹¥æœ‰å‘½ä»¤è¡Œè®¿é—®æƒé™</h1><blockquote><p>æˆ‘ä»¬å»ºè®®å¤§å¤šæ•°å…·æœ‰å‘½ä»¤è¡Œè®¿é—®æƒé™çš„äººä½¿ç”¨ <a href="https://certbot.eff.org/">Certbot</a> ACME å®¢æˆ·ç«¯ã€‚ å®ƒå¯ä»¥åœ¨ä¸ä¸‹çº¿æ‚¨çš„æœåŠ¡å™¨çš„å‰æä¸‹è‡ªåŠ¨æ‰§è¡Œè¯ä¹¦é¢å‘å’Œå®‰è£…ã€‚ å¯¹äºä¸éœ€è¦è‡ªåŠ¨é…ç½®çš„ç”¨æˆ·ï¼ŒCertbot è¿˜æä¾›ä¸“å®¶æ¨¡å¼ã€‚ å®ƒæ˜“äºä½¿ç”¨ï¼Œé€‚ç”¨äºè®¸å¤šæ“ä½œç³»ç»Ÿï¼Œå¹¶ä¸”å…·æœ‰å‡ºè‰²çš„ï¼ˆæ³¨ï¼šè‹±æ–‡ï¼‰æ–‡æ¡£ã€‚ å‰å¾€ <a href="https://certbot.eff.org/">Certbot å®˜ç½‘</a>å³å¯è·å–é’ˆå¯¹å„ç±»æ“ä½œç³»ç»Ÿä¸æœåŠ¡å™¨è½¯ä»¶çš„ä½¿ç”¨è¯´æ˜ã€‚</p></blockquote><blockquote><p>å¦‚æœ <a href="https://certbot.eff.org/">Certbot</a> ä¸èƒ½æ»¡è¶³æ‚¨çš„éœ€æ±‚ï¼Œæˆ–è€…æ‚¨æƒ³å°è¯•åˆ«çš„å®¢æˆ·ç«¯ï¼Œè¿˜æœ‰<a href="https://letsencrypt.org/zh-cn/docs/client-options/">æ›´å¤š ACME å®¢æˆ·ç«¯</a>å¯ä¾›é€‰æ‹©ã€‚ é€‰å®š ACME å®¢æˆ·ç«¯è½¯ä»¶åï¼Œè¯·å‚é˜…è¯¥å®¢æˆ·ç«¯çš„æ–‡æ¡£ã€‚</p></blockquote><blockquote><p>å¦‚æœæ‚¨æ­£åœ¨å°è¯•ä¸åŒçš„ ACME å®¢æˆ·ç«¯ï¼Œè¯·ä½¿ç”¨æˆ‘ä»¬çš„<a href="https://letsencrypt.org/zh-cn/docs/staging-environment/">ä¸´æ—¶ç¯å¢ƒ</a>ä»¥é¿å…é­åˆ°<a href="https://letsencrypt.org/zh-cn/docs/rate-limits/">é€Ÿç‡é™åˆ¶</a>ã€‚</p></blockquote><h1 id="å®ç°äº†-ACME-åè®®çš„å®¢æˆ·ç«¯ï¼Œå®˜æ–¹æ¨èå¦‚ä¸‹ï¼š"><a href="#å®ç°äº†-ACME-åè®®çš„å®¢æˆ·ç«¯ï¼Œå®˜æ–¹æ¨èå¦‚ä¸‹ï¼š" class="headerlink" title="å®ç°äº† ACME åè®®çš„å®¢æˆ·ç«¯ï¼Œå®˜æ–¹æ¨èå¦‚ä¸‹ï¼š"></a>å®ç°äº† ACME åè®®çš„å®¢æˆ·ç«¯ï¼Œå®˜æ–¹æ¨èå¦‚ä¸‹ï¼š</h1><pre class="line-numbers language-none"><code class="language-none">https:&#x2F;&#x2F;certbot.eff.org&#x2F;instructions?ws&#x3D;nginx&amp;os&#x3D;centosrhel7&amp;tab&#x3D;wildcard<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h1 id="é˜¿é‡Œäº‘-Centos-7-å®ç°å¦‚ä¸‹ï¼š"><a href="#é˜¿é‡Œäº‘-Centos-7-å®ç°å¦‚ä¸‹ï¼š" class="headerlink" title="é˜¿é‡Œäº‘ Centos 7 å®ç°å¦‚ä¸‹ï¼š"></a>é˜¿é‡Œäº‘ Centos 7 å®ç°å¦‚ä¸‹ï¼š</h1><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">å¿…å¤‡æ¡ä»¶ï¼š<span class="token number">1</span>. å®‰è£…é˜¿é‡Œäº‘ CLI å‘½ä»¤è¡Œå·¥å…·ï¼Œå‚è€ƒå¦‚ä¸‹ï¼šhttps://help.aliyun.com/zh/cli/install-cli-on-linux?spm<span class="token operator">=</span>a2c4g.11186623.0.0.5fd7606ftkgvZH<span class="token number">2</span>. å®‰è£…è¯ä¹¦ç”Ÿæˆ ACME å®¢æˆ·ç«¯ yum <span class="token function">install</span> epel-release <span class="token parameter variable">-y</span>yum <span class="token function">install</span> certbot <span class="token parameter variable">-y</span><span class="token number">3</span>. certbot æ–‡æ¡£https://eff-certbot.readthedocs.io/en/latest/using.html<span class="token comment">#nginx</span><span class="token number">4</span>. é˜¿é‡Œäº‘è‡ªåŠ¨ç»­æœŸè„šæœ¬https://github.com/justjavac/certbot-dns-aliyun?tab<span class="token operator">=</span>readme-ov-file<span class="token number">5</span>. æˆåŠŸåå¦‚ä¸‹è¾“å‡ºè¯ä¹¦ä¿å­˜çš„è·¯å¾„ï¼Œä¹‹åå°† nginx çš„è¯ä¹¦é…ç½®æŒ‡å‘è¯¥è¯ä¹¦<span class="token number">6</span>. é‡è¦å‘½ä»¤ - ç”³è¯·è¯ä¹¦certbot certonly <span class="token parameter variable">-d</span> *.example.com <span class="token parameter variable">--manual</span> --preferred-challenges dns --manual-auth-hook <span class="token string">"alidns"</span> --manual-cleanup-hook <span class="token string">"alidns clean"</span><span class="token number">7</span>. é‡è¦å‘½ä»¤ - ç»­æœŸcertbot renew <span class="token parameter variable">--manual</span> --preferred-challenges dns --manual-auth-hook <span class="token string">"alidns"</span> --manual-cleanup-hook <span class="token string">"alidns clean"</span><span class="token number">8</span>. é‡è¦å‘½ä»¤ - è‡ªåŠ¨ç»­æœŸ<span class="token function">crontab</span> <span class="token parameter variable">-e</span><span class="token number">1</span> <span class="token number">1</span> */1 * * root certbot renew <span class="token parameter variable">--manual</span> --preferred-challenges dns --manual-auth-hook <span class="token string">"alidns"</span> --manual-cleanup-hook <span class="token string">"alidns clean"</span> --deploy-hook <span class="token string">"nginx -s reload"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="alidnsè„šæœ¬å¦‚ä¸‹ï¼Œä½œç”¨åŠ¨æ€æ·»åŠ é˜¿é‡Œäº‘-DNS-è§£æç”¨æ¥éªŒè¯ï¼š"><a href="#alidnsè„šæœ¬å¦‚ä¸‹ï¼Œä½œç”¨åŠ¨æ€æ·»åŠ é˜¿é‡Œäº‘-DNS-è§£æç”¨æ¥éªŒè¯ï¼š" class="headerlink" title="alidnsè„šæœ¬å¦‚ä¸‹ï¼Œä½œç”¨åŠ¨æ€æ·»åŠ é˜¿é‡Œäº‘ DNS è§£æç”¨æ¥éªŒè¯ï¼š"></a>alidns<strong>è„šæœ¬å¦‚ä¸‹ï¼Œä½œç”¨åŠ¨æ€æ·»åŠ é˜¿é‡Œäº‘ DNS è§£æç”¨æ¥éªŒè¯ï¼š</strong></h1><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span><span class="token assign-left variable">FLAG</span><span class="token operator">=</span><span class="token string">"(\.com\.cn|\.gov\.cn|\.net\.cn|\.org\.cn|\.ac\.cn|\.gd\.cn)$"</span><span class="token keyword">if</span> <span class="token operator">!</span> <span class="token builtin class-name">command</span> <span class="token parameter variable">-v</span> aliyun <span class="token operator">></span>/dev/null<span class="token punctuation">;</span> <span class="token keyword">then</span><span class="token builtin class-name">echo</span> <span class="token string">"é”™è¯¯: ä½ éœ€è¦å…ˆå®‰è£… aliyun å‘½ä»¤è¡Œå·¥å…· https://help.aliyun.com/document_detail/121541.htmlã€‚"</span> <span class="token operator"><span class="token file-descriptor important">1</span>></span><span class="token file-descriptor important">&amp;2</span><span class="token builtin class-name">exit</span> <span class="token number">1</span><span class="token keyword">fi</span><span class="token assign-left variable">DOMAIN</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">expr</span> match <span class="token string">"<span class="token variable">$CERTBOT_DOMAIN</span>"</span> <span class="token string">'.*\.\(.*\..*\)'</span><span class="token variable">)</span></span><span class="token assign-left variable">SUB_DOMAIN</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">expr</span> match <span class="token string">"<span class="token variable">$CERTBOT_DOMAIN</span>"</span> <span class="token string">'\(.*\)\..*\..*'</span><span class="token variable">)</span></span><span class="token keyword">if</span> <span class="token builtin class-name">echo</span> <span class="token variable">$CERTBOT_DOMAIN</span> <span class="token operator">|</span><span class="token function">grep</span> <span class="token parameter variable">-E</span> <span class="token parameter variable">-q</span> <span class="token string">"<span class="token variable">$FLAG</span>"</span><span class="token punctuation">;</span> <span class="token keyword">then</span>  <span class="token assign-left variable">DOMAIN</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token builtin class-name">echo</span> $CERTBOT_DOMAIN <span class="token operator">|</span><span class="token function">grep</span> <span class="token parameter variable">-oP</span> <span class="token string">'(?&lt;=)[^.]+('</span>$FLAG<span class="token string">')'</span><span class="token variable">`</span></span>  <span class="token assign-left variable">SUB_DOMAIN</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token builtin class-name">echo</span> $CERTBOT_DOMAIN <span class="token operator">|</span><span class="token function">grep</span> <span class="token parameter variable">-oP</span> <span class="token string">'.*(?=\.[^.]+('</span>$FLAG<span class="token string">'))'</span><span class="token variable">`</span></span><span class="token keyword">fi</span><span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token parameter variable">-z</span> <span class="token variable">$DOMAIN</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>    <span class="token assign-left variable">DOMAIN</span><span class="token operator">=</span><span class="token variable">$CERTBOT_DOMAIN</span><span class="token keyword">fi</span><span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token operator">!</span> <span class="token parameter variable">-z</span> <span class="token variable">$SUB_DOMAIN</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>    <span class="token assign-left variable">SUB_DOMAIN</span><span class="token operator">=</span>.<span class="token variable">$SUB_DOMAIN</span><span class="token keyword">fi</span><span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$#</span> <span class="token parameter variable">-eq</span> <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>aliyun alidns AddDomainRecord <span class="token punctuation">\</span><span class="token parameter variable">--DomainName</span> <span class="token variable">$DOMAIN</span> <span class="token punctuation">\</span><span class="token parameter variable">--RR</span> <span class="token string">"_acme-challenge"</span><span class="token variable">$SUB_DOMAIN</span> <span class="token punctuation">\</span><span class="token parameter variable">--Type</span> <span class="token string">"TXT"</span> <span class="token punctuation">\</span><span class="token parameter variable">--Value</span> <span class="token variable">$CERTBOT_VALIDATION</span>/bin/sleep <span class="token number">20</span><span class="token keyword">else</span><span class="token assign-left variable">RecordId</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>aliyun alidns DescribeDomainRecords <span class="token punctuation">\</span><span class="token parameter variable">--DomainName</span> $DOMAIN <span class="token punctuation">\</span><span class="token parameter variable">--RRKeyWord</span> <span class="token string">"_acme-challenge"</span>$SUB_DOMAIN <span class="token punctuation">\</span><span class="token parameter variable">--Type</span> <span class="token string">"TXT"</span> <span class="token punctuation">\</span><span class="token parameter variable">--ValueKeyWord</span> $CERTBOT_VALIDATION <span class="token punctuation">\</span><span class="token operator">|</span> <span class="token function">grep</span> <span class="token string">"RecordId"</span> <span class="token punctuation">\</span><span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-Eo</span> <span class="token string">"[0-9]+"</span><span class="token variable">)</span></span>aliyun alidns DeleteDomainRecord <span class="token punctuation">\</span><span class="token parameter variable">--RecordId</span> <span class="token variable">$RecordId</span><span class="token keyword">fi</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Default </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Default </tag>
            
            <tag> nginx </tag>
            
            <tag> è¯ä¹¦ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>centos ç£ç›˜æŒ‚è½½</title>
      <link href="/2024/01/29/centos-disk/"/>
      <url>/2024/01/29/centos-disk/</url>
      
        <content type="html"><![CDATA[<h3 id="æŸ¥çœ‹ç£ç›˜ï¼š"><a href="#æŸ¥çœ‹ç£ç›˜ï¼š" class="headerlink" title="æŸ¥çœ‹ç£ç›˜ï¼š"></a>æŸ¥çœ‹ç£ç›˜ï¼š</h3><blockquote><p>lsblk</p></blockquote><h3 id="æ ¼å¼åŒ–ç£ç›˜ï¼š"><a href="#æ ¼å¼åŒ–ç£ç›˜ï¼š" class="headerlink" title="æ ¼å¼åŒ–ç£ç›˜ï¼š"></a>æ ¼å¼åŒ–ç£ç›˜ï¼š</h3><blockquote><p>fdisk &#x2F;dev&#x2F;sdb<br>n-&gt;p-&gt;1-&gt;å›è½¦-&gt;å›è½¦-&gt;w</p></blockquote><h3 id="åˆ›å»ºç£ç›˜ï¼š"><a href="#åˆ›å»ºç£ç›˜ï¼š" class="headerlink" title="åˆ›å»ºç£ç›˜ï¼š"></a>åˆ›å»ºç£ç›˜ï¼š</h3><pre><code class="shell">mkfs.xfs /dev/sdb1mkdir /appecho &quot;/dev/sdb1 /app xfs defaults 0 0&quot; &gt;&gt; /etc/fstabmount -adf -h```yml</code></pre>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>spring cloud æ€§èƒ½ä¼˜åŒ–</title>
      <link href="/2023/08/17/spring-cloud-properties/"/>
      <url>/2023/08/17/spring-cloud-properties/</url>
      
        <content type="html"><![CDATA[<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token comment"># undertow æœåŠ¡å™¨ä¼˜åŒ–</span>server.undertow.threads.io=8server.undertow.threads.worker=256server.undertow.buffer<span class="token punctuation">-</span>size=2048server.undertow.direct<span class="token punctuation">-</span>buffers=true<span class="token comment"># å¼€å¯HTTP GZIPå‹ç¼©</span>server.compression.enabled=trueserver.compression.min<span class="token punctuation">-</span>response<span class="token punctuation">-</span>size=1KB<span class="token comment">#å¼€å¯Feignè¯·æ±‚å‹ç¼© FeignContentGzipEncodingAutoConfiguration</span>feign.compression.request.enabled=truefeign.compression.request.mime<span class="token punctuation">-</span>types=text/xml<span class="token punctuation">,</span>application/xml<span class="token punctuation">,</span>application/jsonfeign.compression.request.min<span class="token punctuation">-</span>request<span class="token punctuation">-</span>size=2048<span class="token comment"># å¼€å¯å“åº”å‹ç¼© FeignAcceptGzipEncodingAutoConfiguration DefaultGzipDecoderConfiguration DefaultGzipDecoder</span>feign.compression.response.enabled=truefeign.compression.response.useGzipDecoder=true<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Spring Cloud </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>spring bean æ‰©å±•ç‚¹è®°å½•</title>
      <link href="/2023/07/20/spring-bean-extension-point/"/>
      <url>/2023/07/20/spring-bean-extension-point/</url>
      
        <content type="html"><![CDATA[<p><img src="/img/spring%20bean%E5%AE%9E%E4%BE%8B%E5%8C%96%E6%B5%81%E7%A8%8B-mjrg.png" alt="spring beanå®ä¾‹åŒ–æµç¨‹-mjrg.png"><br><img src="/img/springbean%E5%AE%9E%E4%BE%8B%E5%8C%96%E6%B5%81%E7%A8%8B%E5%9B%BE.png" alt="springbeanå®ä¾‹åŒ–æµç¨‹å›¾.png"><br><img src="/img/spring%E6%89%A9%E5%B1%95%E6%8E%A5%E5%8F%A3%E7%82%B9.png" alt="springæ‰©å±•æ¥å£ç‚¹.png"></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// spring æ ¸å¿ƒä»£ç </span><span class="token comment">// BeanFactoryPostProcessor æ¥å£ ï¼Œthis.postProcessBeanFactory(beanFactory);</span><span class="token comment">// </span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">refresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeansException</span><span class="token punctuation">,</span> <span class="token class-name">IllegalStateException</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">synchronized</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>startupShutdownMonitor<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">prepareRefresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">ConfigurableListableBeanFactory</span> beanFactory <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">obtainFreshBeanFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">prepareBeanFactory</span><span class="token punctuation">(</span>beanFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">postProcessBeanFactory</span><span class="token punctuation">(</span>beanFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">invokeBeanFactoryPostProcessors</span><span class="token punctuation">(</span>beanFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">registerBeanPostProcessors</span><span class="token punctuation">(</span>beanFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">initMessageSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">initApplicationEventMulticaster</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">onRefresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">registerListeners</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">finishBeanFactoryInitialization</span><span class="token punctuation">(</span>beanFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">finishRefresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">BeansException</span> var9<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>logger<span class="token punctuation">.</span><span class="token function">isWarnEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">this</span><span class="token punctuation">.</span>logger<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">"Exception encountered during context initialization - cancelling refresh attempt: "</span> <span class="token operator">+</span> var9<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">destroyBeans</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">cancelRefresh</span><span class="token punctuation">(</span>var9<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">throw</span> var9<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">resetCommonCaches</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="1-BeanFactoryPostProcessoræ¥å£"><a href="#1-BeanFactoryPostProcessoræ¥å£" class="headerlink" title="1. BeanFactoryPostProcessoræ¥å£"></a>1. BeanFactoryPostProcessoræ¥å£</h1><blockquote><p>åœ¨å®¹å™¨å¯åŠ¨é˜¶æ®µï¼Œå…è®¸æˆ‘ä»¬åœ¨å®¹å™¨å®ä¾‹åŒ– Bean ä¹‹å‰å¯¹æ³¨å†Œåˆ°è¯¥å®¹å™¨çš„ BeanDefinition åšå‡ºä¿®æ”¹ï¼ŒSpring ä¸ºæˆ‘ä»¬æä¾›äº†å‡ ä¸ªå¸¸ç”¨çš„BeanFactoryPostProcessorï¼Œä»–ä»¬æ˜¯PropertyPlaceholderConfigurer å’Œ PropertyOverrideConfigurerã€‚åœ¨AbstractApplicationContextç±»çš„refresh()æ–¹æ³•ä¸­è°ƒç”¨</p></blockquote><h1 id="2-BeanDefinitionRegistryPostProcessor"><a href="#2-BeanDefinitionRegistryPostProcessor" class="headerlink" title="2. BeanDefinitionRegistryPostProcessor"></a>2. <strong>BeanDefinitionRegistryPostProcessor</strong></h1><p>BeanDefinitionRegistryPostProcessoræ˜¯BeanFactoryPostProcessorçš„å­æ¥å£ï¼Œ<strong>å¯ä»¥åŠ¨æ€æ³¨å†ŒBeanDefinitionåˆ°Springå®¹å™¨</strong>ï¼ŒSpringçš„æ³¨è§£é©±åŠ¨å®ç°å°±å‘å®¹å™¨æ³¨å…¥äº†ConfigurationClassPostProcessorç±»ï¼ŒConfigurationClassPostProcessorå¤„ç†Configçš„ç›¸å…³æ³¨è§£</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ListenerScannerProcessor</span> <span class="token keyword">implements</span> <span class="token class-name">ApplicationContextAware</span><span class="token punctuation">,</span><span class="token class-name">BeanDefinitionRegistryPostProcessor</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">ApplicationContext</span> applicationContext<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">BeanDefinition</span><span class="token punctuation">></span></span> beans <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">BeanDefinition</span><span class="token punctuation">></span></span> definitionMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">></span></span> orders <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">AnnotationBeanNameGenerator</span> beanNameGenerator <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AnnotationBeanNameGenerator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">AnnotationScopeMetadataResolver</span> scopeMetadataResolver <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AnnotationScopeMetadataResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">BASE_PACKAGES</span> <span class="token operator">=</span> <span class="token string">"è¦æ‰«æçš„åŒ…"</span><span class="token punctuation">;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">postProcessBeanDefinitionRegistry</span><span class="token punctuation">(</span><span class="token class-name">BeanDefinitionRegistry</span> beanDefinitionRegistry<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeansException</span> <span class="token punctuation">&#123;</span><span class="token comment">// é€šè¿‡ ClassPathScanningCandidateComponentProvider æ‰«æç›¸åº”çš„ç±» å¾—åˆ° BeanDefinition</span>        <span class="token class-name">ListenerScanner</span> listenerScanner <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ListenerScanner</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>applicationContext<span class="token punctuation">.</span><span class="token function">getEnvironment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">BeanDefinition</span><span class="token punctuation">></span></span> beanDefinitions <span class="token operator">=</span> listenerScanner<span class="token punctuation">.</span><span class="token function">doScan</span><span class="token punctuation">(</span><span class="token constant">BASE_PACKAGES</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Iterator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">BeanDefinition</span><span class="token punctuation">></span></span> iterator <span class="token operator">=</span> beanDefinitions<span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">while</span> <span class="token punctuation">(</span>iterator<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token class-name">BeanDefinition</span> next <span class="token operator">=</span> iterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">ScopeMetadata</span> scopeMetadata <span class="token operator">=</span> scopeMetadataResolver<span class="token punctuation">.</span><span class="token function">resolveScopeMetadata</span><span class="token punctuation">(</span>next<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">String</span> beanName <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>beanNameGenerator<span class="token punctuation">.</span><span class="token function">generateBeanName</span><span class="token punctuation">(</span>next<span class="token punctuation">,</span> beanDefinitionRegistry<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// åˆ¤æ–­æ˜¯å¦å­˜åœ¨ç›¸å…³çš„ bean </span>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">checkCandidate</span><span class="token punctuation">(</span>beanName <span class="token punctuation">,</span> next<span class="token punctuation">,</span> beanDefinitionRegistry<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                <span class="token class-name">BeanDefinitionHolder</span> definitionHolder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BeanDefinitionHolder</span><span class="token punctuation">(</span>next<span class="token punctuation">,</span> beanName<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token class-name">ScopedProxyMode</span> scopedProxyMode <span class="token operator">=</span> scopeMetadata<span class="token punctuation">.</span><span class="token function">getScopedProxyMode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>scopedProxyMode<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token class-name">ScopedProxyMode</span><span class="token punctuation">.</span><span class="token constant">NO</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token keyword">boolean</span> proxyTargetClass <span class="token operator">=</span> scopedProxyMode<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token class-name">ScopedProxyMode</span><span class="token punctuation">.</span><span class="token constant">TARGET_CLASS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    definitionHolder <span class="token operator">=</span> <span class="token class-name">ScopedProxyUtils</span><span class="token punctuation">.</span><span class="token function">createScopedProxy</span><span class="token punctuation">(</span>definitionHolder<span class="token punctuation">,</span> beanDefinitionRegistry<span class="token punctuation">,</span> proxyTargetClass<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span><span class="token comment">// æ³¨å…¥åˆ° spring</span>                <span class="token class-name">BeanDefinitionReaderUtils</span><span class="token punctuation">.</span><span class="token function">registerBeanDefinition</span><span class="token punctuation">(</span>definitionHolder<span class="token punctuation">,</span> beanDefinitionRegistry<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            definitionMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span> next<span class="token punctuation">)</span><span class="token punctuation">;</span>            orders<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">getAttributes</span><span class="token punctuation">(</span>next<span class="token punctuation">,</span> <span class="token string">"order"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> collect <span class="token operator">=</span> orders<span class="token punctuation">.</span><span class="token function">entrySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sorted</span><span class="token punctuation">(</span><span class="token class-name">Comparator</span><span class="token punctuation">.</span><span class="token function">comparingInt</span><span class="token punctuation">(</span><span class="token class-name">Map<span class="token punctuation">.</span>Entry</span><span class="token operator">::</span><span class="token function">getValue</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">Map<span class="token punctuation">.</span>Entry</span><span class="token operator">::</span><span class="token function">getKey</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        collect<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>x <span class="token operator">-></span> beans<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> definitionMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">getAttributes</span><span class="token punctuation">(</span><span class="token class-name">BeanDefinition</span> beanDefinition<span class="token punctuation">,</span> <span class="token class-name">String</span> key<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token class-name">ScannedGenericBeanDefinition</span> beanDefinition1 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ScannedGenericBeanDefinition</span><span class="token punctuation">)</span> beanDefinition<span class="token punctuation">;</span>        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">></span></span> attributes <span class="token operator">=</span> beanDefinition1<span class="token punctuation">.</span><span class="token function">getMetadata</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAnnotationAttributes</span><span class="token punctuation">(</span><span class="token class-name">Listener</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>attributes <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> attributes<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">BeanDefinition</span><span class="token punctuation">></span></span> <span class="token function">getBeans</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> beans<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">postProcessBeanFactory</span><span class="token punctuation">(</span><span class="token class-name">ConfigurableListableBeanFactory</span> configurableListableBeanFactory<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeansException</span> <span class="token punctuation">&#123;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setApplicationContext</span><span class="token punctuation">(</span><span class="token class-name">ApplicationContext</span> applicationContext<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeansException</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>applicationContext <span class="token operator">=</span> applicationContext<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">protected</span> <span class="token keyword">boolean</span> <span class="token function">checkCandidate</span><span class="token punctuation">(</span><span class="token class-name">String</span> beanName<span class="token punctuation">,</span> <span class="token class-name">BeanDefinition</span> beanDefinition<span class="token punctuation">,</span> <span class="token class-name">BeanDefinitionRegistry</span> registry<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IllegalStateException</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>registry<span class="token punctuation">.</span><span class="token function">containsBeanDefinition</span><span class="token punctuation">(</span>beanName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">BeanDefinition</span> existingDef <span class="token operator">=</span> registry<span class="token punctuation">.</span><span class="token function">getBeanDefinition</span><span class="token punctuation">(</span>beanName<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">BeanDefinition</span> originatingDef <span class="token operator">=</span> existingDef<span class="token punctuation">.</span><span class="token function">getOriginatingBeanDefinition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>originatingDef <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                existingDef <span class="token operator">=</span> originatingDef<span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">isCompatible</span><span class="token punctuation">(</span>beanDefinition<span class="token punctuation">,</span> existingDef<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">"Annotation-specified bean name '"</span> <span class="token operator">+</span> beanName <span class="token operator">+</span> <span class="token string">"' for bean class ["</span> <span class="token operator">+</span> beanDefinition<span class="token punctuation">.</span><span class="token function">getBeanClassName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"] conflicts with existing, non-compatible bean definition of same name and class ["</span> <span class="token operator">+</span> existingDef<span class="token punctuation">.</span><span class="token function">getBeanClassName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"]"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">protected</span> <span class="token keyword">boolean</span> <span class="token function">isCompatible</span><span class="token punctuation">(</span><span class="token class-name">BeanDefinition</span> newDefinition<span class="token punctuation">,</span> <span class="token class-name">BeanDefinition</span> existingDefinition<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token operator">!</span><span class="token punctuation">(</span>existingDefinition <span class="token keyword">instanceof</span> <span class="token class-name">ScannedGenericBeanDefinition</span><span class="token punctuation">)</span> <span class="token operator">||</span> newDefinition<span class="token punctuation">.</span><span class="token function">getSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>existingDefinition<span class="token punctuation">.</span><span class="token function">getSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">||</span> newDefinition<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>existingDefinition<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="3-BeanFactoryPostProcessor"><a href="#3-BeanFactoryPostProcessor" class="headerlink" title="3.BeanFactoryPostProcessor"></a><strong>3.BeanFactoryPostProcessor</strong></h1><p>**é€šè¿‡ **AbstractApplicationContext. refresh() -&gt; this.invokeBeanFactoryPostProcessors(beanFactory); å®ä¾‹åŒ–</p><h1 id="4-BeanPostProcessor"><a href="#4-BeanPostProcessor" class="headerlink" title="4.BeanPostProcessor"></a>4.BeanPostProcessor</h1><p>åœ¨ Bean å®ä¾‹åŒ–å‰åï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è‡ªå®šä¹‰BeanPostProcessoræ‹¦æˆªæ‰€æœ‰çš„beanï¼ˆåœ¨beanå®ä¾‹åŒ–ä¹‹å‰å’Œä¹‹åæ‹¦æˆªï¼‰ï¼Œå¯¹beanåšå¢å¼ºå¤„ç†ï¼ˆå‰ã€åç½®å¤„ç†ï¼‰ï¼Œç›¸å½“äºbeanå®ä¾‹åŒ–å‰åæ’å…¥äº†æ–¹æ³•</p><ul><li><p>InstantiationAwareBeanPostProcessor ç»§æ‰¿è‡ªBeanPostProcessorï¼ŒInstantiationAwareBeanPostProcessor è°ƒç”¨æ—¶æœºæ˜¯beanå®ä¾‹åŒ–ï¼ˆ<strong>Instantiation</strong>ï¼‰é˜¶æ®µï¼Œç”¨äºæ›¿æ¢beané»˜è®¤åˆ›å»ºæ–¹å¼ï¼Œ ä¸»è¦ç”¨äºåŸºç¡€æ¡†æ¶å±‚é¢</p></li><li><p><strong>SmartInstantiationAwareBeanPostProcessor</strong></p></li><li><p>MergedBeanDefinitionPostProcessor ä¸»è¦å¤„ç†åˆå¹¶åçš„BeanDefinitionï¼Œå…¶å­ç±»AutowiredAnnotationBeanPostProcessoræä¾›äº†å±æ€§è‡ªåŠ¨æ³¨å…¥çš„åŠŸèƒ½</p></li><li><p>**AutowiredAnnotationBeanPostProcessor **å¤„ç† @Autowiredå’Œ@Valueçš„å±æ€§æ³¨å…¥ï¼Œ</p></li><li><p><strong>InitDestroyAnnotationBeanPostProcessor</strong></p></li><li><p>**CommonAnnotationBeanPostProcessor **ç»§æ‰¿äº†InitDestroyAnnotationBeanPostProcessorï¼Œå¤„ç† @Resource ä»¥åŠå‡ ä¸ªEJBæ³¨è§£ï¼Œå¹¶ä¸”é€šè¿‡setInitAnnotationTypeè®¾ç½®äº†å‚ä¸ç”Ÿå‘½å‘¨æœŸçš„æ³¨è§£ï¼ˆ@PostConstructã€@PreDestoryï¼‰ï¼ˆä¸è¿‡å…·ä½“è°ƒç”¨æ˜¯åœ¨çˆ¶ç±»#â€¦BeforeInité‡Œè°ƒç”¨çš„ï¼Œä¸Šé¢è¯´è¿‡äº†ï¼‰</p><p><strong>@PostConstruct ã€InitializingBeanå’Œinit-method çš„è°ƒç”¨åŒºåˆ«å°±åœ¨è¿™äº†</strong>ï¼ŒPostConstructå°±æ˜¯åœ¨è¿™ä¸ªInitDestroyAnnotationBeanPostProcessor#BeforeInit** åˆå§‹åŒ–å‰ç½®**æ–¹æ³•è°ƒç”¨çš„ï¼Œè€ŒåƒInitializingBean#afterPropertySetåˆ™å’ŒBPPæ— å…³ï¼Œå…¶æ˜¯åœ¨beançš„InitializeBeanæ–¹æ³•è¿›å…¥å³è°ƒç”¨çš„ï¼ŒåŒæ—¶å¦‚æœè°ƒç”¨afterPropertySetå‡ºé”™äº†ï¼Œä¹Ÿä¸ä¼šè°ƒç”¨init-methodäº†ã€‚</p></li><li><p><strong>AbstractAutowireCapableBeanFactory -ã€‹</strong>initializeBean()** åœ¨å®ä¾‹åŒ–çš„å‰åè°ƒç”¨ **<em>åŸç† applyBeanPostProcessorsBeforeInitializationæ–¹æ³•å’ŒapplyBeanPostProcessorsAfterInitialization</em></p></li></ul><h1 id="5-Awareæ¥å£"><a href="#5-Awareæ¥å£" class="headerlink" title="5.Awareæ¥å£"></a>5.<strong>Awareæ¥å£</strong></h1><blockquote><p>Aware æ¥å£æ˜¯ Spring å®¹å™¨çš„æ ¸å¿ƒæ¥å£ï¼Œå®ç°äº†è¯¥æ¥å£çš„ bean ä¼šé€šè¿‡äº‹ä»¶å›è°ƒæœºåˆ¶å®ŒæˆSpringå®¹å™¨çš„é€šçŸ¥åŠŸèƒ½ï¼›<br>åœ¨AbstractAutowireCapableBeanFactoryä¸­çš„initializeBeanæ–¹æ³•ä¼šè°ƒç”¨Awareæ¥å£çš„æ–¹æ³•</p></blockquote><p><strong>éƒ¨åˆ† Aware æ¥å£æ˜¯é€šè¿‡BeanPostProcessorçš„å®ç°ç±»ApplicationContextAwareProcessorå®ç°çš„</strong></p><h1 id="6-å¸¸ç”¨çš„æ¥å£"><a href="#6-å¸¸ç”¨çš„æ¥å£" class="headerlink" title="6.å¸¸ç”¨çš„æ¥å£"></a>6.å¸¸ç”¨çš„æ¥å£</h1><table><thead><tr><th><strong>Awareæ¥å£</strong></th><th><strong>æ³¨å…¥ä¾èµ–</strong></th></tr></thead><tbody><tr><td>BeanNameAware</td><td>Bean çš„åç§°</td></tr><tr><td>BeanFactoryAware</td><td>å½“å‰ä¸Šä¸‹æ–‡çš„ BeanFactory</td></tr><tr><td>ApplicationContextAware</td><td>å½“å‰ä¸Šä¸‹æ–‡çš„ ApplicationContext</td></tr><tr><td>ApplicationEventPublisherAware</td><td>å½“å‰ä¸Šä¸‹æ–‡çš„äº‹ä»¶å‘å¸ƒè€… ApplicationEventPublisher</td></tr><tr><td>BeanClassLoaderAware</td><td>åŠ è½½ Bean ç±»çš„ç±»åŠ è½½å™¨</td></tr><tr><td>InstantiationAwareBeanPostProcessor</td><td></td></tr><tr><td>DestructionAwareBeanPostProcessor</td><td></td></tr><tr><td>DisposableBean</td><td></td></tr><tr><td>InitializingBean</td><td></td></tr></tbody></table><h1 id="7-ImportBeanDefinitionRegistrarã€‚å®ç°è‡ªå·±çš„-EnableXXX"><a href="#7-ImportBeanDefinitionRegistrarã€‚å®ç°è‡ªå·±çš„-EnableXXX" class="headerlink" title="7.ImportBeanDefinitionRegistrarã€‚å®ç°è‡ªå·±çš„@EnableXXX"></a>7.<strong>ImportBeanDefinitionRegistrarã€‚å®ç°è‡ªå·±çš„@EnableXXX</strong></h1><p>ä¸€äº›ç»„ä»¶å¯ä»¥åœ¨å¼€å¯åæ‰è¿›è¡Œä½¿ç”¨ã€‚æ¯”å¦‚ @EnableAspectJAutoProxy å¼€å¯AspectJæ”¯æŒã€‚åŸç†å°±æ˜¯åœ¨æ³¨è§£å†…éƒ¨Importäº†ä¸€ä¸ª ImportBeanDefinitionRegistrarï¼Œè¿™ä¸ªæ¥å£ä¹Ÿå¯ä»¥å¸®ä½ æ³¨å†ŒBeanDefinitionåˆ°å®¹å™¨ä¸­ï¼Œä¸”ä¼˜å…ˆäºä¸Šæ–‡ BeanDefinitionRegistryPostProcessor ã€‚</p><pre class="line-numbers language-none"><code class="language-none">FeignClientsRegistrarRibbonClientConfigurationRegistrarAspectJAutoProxyRegistrar<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> spring </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JVMå¸¸ç”¨å‚æ•°</title>
      <link href="/2023/05/06/jvm-params/"/>
      <url>/2023/05/06/jvm-params/</url>
      
        <content type="html"><![CDATA[<p><a href="https://help.aliyun.com/document_detail/148851.html?spm=a2c4g.383255.0.0.30855accl7pyIr">é˜¿é‡Œ Serverless JVM æœ€ä½³å®è·µ</a></p><pre class="line-numbers language-none"><code class="language-none"># [é˜¿é‡Œ Serverless JVM æœ€ä½³å®è·µ]https:&#x2F;&#x2F;help.aliyun.com&#x2F;document_detail&#x2F;148851.html?spm&#x3D;a2c4g.383255.0.0.30855accl7pyIråœ¨Javaè™šæ‹Ÿæœºçš„å‚æ•°ä¸­ï¼Œæœ‰3ç§è¡¨ç¤ºæ–¹æ³•æ ‡å‡†å‚æ•°ï¼ˆ-ï¼‰ï¼Œæ‰€æœ‰çš„JVMå®ç°éƒ½å¿…é¡»å®ç°è¿™äº›å‚æ•°çš„åŠŸèƒ½ï¼Œè€Œä¸”å‘åå…¼å®¹ï¼›éæ ‡å‡†å‚æ•°ï¼ˆ-Xï¼‰ï¼Œé»˜è®¤jvmå®ç°è¿™äº›å‚æ•°çš„åŠŸèƒ½ï¼Œä½†æ˜¯å¹¶ä¸ä¿è¯æ‰€æœ‰jvmå®ç°éƒ½æ»¡è¶³ï¼Œä¸”ä¸ä¿è¯å‘åå…¼å®¹ï¼›éStableå‚æ•°ï¼ˆ-XXï¼‰ï¼Œæ­¤ç±»å‚æ•°å„ä¸ªjvmå®ç°ä¼šæœ‰æ‰€ä¸åŒï¼Œå°†æ¥å¯èƒ½ä¼šéšæ—¶å–æ¶ˆï¼Œéœ€è¦æ…é‡ä½¿ç”¨ï¼ˆä½†æ˜¯ï¼Œè¿™äº›å‚æ•°å¾€å¾€æ˜¯éå¸¸æœ‰ç”¨çš„ï¼‰ï¼›# æ„ŸçŸ¥å®¹å™¨å†…å­˜é™åˆ¶-XX:+UseContainerSupport# è®¾ç½®JVMæœ€å¤§å†…å­˜ä¸ºæ•´ä¸ªå®¿ä¸»æ€»å†…å­˜çš„å æ¯”ï¼Œé€‚åˆdockerå®¹å™¨å†…å­˜åŠ¨æ€è°ƒæ•´-XX:MaxRAMPercentage&#x3D;80.0  -XX:MinRAMPercentage&#x3D;80.0 -XX:InitialRAMPercentage&#x3D;80.0# å›ºå®šè®¾ç½®å †å†…å­˜å¤§å°ï¼Œä¸èƒ½æ„ŸçŸ¥å®¿ä¸»å†…å­˜å¤§å°åŠ¨æ€è°ƒæ•´-Xmx&#x2F;-Xms# GC æ—¥å¿—æ‰“å° -XX:+PrintGCDetails-XX:+PrintGCDateStamps-XX:+PrintHeapAtGC-XX:+PrintCommandLineFlags-XX:+PrintFlagsFinal-Xloggc:&#x2F;gc-%t.log -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath&#x3D;&#x2F;data&#x2F;logs&#x2F;heapdump.hprof # åƒåœ¾å›æ”¶å™¨-XX:+UseSerialGC# å…è®¸ä½¿ç”¨å¹¶è¡Œæ¸…é™¤åƒåœ¾æ”¶é›†å™¨ï¼ˆä¹Ÿç§°ä¸ºååé‡æ”¶é›†å™¨ï¼‰ï¼Œä»¥åˆ©ç”¨å¤šä¸ªå¤„ç†å™¨æ¥æé«˜åº”ç”¨ç¨‹åºçš„æ€§èƒ½ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ­¤é€‰é¡¹æ˜¯ç¦ç”¨çš„-XX:+UseParallelGC# å…è®¸åœ¨å¹´è½»ä»£ä¸­ä½¿ç”¨å¹¶è¡Œçº¿ç¨‹è¿›è¡Œæ”¶é›†ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ­¤é€‰é¡¹å¤„äºç¦ç”¨çŠ¶æ€ã€‚-XX:+USeParNewGC-XX:+UseG1GC-XX:+UseZGCjpsï¼š è·Ÿlinuxçš„psä¸€æ ·ï¼Œåªä¸è¿‡æ˜¯åˆ—å‡ºjavaç¨‹åºjps -m  åˆ—å‡ºæ‰€æœ‰javaç¨‹åºï¼Œå¹¶æ˜¾ç¤ºä¼ å…¥å‚æ•° jps -l  åˆ—å‡ºæ‰€æœ‰javaç¨‹åºï¼Œæ˜¾ç¤ºç±»çš„å…¨é™åjstatï¼šè§‚å¯Ÿjavaç¨‹åºè¿è¡Œæ—¶çš„ç›¸å…³ä¿¡æ¯ï¼Œä¸»è¦æ˜¯å †ä¿¡æ¯jstat -class -t pid 1000 2  æŸ¥çœ‹classLoaderç›¸å…³ä¿¡æ¯ï¼Œæ¯éš”ä¸€ç§’æ‰§è¡Œä¸€æ¬¡ï¼Œæ€»å…±æ”¶é›†ä¸¤æ¬¡jstat -gc pid æŸ¥çœ‹gcæƒ…å†µjstat -gcnew pid  æŸ¥çœ‹æ–°ç”Ÿä»£çš„è¯¦ç»†ä¿¡æ¯jstat -gcold pid  æŸ¥çœ‹è€å¹´ä»£çš„è¯¦ç»†ä¿¡æ¯jinfoï¼šæŸ¥çœ‹javaåº”ç”¨ç¨‹åºçš„æ‰©å±•å‚æ•°ï¼Œéƒ¨åˆ†å‚æ•°å¯æ”¯æŒåŠ¨æ€ä¿®æ”¹jinfo -flag MaxtenuringThreshold pid æŸ¥çœ‹gcå‡çº§å¹´é¾„jinfo -flag +PrintGCDetails pid  ä¿®æ”¹ä½¿ç”¨PrintGCDetailså‚æ•°jmapï¼šå¯¼å‡ºå †åˆ°æ–‡ä»¶jmap -histo pid &gt; &#x2F;usr&#x2F;local&#x2F;tmp&#x2F;a.txt  javaç¨‹åºçš„å¯¹è±¡ç»Ÿè®¡ä¿¡æ¯jmap -histo:live jmap -dump:format&#x3D;b file&#x3D;&#x2F;tmp&#x2F;heap.hprof PID å¾—åˆ°javaç¨‹åºçš„å½“å‰å¿«ç…§ï¼Œä¸»è¦ç”¨äºåˆ†æçº¿ç¨‹çš„è¿è¡Œæƒ…å†µjstackï¼šæŸ¥çœ‹çº¿ç¨‹å †æ ˆjstack -l pid &gt; &#x2F;tmp&#x2F;stack.hprof è¿™é‡Œ-læ˜¯æ‰“å°é”çš„è¯¦ç»†ä¿¡æ¯ç„¶åè¾“å‡ºåˆ°æŒ‡å®šç›®å½•çš„*.hprofæ–‡ä»¶ä¸­# å¸¸ç”¨å¯åŠ¨å‘½ä»¤nohup java -Xms2g -Xmx2g -server -verbose:gc -XX:HeapDumpOnOutOfMemoryError -XX:HeapDumpPath&#x3D;dump.hprof -XX:+PrintGCDateStamps -XX:+PrintGCDetails -Xloggc:log&#x2F;gc-%t.log -XX:+UseGCLogFileRotation -XX:NumberOfGCLogFiles&#x3D;2 -XX:GCLogFileSize&#x3D;100M -XX:+CrashOnOutOfMemoryError -jar app.jar  &gt;&#x2F;dev&#x2F;null 2&gt;&amp;1 &amp;# å®¹å™¨docker fileENV JAVA_OPTS&#x3D;&quot;-server -XX:+UseContainerSupport -XX:+UseG1GC -XX:MaxRAMPercentage&#x3D;80.0  -XX:MinRAMPercentage&#x3D;80.0 -XX:InitialRAMPercentage&#x3D;80.0 -Duser.timezone&#x3D;GMT+8 -Ddruid.mysql.usePingMethod&#x3D;false&quot;ENV PARAMS&#x3D;&quot;&quot;ENTRYPOINT [&quot;sh&quot;,&quot;-c&quot;, &quot;java -jar $JAVA_OPTS &#x2F;itsm-module-job-service.jar $PARAMS&quot;]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><a href="/archives/hello-halo" title="Hello Halo">ä¸Šä¸€ç¯‡ </a><a href="/archives/hibernate%E5%8E%9F%E7%94%9F%E6%9F%A5%E8%AF%A2%E7%BB%93%E6%9E%9C%E9%9B%86%E6%98%A0%E5%B0%84%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB" title="hibernateåŸç”ŸæŸ¥è¯¢ï¼Œç»“æœé›†æ˜ å°„æºç é˜…è¯»">ä¸‹ä¸€ç¯‡</a></p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> JVM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>hibernateåŸç”ŸæŸ¥è¯¢ï¼Œç»“æœé›†æ˜ å°„æºç é˜…è¯»</title>
      <link href="/2022/09/23/hibernate-query-result/"/>
      <url>/2022/09/23/hibernate-query-result/</url>
      
        <content type="html"><![CDATA[<h1 id="1-hibernate-ç‰ˆæœ¬-5-4-21-Final"><a href="#1-hibernate-ç‰ˆæœ¬-5-4-21-Final" class="headerlink" title="1.hibernate ç‰ˆæœ¬ 5.4.21.Final"></a>1.hibernate ç‰ˆæœ¬ 5.4.21.Final</h1><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">SQLQuery</span> nativeQuery <span class="token operator">=</span> entityManager<span class="token punctuation">.</span><span class="token function">createNativeQuery</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token class-name">SQLQuery</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>nativeQuery<span class="token punctuation">.</span><span class="token function">setResultTransformer</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BeanResultTransformer</span><span class="token punctuation">(</span>cls<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h1 id="2-ä»£ç æ‰§è¡Œæ ˆ"><a href="#2-ä»£ç æ‰§è¡Œæ ˆ" class="headerlink" title="2.ä»£ç æ‰§è¡Œæ ˆ"></a>2.ä»£ç æ‰§è¡Œæ ˆ</h1><p><img src="/img/hibernate-query-result.png" alt="hibernate-query-result.png"></p><h1 id="3-org-hibernate-loader-Loader"><a href="#3-org-hibernate-loader-Loader" class="headerlink" title="3.org.hibernate.loader.Loader"></a>3.org.hibernate.loader.Loader</h1><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">private</span> <span class="token class-name">List</span> <span class="token function">listIgnoreQueryCache</span><span class="token punctuation">(</span><span class="token class-name">SharedSessionContractImplementor</span> session<span class="token punctuation">,</span> <span class="token class-name">QueryParameters</span> queryParameters<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getResultList</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">doList</span><span class="token punctuation">(</span>session<span class="token punctuation">,</span> queryParameters<span class="token punctuation">)</span><span class="token punctuation">,</span> queryParameters<span class="token punctuation">.</span><span class="token function">getResultTransformer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span># å…¶ä¸­ <span class="token keyword">this</span> æŒ‡å‘çš„æ˜¯ <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>hibernate<span class="token punctuation">.</span>hql<span class="token punctuation">.</span>internal<span class="token punctuation">.</span>classic<span class="token punctuation">.</span></span>QueryTranslatorImpl</span><span class="token comment">/**ResultTransformer resultTransformer æ˜¯åœ¨æŸ¥è¯¢æ—¶æŒ‡å®šçš„æ ¸å¿ƒï¼šObject result = holderInstantiator.instantiate(row);*/</span><span class="token keyword">protected</span> <span class="token class-name">List</span> <span class="token function">getResultList</span><span class="token punctuation">(</span><span class="token class-name">List</span> results<span class="token punctuation">,</span> <span class="token class-name">ResultTransformer</span> resultTransformer<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">QueryException</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">HolderInstantiator</span> holderInstantiator <span class="token operator">=</span> <span class="token class-name">HolderInstantiator</span><span class="token punctuation">.</span><span class="token function">getHolderInstantiator</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">ResultTransformer</span><span class="token punctuation">)</span><span class="token keyword">null</span><span class="token punctuation">,</span> resultTransformer<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getReturnAliasesForTransformer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>holderInstantiator<span class="token punctuation">.</span><span class="token function">isRequired</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> results<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> results<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> row <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>results<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token class-name">Object</span> result <span class="token operator">=</span> holderInstantiator<span class="token punctuation">.</span><span class="token function">instantiate</span><span class="token punctuation">(</span>row<span class="token punctuation">)</span><span class="token punctuation">;</span>                results<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token keyword">return</span> resultTransformer<span class="token punctuation">.</span><span class="token function">transformList</span><span class="token punctuation">(</span>results<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="4-è°ƒç”¨æŒ‡å®šçš„-ResultTransformer"><a href="#4-è°ƒç”¨æŒ‡å®šçš„-ResultTransformer" class="headerlink" title="4.è°ƒç”¨æŒ‡å®šçš„ ResultTransformer"></a>4.è°ƒç”¨æŒ‡å®šçš„ ResultTransformer</h1><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>hibernate<span class="token punctuation">.</span>hql<span class="token punctuation">.</span>internal<span class="token punctuation">.</span></span>HolderInstantiator</span><span class="token comment">// è°ƒç”¨ ResultTransformer çš„ transformTupleæ–¹æ³•</span><span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">instantiate</span><span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> row<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>transformer <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">?</span> row <span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>transformer<span class="token punctuation">.</span><span class="token function">transformTuple</span><span class="token punctuation">(</span>row<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getQueryReturnAliases</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="5-æœ€å"><a href="#5-æœ€å" class="headerlink" title="5.æœ€å"></a>5.æœ€å</h1><p>é™¤äº†å¯ä»¥è‡ªå®šä¹‰ ResultTransformer å¤–ï¼Œè¿˜æœ‰ä¸ªå°æŠ€å·§<br>è®¾ç½®æ•°æ®åº“æ–¹è¨€ï¼š<br>spring.jpa.properties.hibernate.dialect&#x3D;xxx.MySQL8027Dialect<br>è‡ªå®šä¹‰æ–¹è¨€æ—¶æŒ‡å®šæ•°æ®ç±»å‹æ˜ å°„ï¼š<br>&#x2F;&#x2F; å°† bitint æ˜ å°„æˆ long<br>registerColumnType(Types.BIGINT, StandardBasicTypes.LONG.getName());<br>registerHibernateType(Types.BIGINT,StandardBasicTypes.LONG.getName());</p><h1 id="hibernate-é…ç½®é¡¹"><a href="#hibernate-é…ç½®é¡¹" class="headerlink" title="hibernate é…ç½®é¡¹"></a>hibernate é…ç½®é¡¹</h1><blockquote><p>org.hibernate.jpa.AvailableSettings<br>org.hibernate.cfg.AvailableSettings<br>org.hibernate.cfg.Environment</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> hibernate </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>openssl ç¼–è¯‘å®‰è£…</title>
      <link href="/2022/09/20/openssl-install/"/>
      <url>/2022/09/20/openssl-install/</url>
      
        <content type="html"><![CDATA[<h2 id="1-å®˜æ–¹ä¸‹è½½åœ°å€"><a href="#1-å®˜æ–¹ä¸‹è½½åœ°å€" class="headerlink" title="1. å®˜æ–¹ä¸‹è½½åœ°å€"></a>1. å®˜æ–¹ä¸‹è½½åœ°å€</h2><p><a href="https://www.openssl.org/source/">https://www.openssl.org/source/</a></p><h2 id="2-ä¾èµ–å®‰è£…"><a href="#2-ä¾èµ–å®‰è£…" class="headerlink" title="2. ä¾èµ–å®‰è£…"></a>2. ä¾èµ–å®‰è£…</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">yum <span class="token function">install</span> gcc libffi-devel zlib* openssl-devel<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="3-ç¼–è¯‘"><a href="#3-ç¼–è¯‘" class="headerlink" title="3. ç¼–è¯‘"></a>3. ç¼–è¯‘</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">./config <span class="token parameter variable">--prefix</span><span class="token operator">=</span>/usr/local/openssl shared zlibå…¶ä¸­ <span class="token parameter variable">--prefix</span><span class="token operator">=</span>/usr/local/openssl  æŒ‡å®šç¼–è¯‘åˆ°é‚£ä¸ªç›®å½•ä¸‹<span class="token function">make</span> <span class="token operator">&amp;&amp;</span> <span class="token function">make</span> <span class="token function">install</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="4-å¤‡ä»½"><a href="#4-å¤‡ä»½" class="headerlink" title="4. å¤‡ä»½"></a>4. å¤‡ä»½</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">which</span> openssl  æˆ–  <span class="token function">find</span> / <span class="token parameter variable">-name</span> openssl <span class="token function">mv</span> /usr/bin/openssl /usr/bin/openssl.1.0.1e <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="5-å»ºç«‹è½¯è¿æ¥"><a href="#5-å»ºç«‹è½¯è¿æ¥" class="headerlink" title="5. å»ºç«‹è½¯è¿æ¥"></a>5. å»ºç«‹è½¯è¿æ¥</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">ln</span> <span class="token parameter variable">-s</span> /usr/local/openssl/bin/openssl /usr/bin/openssl<span class="token function">ln</span> <span class="token parameter variable">-s</span> /usr/local/openssl/include/openssl /usr/include/openssl<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="6-è®¾å®šåŠ¨æ€é“¾æ¥åº“"><a href="#6-è®¾å®šåŠ¨æ€é“¾æ¥åº“" class="headerlink" title="6. è®¾å®šåŠ¨æ€é“¾æ¥åº“"></a>6. è®¾å®šåŠ¨æ€é“¾æ¥åº“</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">echo</span> <span class="token string">"/usr/local/openssl/lib"</span> <span class="token operator">>></span> /etc/ld.so.confldconfig <span class="token parameter variable">-v</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="7-éªŒè¯"><a href="#7-éªŒè¯" class="headerlink" title="7. éªŒè¯"></a>7. éªŒè¯</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">openssl version <span class="token parameter variable">-a</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> openssl </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>mysql é‡åˆ°çš„ä¸€äº›é”™è¯¯</title>
      <link href="/2022/09/16/mysql-error-collection/"/>
      <url>/2022/09/16/mysql-error-collection/</url>
      
        <content type="html"><![CDATA[<h2 id="1-3100-Error-on-observer-while-running-replication-hook-â€˜before-commitâ€™"><a href="#1-3100-Error-on-observer-while-running-replication-hook-â€˜before-commitâ€™" class="headerlink" title="1. 3100 - Error on observer while running replication hook â€˜before_commitâ€™."></a>1. 3100 - Error on observer while running replication hook â€˜before_commitâ€™.</h2><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">show</span> <span class="token keyword">global</span> variables <span class="token operator">like</span> <span class="token string">'%group_replication_transaction_size_limit%'</span><span class="token punctuation">;</span><span class="token keyword">set</span> <span class="token keyword">global</span> group_replication_transaction_size_limit<span class="token operator">=</span><span class="token number">1500000000</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="2-Err-9001-Max-connect-timeout-reached-while-reaching-hostgroup-10-after-1"><a href="#2-Err-9001-Max-connect-timeout-reached-while-reaching-hostgroup-10-after-1" class="headerlink" title="2. [Err] 9001 - Max connect timeout reached while reaching hostgroup 10 after 1"></a>2. [Err] 9001 - Max connect timeout reached while reaching hostgroup 10 after 1</h2><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">show</span> <span class="token keyword">global</span> variables <span class="token operator">like</span> <span class="token string">'%connect%'</span><span class="token punctuation">;</span><span class="token keyword">set</span> <span class="token keyword">GLOBAL</span> max_connections <span class="token operator">=</span> <span class="token number">2000</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="3-Caused-by-java-sql-SQLException-Illegal-mix-of-collations-utf8mb4-general-ci-COERCIBLE-and-utf8mb4-0900-ai-ci-COERCIBLE-for-operation-â€˜-â€™"><a href="#3-Caused-by-java-sql-SQLException-Illegal-mix-of-collations-utf8mb4-general-ci-COERCIBLE-and-utf8mb4-0900-ai-ci-COERCIBLE-for-operation-â€˜-â€™" class="headerlink" title="3. Caused by: java.sql.SQLException: Illegal mix of collations (utf8mb4_general_ci,COERCIBLE) and (utf8mb4_0900_ai_ci,COERCIBLE) for operation â€˜&#x3D;â€™"></a>3. Caused by: java.sql.SQLException: Illegal mix of collations (utf8mb4_general_ci,COERCIBLE) and (utf8mb4_0900_ai_ci,COERCIBLE) for operation â€˜&#x3D;â€™</h2><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Caused</span> by<span class="token operator">:</span> <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>hibernate<span class="token punctuation">.</span>exception<span class="token punctuation">.</span></span>GenericJDBCException</span><span class="token operator">:</span> could not extract <span class="token class-name">ResultSet</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>hibernate<span class="token punctuation">.</span>exception<span class="token punctuation">.</span>internal<span class="token punctuation">.</span></span>StandardSQLExceptionConverter</span><span class="token punctuation">.</span><span class="token function">convert</span><span class="token punctuation">(</span><span class="token class-name">StandardSQLExceptionConverter</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">47</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>hibernate<span class="token punctuation">.</span>engine<span class="token punctuation">.</span>jdbc<span class="token punctuation">.</span>spi<span class="token punctuation">.</span></span>SqlExceptionHelper</span><span class="token punctuation">.</span><span class="token function">convert</span><span class="token punctuation">(</span><span class="token class-name">SqlExceptionHelper</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">113</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>hibernate<span class="token punctuation">.</span>engine<span class="token punctuation">.</span>jdbc<span class="token punctuation">.</span>spi<span class="token punctuation">.</span></span>SqlExceptionHelper</span><span class="token punctuation">.</span><span class="token function">convert</span><span class="token punctuation">(</span><span class="token class-name">SqlExceptionHelper</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">99</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>hibernate<span class="token punctuation">.</span>engine<span class="token punctuation">.</span>jdbc<span class="token punctuation">.</span>internal<span class="token punctuation">.</span></span>ResultSetReturnImpl</span><span class="token punctuation">.</span><span class="token function">extract</span><span class="token punctuation">(</span><span class="token class-name">ResultSetReturnImpl</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">69</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>hibernate<span class="token punctuation">.</span>loader<span class="token punctuation">.</span></span>Loader</span><span class="token punctuation">.</span><span class="token function">getResultSet</span><span class="token punctuation">(</span><span class="token class-name">Loader</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">2167</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>hibernate<span class="token punctuation">.</span>loader<span class="token punctuation">.</span></span>Loader</span><span class="token punctuation">.</span><span class="token function">executeQueryStatement</span><span class="token punctuation">(</span><span class="token class-name">Loader</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">1930</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>hibernate<span class="token punctuation">.</span>loader<span class="token punctuation">.</span></span>Loader</span><span class="token punctuation">.</span><span class="token function">executeQueryStatement</span><span class="token punctuation">(</span><span class="token class-name">Loader</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">1892</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>hibernate<span class="token punctuation">.</span>loader<span class="token punctuation">.</span></span>Loader</span><span class="token punctuation">.</span><span class="token function">doQuery</span><span class="token punctuation">(</span><span class="token class-name">Loader</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">937</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>hibernate<span class="token punctuation">.</span>loader<span class="token punctuation">.</span></span>Loader</span><span class="token punctuation">.</span><span class="token function">doQueryAndInitializeNonLazyCollections</span><span class="token punctuation">(</span><span class="token class-name">Loader</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">340</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>hibernate<span class="token punctuation">.</span>loader<span class="token punctuation">.</span></span>Loader</span><span class="token punctuation">.</span><span class="token function">doList</span><span class="token punctuation">(</span><span class="token class-name">Loader</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">2689</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>hibernate<span class="token punctuation">.</span>loader<span class="token punctuation">.</span></span>Loader</span><span class="token punctuation">.</span><span class="token function">doList</span><span class="token punctuation">(</span><span class="token class-name">Loader</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">2672</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>hibernate<span class="token punctuation">.</span>loader<span class="token punctuation">.</span></span>Loader</span><span class="token punctuation">.</span><span class="token function">listIgnoreQueryCache</span><span class="token punctuation">(</span><span class="token class-name">Loader</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">2506</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>hibernate<span class="token punctuation">.</span>loader<span class="token punctuation">.</span></span>Loader</span><span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token class-name">Loader</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">2501</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>hibernate<span class="token punctuation">.</span>loader<span class="token punctuation">.</span>custom<span class="token punctuation">.</span></span>CustomLoader</span><span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token class-name">CustomLoader</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">338</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>hibernate<span class="token punctuation">.</span>internal<span class="token punctuation">.</span></span>SessionImpl</span><span class="token punctuation">.</span><span class="token function">listCustomQuery</span><span class="token punctuation">(</span><span class="token class-name">SessionImpl</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">2223</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>hibernate<span class="token punctuation">.</span>internal<span class="token punctuation">.</span></span>AbstractSharedSessionContract</span><span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token class-name">AbstractSharedSessionContract</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">1053</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>hibernate<span class="token punctuation">.</span>query<span class="token punctuation">.</span>internal<span class="token punctuation">.</span></span>NativeQueryImpl</span><span class="token punctuation">.</span><span class="token function">doList</span><span class="token punctuation">(</span><span class="token class-name">NativeQueryImpl</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">170</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>hibernate<span class="token punctuation">.</span>query<span class="token punctuation">.</span>internal<span class="token punctuation">.</span></span>AbstractProducedQuery</span><span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token class-name">AbstractProducedQuery</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">1505</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token number">100</span> common frames omitted<span class="token class-name">Caused</span> by<span class="token operator">:</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>sql<span class="token punctuation">.</span></span>SQLException</span><span class="token operator">:</span> <span class="token class-name">Illegal</span> mix of collations <span class="token punctuation">(</span>utf8mb4_general_ci<span class="token punctuation">,</span><span class="token constant">COERCIBLE</span><span class="token punctuation">)</span> and <span class="token punctuation">(</span>utf8mb4_0900_ai_ci<span class="token punctuation">,</span><span class="token constant">COERCIBLE</span><span class="token punctuation">)</span> <span class="token keyword">for</span> operation <span class="token char">'='</span>at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>mysql<span class="token punctuation">.</span>cj<span class="token punctuation">.</span>jdbc<span class="token punctuation">.</span>exceptions<span class="token punctuation">.</span></span>SQLError</span><span class="token punctuation">.</span><span class="token function">createSQLException</span><span class="token punctuation">(</span><span class="token class-name">SQLError</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">129</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>mysql<span class="token punctuation">.</span>cj<span class="token punctuation">.</span>jdbc<span class="token punctuation">.</span>exceptions<span class="token punctuation">.</span></span>SQLExceptionsMapping</span><span class="token punctuation">.</span><span class="token function">translateException</span><span class="token punctuation">(</span><span class="token class-name">SQLExceptionsMapping</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">122</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>mysql<span class="token punctuation">.</span>cj<span class="token punctuation">.</span>jdbc<span class="token punctuation">.</span></span>ClientPreparedStatement</span><span class="token punctuation">.</span><span class="token function">executeInternal</span><span class="token punctuation">(</span><span class="token class-name">ClientPreparedStatement</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">953</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>mysql<span class="token punctuation">.</span>cj<span class="token punctuation">.</span>jdbc<span class="token punctuation">.</span></span>ClientPreparedStatement</span><span class="token punctuation">.</span><span class="token function">executeQuery</span><span class="token punctuation">(</span><span class="token class-name">ClientPreparedStatement</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">1009</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>druid<span class="token punctuation">.</span>filter<span class="token punctuation">.</span></span>FilterChainImpl</span><span class="token punctuation">.</span><span class="token function">preparedStatement_executeQuery</span><span class="token punctuation">(</span><span class="token class-name">FilterChainImpl</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">3240</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>druid<span class="token punctuation">.</span>wall<span class="token punctuation">.</span></span>WallFilter</span><span class="token punctuation">.</span><span class="token function">preparedStatement_executeQuery</span><span class="token punctuation">(</span><span class="token class-name">WallFilter</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">684</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>druid<span class="token punctuation">.</span>filter<span class="token punctuation">.</span></span>FilterChainImpl</span><span class="token punctuation">.</span><span class="token function">preparedStatement_executeQuery</span><span class="token punctuation">(</span><span class="token class-name">FilterChainImpl</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">3237</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>druid<span class="token punctuation">.</span>filter<span class="token punctuation">.</span></span>FilterEventAdapter</span><span class="token punctuation">.</span><span class="token function">preparedStatement_executeQuery</span><span class="token punctuation">(</span><span class="token class-name">FilterEventAdapter</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">465</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>druid<span class="token punctuation">.</span>filter<span class="token punctuation">.</span></span>FilterChainImpl</span><span class="token punctuation">.</span><span class="token function">preparedStatement_executeQuery</span><span class="token punctuation">(</span><span class="token class-name">FilterChainImpl</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">3237</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>druid<span class="token punctuation">.</span>proxy<span class="token punctuation">.</span>jdbc<span class="token punctuation">.</span></span>PreparedStatementProxyImpl</span><span class="token punctuation">.</span><span class="token function">executeQuery</span><span class="token punctuation">(</span><span class="token class-name">PreparedStatementProxyImpl</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">181</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>druid<span class="token punctuation">.</span>pool<span class="token punctuation">.</span></span>DruidPooledPreparedStatement</span><span class="token punctuation">.</span><span class="token function">executeQuery</span><span class="token punctuation">(</span><span class="token class-name">DruidPooledPreparedStatement</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">227</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>hibernate<span class="token punctuation">.</span>engine<span class="token punctuation">.</span>jdbc<span class="token punctuation">.</span>internal<span class="token punctuation">.</span></span>ResultSetReturnImpl</span><span class="token punctuation">.</span><span class="token function">extract</span><span class="token punctuation">(</span><span class="token class-name">ResultSetReturnImpl</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token number">114</span> common frames omitted    <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="è§£å†³æ–¹æ¡ˆï¼š"><a href="#è§£å†³æ–¹æ¡ˆï¼š" class="headerlink" title="è§£å†³æ–¹æ¡ˆï¼š"></a>è§£å†³æ–¹æ¡ˆï¼š</h3><ul><li>ä¿®æ”¹æ•°æ®åº“ç¼–ç ï¼š<br>ALTER DATABSE database_name DEFAULT CHARACTER SET utf8mb4;</li><li>ä¿®æ”¹è¡¨ç¼–ç <br>ALTER TABLE table_name DEFAULT CHARACTER SET utf8mb4;</li><li>æŸ¥è¯¢ç¼–ç æ˜¯å¦ä¸€è‡´<br>select * from information_schema.COLUMNS where table_schema &#x3D; â€˜æ•°æ®åº“â€™ and TABLE_NAME &#x3D; â€˜è¡¨åâ€™;</li><li>ä½¿ç”¨ cast ç±»å‹è½¬æ¢å‡½æ•°<br>ä¾‹ï¼šselect cast(å­—æ®µa as char) from è¡¨;<br>ä¾‹ï¼šselect * from è¡¨ where cast(å­—æ®µa as char) &#x3D; â€˜â€™;</li></ul><h2 id="4-java-lang-StringIndexOutOfBoundsException-String-index-out-of-range-0"><a href="#4-java-lang-StringIndexOutOfBoundsException-String-index-out-of-range-0" class="headerlink" title="4. java.lang.StringIndexOutOfBoundsException: String index out of range: 0"></a>4. java.lang.StringIndexOutOfBoundsException: String index out of range: 0</h2><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>StringIndexOutOfBoundsException</span><span class="token operator">:</span> <span class="token class-name">String</span> index out of range<span class="token operator">:</span> <span class="token number">0</span>at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>String</span><span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">658</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>hibernate<span class="token punctuation">.</span>type<span class="token punctuation">.</span>descriptor<span class="token punctuation">.</span>java<span class="token punctuation">.</span></span>CharacterTypeDescriptor</span><span class="token punctuation">.</span><span class="token function">wrap</span><span class="token punctuation">(</span><span class="token class-name">CharacterTypeDescriptor</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">61</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>hibernate<span class="token punctuation">.</span>type<span class="token punctuation">.</span>descriptor<span class="token punctuation">.</span>java<span class="token punctuation">.</span></span>CharacterTypeDescriptor</span><span class="token punctuation">.</span><span class="token function">wrap</span><span class="token punctuation">(</span><span class="token class-name">CharacterTypeDescriptor</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">16</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>hibernate<span class="token punctuation">.</span>type<span class="token punctuation">.</span>descriptor<span class="token punctuation">.</span>sql<span class="token punctuation">.</span></span>VarcharTypeDescriptor</span>$<span class="token number">2.</span><span class="token function">doExtract</span><span class="token punctuation">(</span><span class="token class-name">VarcharTypeDescriptor</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">62</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>hibernate<span class="token punctuation">.</span>type<span class="token punctuation">.</span>descriptor<span class="token punctuation">.</span>sql<span class="token punctuation">.</span></span>BasicExtractor</span><span class="token punctuation">.</span><span class="token function">extract</span><span class="token punctuation">(</span><span class="token class-name">BasicExtractor</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">47</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>hibernate<span class="token punctuation">.</span>type<span class="token punctuation">.</span></span>AbstractStandardBasicType</span><span class="token punctuation">.</span><span class="token function">nullSafeGet</span><span class="token punctuation">(</span><span class="token class-name">AbstractStandardBasicType</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">261</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>hibernate<span class="token punctuation">.</span>type<span class="token punctuation">.</span></span>AbstractStandardBasicType</span><span class="token punctuation">.</span><span class="token function">nullSafeGet</span><span class="token punctuation">(</span><span class="token class-name">AbstractStandardBasicType</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">257</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>hibernate<span class="token punctuation">.</span>type<span class="token punctuation">.</span></span>AbstractStandardBasicType</span><span class="token punctuation">.</span><span class="token function">nullSafeGet</span><span class="token punctuation">(</span><span class="token class-name">AbstractStandardBasicType</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">253</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>hibernate<span class="token punctuation">.</span>loader<span class="token punctuation">.</span>custom<span class="token punctuation">.</span></span>ScalarResultColumnProcessor</span><span class="token punctuation">.</span><span class="token function">extract</span><span class="token punctuation">(</span><span class="token class-name">ScalarResultColumnProcessor</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">54</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>hibernate<span class="token punctuation">.</span>loader<span class="token punctuation">.</span>custom<span class="token punctuation">.</span></span>ResultRowProcessor</span><span class="token punctuation">.</span><span class="token function">buildResultRow</span><span class="token punctuation">(</span><span class="token class-name">ResultRowProcessor</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">83</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>hibernate<span class="token punctuation">.</span>loader<span class="token punctuation">.</span>custom<span class="token punctuation">.</span></span>ResultRowProcessor</span><span class="token punctuation">.</span><span class="token function">buildResultRow</span><span class="token punctuation">(</span><span class="token class-name">ResultRowProcessor</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">60</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>hibernate<span class="token punctuation">.</span>loader<span class="token punctuation">.</span>custom<span class="token punctuation">.</span></span>CustomLoader</span><span class="token punctuation">.</span><span class="token function">getResultColumnOrRow</span><span class="token punctuation">(</span><span class="token class-name">CustomLoader</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">412</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>hibernate<span class="token punctuation">.</span>loader<span class="token punctuation">.</span></span>Loader</span><span class="token punctuation">.</span><span class="token function">getRowFromResultSet</span><span class="token punctuation">(</span><span class="token class-name">Loader</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">760</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>hibernate<span class="token punctuation">.</span>loader<span class="token punctuation">.</span></span>Loader</span><span class="token punctuation">.</span><span class="token function">processResultSet</span><span class="token punctuation">(</span><span class="token class-name">Loader</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">990</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>hibernate<span class="token punctuation">.</span>loader<span class="token punctuation">.</span></span>Loader</span><span class="token punctuation">.</span><span class="token function">doQuery</span><span class="token punctuation">(</span><span class="token class-name">Loader</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">948</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>hibernate<span class="token punctuation">.</span>loader<span class="token punctuation">.</span></span>Loader</span><span class="token punctuation">.</span><span class="token function">doQueryAndInitializeNonLazyCollections</span><span class="token punctuation">(</span><span class="token class-name">Loader</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">340</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>hibernate<span class="token punctuation">.</span>loader<span class="token punctuation">.</span></span>Loader</span><span class="token punctuation">.</span><span class="token function">doList</span><span class="token punctuation">(</span><span class="token class-name">Loader</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">2689</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>hibernate<span class="token punctuation">.</span>loader<span class="token punctuation">.</span></span>Loader</span><span class="token punctuation">.</span><span class="token function">doList</span><span class="token punctuation">(</span><span class="token class-name">Loader</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">2672</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>hibernate<span class="token punctuation">.</span>loader<span class="token punctuation">.</span></span>Loader</span><span class="token punctuation">.</span><span class="token function">listIgnoreQueryCache</span><span class="token punctuation">(</span><span class="token class-name">Loader</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">2506</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>hibernate<span class="token punctuation">.</span>loader<span class="token punctuation">.</span></span>Loader</span><span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token class-name">Loader</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">2501</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>hibernate<span class="token punctuation">.</span>loader<span class="token punctuation">.</span>custom<span class="token punctuation">.</span></span>CustomLoader</span><span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token class-name">CustomLoader</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">338</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>hibernate<span class="token punctuation">.</span>internal<span class="token punctuation">.</span></span>SessionImpl</span><span class="token punctuation">.</span><span class="token function">listCustomQuery</span><span class="token punctuation">(</span><span class="token class-name">SessionImpl</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">2223</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>hibernate<span class="token punctuation">.</span>internal<span class="token punctuation">.</span></span>AbstractSharedSessionContract</span><span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token class-name">AbstractSharedSessionContract</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">1053</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>hibernate<span class="token punctuation">.</span>query<span class="token punctuation">.</span>internal<span class="token punctuation">.</span></span>NativeQueryImpl</span><span class="token punctuation">.</span><span class="token function">doList</span><span class="token punctuation">(</span><span class="token class-name">NativeQueryImpl</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">170</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>hibernate<span class="token punctuation">.</span>query<span class="token punctuation">.</span>internal<span class="token punctuation">.</span></span>AbstractProducedQuery</span><span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token class-name">AbstractProducedQuery</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">1505</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>hibernate<span class="token punctuation">.</span>query<span class="token punctuation">.</span></span>Query</span><span class="token punctuation">.</span><span class="token function">getResultList</span><span class="token punctuation">(</span><span class="token class-name">Query</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">135</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">hk<span class="token punctuation">.</span>com<span class="token punctuation">.</span>cre<span class="token punctuation">.</span>process<span class="token punctuation">.</span>workorder<span class="token punctuation">.</span>service<span class="token punctuation">.</span>impl<span class="token punctuation">.</span></span>MeterServiceImpl</span><span class="token punctuation">.</span><span class="token function">getResultList</span><span class="token punctuation">(</span><span class="token class-name">MeterServiceImpl</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">51</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">hk<span class="token punctuation">.</span>com<span class="token punctuation">.</span>cre<span class="token punctuation">.</span>process<span class="token punctuation">.</span>workorder<span class="token punctuation">.</span>service<span class="token punctuation">.</span>impl<span class="token punctuation">.</span></span>MeterServiceImpl</span><span class="token punctuation">.</span><span class="token function">getSuperTrend</span><span class="token punctuation">(</span><span class="token class-name">MeterServiceImpl</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">331</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">hk<span class="token punctuation">.</span>com<span class="token punctuation">.</span>cre<span class="token punctuation">.</span>process<span class="token punctuation">.</span>workorder<span class="token punctuation">.</span>rest<span class="token punctuation">.</span></span>MeterController</span><span class="token punctuation">.</span><span class="token function">getSuperTrend</span><span class="token punctuation">(</span><span class="token class-name">MeterController</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">326</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">hk<span class="token punctuation">.</span>com<span class="token punctuation">.</span>cre<span class="token punctuation">.</span>process<span class="token punctuation">.</span>workorder<span class="token punctuation">.</span>rest<span class="token punctuation">.</span></span>MeterController</span>$$<span class="token class-name">FastClassBySpringCGLIB</span>$$e7d8818b<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token generics"><span class="token punctuation">&lt;</span>generated<span class="token punctuation">></span></span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cglib<span class="token punctuation">.</span>proxy<span class="token punctuation">.</span></span>MethodProxy</span><span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">MethodProxy</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">204</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>aop<span class="token punctuation">.</span>framework<span class="token punctuation">.</span></span>CglibAopProxy</span>$<span class="token class-name">CglibMethodInvocation</span><span class="token punctuation">.</span><span class="token function">invokeJoinpoint</span><span class="token punctuation">(</span><span class="token class-name">CglibAopProxy</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">737</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>aop<span class="token punctuation">.</span>framework<span class="token punctuation">.</span></span>ReflectiveMethodInvocation</span><span class="token punctuation">.</span><span class="token function">proceed</span><span class="token punctuation">(</span><span class="token class-name">ReflectiveMethodInvocation</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">157</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>aop<span class="token punctuation">.</span>aspectj<span class="token punctuation">.</span></span>MethodInvocationProceedingJoinPoint</span><span class="token punctuation">.</span><span class="token function">proceed</span><span class="token punctuation">(</span><span class="token class-name">MethodInvocationProceedingJoinPoint</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">84</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">hk<span class="token punctuation">.</span>com<span class="token punctuation">.</span>cre<span class="token punctuation">.</span>process<span class="token punctuation">.</span>comn<span class="token punctuation">.</span>exception<span class="token punctuation">.</span></span>AopDoAround</span><span class="token punctuation">.</span><span class="token function">doAround</span><span class="token punctuation">(</span><span class="token class-name">AopDoAround</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">37</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">hk<span class="token punctuation">.</span>com<span class="token punctuation">.</span>cre<span class="token punctuation">.</span>process<span class="token punctuation">.</span>workorder<span class="token punctuation">.</span>aop<span class="token punctuation">.</span></span>ControllerAop</span><span class="token punctuation">.</span><span class="token function">doAround</span><span class="token punctuation">(</span><span class="token class-name">ControllerAop</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">41</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">sun<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span>GeneratedMethodAccessor159</span><span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">Unknown</span> <span class="token class-name">Source</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">sun<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span>DelegatingMethodAccessorImpl</span><span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">DelegatingMethodAccessorImpl</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">43</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span>Method</span><span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">Method</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">497</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>aop<span class="token punctuation">.</span>aspectj<span class="token punctuation">.</span></span>AbstractAspectJAdvice</span><span class="token punctuation">.</span><span class="token function">invokeAdviceMethodWithGivenArgs</span><span class="token punctuation">(</span><span class="token class-name">AbstractAspectJAdvice</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">627</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>aop<span class="token punctuation">.</span>aspectj<span class="token punctuation">.</span></span>AbstractAspectJAdvice</span><span class="token punctuation">.</span><span class="token function">invokeAdviceMethod</span><span class="token punctuation">(</span><span class="token class-name">AbstractAspectJAdvice</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">616</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>aop<span class="token punctuation">.</span>aspectj<span class="token punctuation">.</span></span>AspectJAroundAdvice</span><span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">AspectJAroundAdvice</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">70</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>aop<span class="token punctuation">.</span>framework<span class="token punctuation">.</span></span>ReflectiveMethodInvocation</span><span class="token punctuation">.</span><span class="token function">proceed</span><span class="token punctuation">(</span><span class="token class-name">ReflectiveMethodInvocation</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">168</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>aop<span class="token punctuation">.</span>interceptor<span class="token punctuation">.</span></span>ExposeInvocationInterceptor</span><span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">ExposeInvocationInterceptor</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">92</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>aop<span class="token punctuation">.</span>framework<span class="token punctuation">.</span></span>ReflectiveMethodInvocation</span><span class="token punctuation">.</span><span class="token function">proceed</span><span class="token punctuation">(</span><span class="token class-name">ReflectiveMethodInvocation</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">179</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>aop<span class="token punctuation">.</span>framework<span class="token punctuation">.</span></span>CglibAopProxy</span>$<span class="token class-name">DynamicAdvisedInterceptor</span><span class="token punctuation">.</span><span class="token function">intercept</span><span class="token punctuation">(</span><span class="token class-name">CglibAopProxy</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">672</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">hk<span class="token punctuation">.</span>com<span class="token punctuation">.</span>cre<span class="token punctuation">.</span>process<span class="token punctuation">.</span>workorder<span class="token punctuation">.</span>rest<span class="token punctuation">.</span></span>MeterController</span>$$<span class="token class-name">EnhancerBySpringCGLIB</span>$$<span class="token number">5</span>c8114a3<span class="token punctuation">.</span><span class="token function">getSuperTrend</span><span class="token punctuation">(</span><span class="token generics"><span class="token punctuation">&lt;</span>generated<span class="token punctuation">></span></span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">sun<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span>NativeMethodAccessorImpl</span><span class="token punctuation">.</span><span class="token function">invoke0</span><span class="token punctuation">(</span><span class="token class-name">Native</span> <span class="token class-name">Method</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">sun<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span>NativeMethodAccessorImpl</span><span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">NativeMethodAccessorImpl</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">62</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">sun<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span>DelegatingMethodAccessorImpl</span><span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">DelegatingMethodAccessorImpl</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">43</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span>Method</span><span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">Method</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">497</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>method<span class="token punctuation">.</span>support<span class="token punctuation">.</span></span>InvocableHandlerMethod</span><span class="token punctuation">.</span><span class="token function">doInvoke</span><span class="token punctuation">(</span><span class="token class-name">InvocableHandlerMethod</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">205</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>method<span class="token punctuation">.</span>support<span class="token punctuation">.</span></span>InvocableHandlerMethod</span><span class="token punctuation">.</span><span class="token function">invokeForRequest</span><span class="token punctuation">(</span><span class="token class-name">InvocableHandlerMethod</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">133</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>mvc<span class="token punctuation">.</span>method<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span>ServletInvocableHandlerMethod</span><span class="token punctuation">.</span><span class="token function">invokeAndHandle</span><span class="token punctuation">(</span><span class="token class-name">ServletInvocableHandlerMethod</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">97</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>mvc<span class="token punctuation">.</span>method<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span>RequestMappingHandlerAdapter</span><span class="token punctuation">.</span><span class="token function">invokeHandlerMethod</span><span class="token punctuation">(</span><span class="token class-name">RequestMappingHandlerAdapter</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">854</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>mvc<span class="token punctuation">.</span>method<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span>RequestMappingHandlerAdapter</span><span class="token punctuation">.</span><span class="token function">handleInternal</span><span class="token punctuation">(</span><span class="token class-name">RequestMappingHandlerAdapter</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">765</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>mvc<span class="token punctuation">.</span>method<span class="token punctuation">.</span></span>AbstractHandlerMethodAdapter</span><span class="token punctuation">.</span><span class="token function">handle</span><span class="token punctuation">(</span><span class="token class-name">AbstractHandlerMethodAdapter</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">85</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span>DispatcherServlet</span><span class="token punctuation">.</span><span class="token function">doDispatch</span><span class="token punctuation">(</span><span class="token class-name">DispatcherServlet</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">967</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span>DispatcherServlet</span><span class="token punctuation">.</span><span class="token function">doService</span><span class="token punctuation">(</span><span class="token class-name">DispatcherServlet</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">901</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span>FrameworkServlet</span><span class="token punctuation">.</span><span class="token function">processRequest</span><span class="token punctuation">(</span><span class="token class-name">FrameworkServlet</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">970</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span>FrameworkServlet</span><span class="token punctuation">.</span><span class="token function">doPost</span><span class="token punctuation">(</span><span class="token class-name">FrameworkServlet</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">872</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span>HttpServlet</span><span class="token punctuation">.</span><span class="token function">service</span><span class="token punctuation">(</span><span class="token class-name">HttpServlet</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">648</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span>FrameworkServlet</span><span class="token punctuation">.</span><span class="token function">service</span><span class="token punctuation">(</span><span class="token class-name">FrameworkServlet</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">846</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span>HttpServlet</span><span class="token punctuation">.</span><span class="token function">service</span><span class="token punctuation">(</span><span class="token class-name">HttpServlet</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">729</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>catalina<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span>ApplicationFilterChain</span><span class="token punctuation">.</span><span class="token function">internalDoFilter</span><span class="token punctuation">(</span><span class="token class-name">ApplicationFilterChain</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">230</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>catalina<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span>ApplicationFilterChain</span><span class="token punctuation">.</span><span class="token function">doFilter</span><span class="token punctuation">(</span><span class="token class-name">ApplicationFilterChain</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">165</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>tomcat<span class="token punctuation">.</span>websocket<span class="token punctuation">.</span>server<span class="token punctuation">.</span></span>WsFilter</span><span class="token punctuation">.</span><span class="token function">doFilter</span><span class="token punctuation">(</span><span class="token class-name">WsFilter</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">52</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>catalina<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span>ApplicationFilterChain</span><span class="token punctuation">.</span><span class="token function">internalDoFilter</span><span class="token punctuation">(</span><span class="token class-name">ApplicationFilterChain</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">192</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>catalina<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span>ApplicationFilterChain</span><span class="token punctuation">.</span><span class="token function">doFilter</span><span class="token punctuation">(</span><span class="token class-name">ApplicationFilterChain</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">165</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>web<span class="token punctuation">.</span>filter<span class="token punctuation">.</span></span>ApplicationContextHeaderFilter</span><span class="token punctuation">.</span><span class="token function">doFilterInternal</span><span class="token punctuation">(</span><span class="token class-name">ApplicationContextHeaderFilter</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">55</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>filter<span class="token punctuation">.</span></span>OncePerRequestFilter</span><span class="token punctuation">.</span><span class="token function">doFilter</span><span class="token punctuation">(</span><span class="token class-name">OncePerRequestFilter</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">107</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>catalina<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span>ApplicationFilterChain</span><span class="token punctuation">.</span><span class="token function">internalDoFilter</span><span class="token punctuation">(</span><span class="token class-name">ApplicationFilterChain</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">192</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>catalina<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span>ApplicationFilterChain</span><span class="token punctuation">.</span><span class="token function">doFilter</span><span class="token punctuation">(</span><span class="token class-name">ApplicationFilterChain</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">165</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">hk<span class="token punctuation">.</span>com<span class="token punctuation">.</span>cre<span class="token punctuation">.</span>process<span class="token punctuation">.</span>comn<span class="token punctuation">.</span>interceptor<span class="token punctuation">.</span></span>CustomizeRequestFilter</span><span class="token punctuation">.</span><span class="token function">doFilterInternal</span><span class="token punctuation">(</span><span class="token class-name">CustomizeRequestFilter</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">23</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>filter<span class="token punctuation">.</span></span>OncePerRequestFilter</span><span class="token punctuation">.</span><span class="token function">doFilter</span><span class="token punctuation">(</span><span class="token class-name">OncePerRequestFilter</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">107</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>catalina<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span>ApplicationFilterChain</span><span class="token punctuation">.</span><span class="token function">internalDoFilter</span><span class="token punctuation">(</span><span class="token class-name">ApplicationFilterChain</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">192</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>catalina<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span>ApplicationFilterChain</span><span class="token punctuation">.</span><span class="token function">doFilter</span><span class="token punctuation">(</span><span class="token class-name">ApplicationFilterChain</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">165</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">net<span class="token punctuation">.</span>bull<span class="token punctuation">.</span>javamelody<span class="token punctuation">.</span></span>MonitoringFilter</span><span class="token punctuation">.</span><span class="token function">doFilter</span><span class="token punctuation">(</span><span class="token class-name">MonitoringFilter</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">239</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">net<span class="token punctuation">.</span>bull<span class="token punctuation">.</span>javamelody<span class="token punctuation">.</span></span>MonitoringFilter</span><span class="token punctuation">.</span><span class="token function">doFilter</span><span class="token punctuation">(</span><span class="token class-name">MonitoringFilter</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">215</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>catalina<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span>ApplicationFilterChain</span><span class="token punctuation">.</span><span class="token function">internalDoFilter</span><span class="token punctuation">(</span><span class="token class-name">ApplicationFilterChain</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">192</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>catalina<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span>ApplicationFilterChain</span><span class="token punctuation">.</span><span class="token function">doFilter</span><span class="token punctuation">(</span><span class="token class-name">ApplicationFilterChain</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">165</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>actuate<span class="token punctuation">.</span>trace<span class="token punctuation">.</span></span>WebRequestTraceFilter</span><span class="token punctuation">.</span><span class="token function">doFilterInternal</span><span class="token punctuation">(</span><span class="token class-name">WebRequestTraceFilter</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">108</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>filter<span class="token punctuation">.</span></span>OncePerRequestFilter</span><span class="token punctuation">.</span><span class="token function">doFilter</span><span class="token punctuation">(</span><span class="token class-name">OncePerRequestFilter</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">107</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>catalina<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span>ApplicationFilterChain</span><span class="token punctuation">.</span><span class="token function">internalDoFilter</span><span class="token punctuation">(</span><span class="token class-name">ApplicationFilterChain</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">192</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>catalina<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span>ApplicationFilterChain</span><span class="token punctuation">.</span><span class="token function">doFilter</span><span class="token punctuation">(</span><span class="token class-name">ApplicationFilterChain</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">165</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>filter<span class="token punctuation">.</span></span>RequestContextFilter</span><span class="token punctuation">.</span><span class="token function">doFilterInternal</span><span class="token punctuation">(</span><span class="token class-name">RequestContextFilter</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">99</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>filter<span class="token punctuation">.</span></span>OncePerRequestFilter</span><span class="token punctuation">.</span><span class="token function">doFilter</span><span class="token punctuation">(</span><span class="token class-name">OncePerRequestFilter</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">107</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>catalina<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span>ApplicationFilterChain</span><span class="token punctuation">.</span><span class="token function">internalDoFilter</span><span class="token punctuation">(</span><span class="token class-name">ApplicationFilterChain</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">192</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>catalina<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span>ApplicationFilterChain</span><span class="token punctuation">.</span><span class="token function">doFilter</span><span class="token punctuation">(</span><span class="token class-name">ApplicationFilterChain</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">165</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>filter<span class="token punctuation">.</span></span>HttpPutFormContentFilter</span><span class="token punctuation">.</span><span class="token function">doFilterInternal</span><span class="token punctuation">(</span><span class="token class-name">HttpPutFormContentFilter</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">109</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>filter<span class="token punctuation">.</span></span>OncePerRequestFilter</span><span class="token punctuation">.</span><span class="token function">doFilter</span><span class="token punctuation">(</span><span class="token class-name">OncePerRequestFilter</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">107</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>catalina<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span>ApplicationFilterChain</span><span class="token punctuation">.</span><span class="token function">internalDoFilter</span><span class="token punctuation">(</span><span class="token class-name">ApplicationFilterChain</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">192</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>catalina<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span>ApplicationFilterChain</span><span class="token punctuation">.</span><span class="token function">doFilter</span><span class="token punctuation">(</span><span class="token class-name">ApplicationFilterChain</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">165</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>filter<span class="token punctuation">.</span></span>HiddenHttpMethodFilter</span><span class="token punctuation">.</span><span class="token function">doFilterInternal</span><span class="token punctuation">(</span><span class="token class-name">HiddenHttpMethodFilter</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">93</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>filter<span class="token punctuation">.</span></span>OncePerRequestFilter</span><span class="token punctuation">.</span><span class="token function">doFilter</span><span class="token punctuation">(</span><span class="token class-name">OncePerRequestFilter</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">107</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>catalina<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span>ApplicationFilterChain</span><span class="token punctuation">.</span><span class="token function">internalDoFilter</span><span class="token punctuation">(</span><span class="token class-name">ApplicationFilterChain</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">192</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>catalina<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span>ApplicationFilterChain</span><span class="token punctuation">.</span><span class="token function">doFilter</span><span class="token punctuation">(</span><span class="token class-name">ApplicationFilterChain</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">165</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>session<span class="token punctuation">.</span>web<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span>SessionRepositoryFilter</span><span class="token punctuation">.</span><span class="token function">doFilterInternal</span><span class="token punctuation">(</span><span class="token class-name">SessionRepositoryFilter</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">167</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>session<span class="token punctuation">.</span>web<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span>OncePerRequestFilter</span><span class="token punctuation">.</span><span class="token function">doFilter</span><span class="token punctuation">(</span><span class="token class-name">OncePerRequestFilter</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">80</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>catalina<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span>ApplicationFilterChain</span><span class="token punctuation">.</span><span class="token function">internalDoFilter</span><span class="token punctuation">(</span><span class="token class-name">ApplicationFilterChain</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">192</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>catalina<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span>ApplicationFilterChain</span><span class="token punctuation">.</span><span class="token function">doFilter</span><span class="token punctuation">(</span><span class="token class-name">ApplicationFilterChain</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">165</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>filter<span class="token punctuation">.</span></span>CharacterEncodingFilter</span><span class="token punctuation">.</span><span class="token function">doFilterInternal</span><span class="token punctuation">(</span><span class="token class-name">CharacterEncodingFilter</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">197</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>filter<span class="token punctuation">.</span></span>OncePerRequestFilter</span><span class="token punctuation">.</span><span class="token function">doFilter</span><span class="token punctuation">(</span><span class="token class-name">OncePerRequestFilter</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">107</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>catalina<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span>ApplicationFilterChain</span><span class="token punctuation">.</span><span class="token function">internalDoFilter</span><span class="token punctuation">(</span><span class="token class-name">ApplicationFilterChain</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">192</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>catalina<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span>ApplicationFilterChain</span><span class="token punctuation">.</span><span class="token function">doFilter</span><span class="token punctuation">(</span><span class="token class-name">ApplicationFilterChain</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">165</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>actuate<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span></span>MetricsFilter</span><span class="token punctuation">.</span><span class="token function">doFilterInternal</span><span class="token punctuation">(</span><span class="token class-name">MetricsFilter</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">106</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>filter<span class="token punctuation">.</span></span>OncePerRequestFilter</span><span class="token punctuation">.</span><span class="token function">doFilter</span><span class="token punctuation">(</span><span class="token class-name">OncePerRequestFilter</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">107</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>catalina<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span>ApplicationFilterChain</span><span class="token punctuation">.</span><span class="token function">internalDoFilter</span><span class="token punctuation">(</span><span class="token class-name">ApplicationFilterChain</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">192</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>catalina<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span>ApplicationFilterChain</span><span class="token punctuation">.</span><span class="token function">doFilter</span><span class="token punctuation">(</span><span class="token class-name">ApplicationFilterChain</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">165</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>catalina<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span>StandardWrapperValve</span><span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">StandardWrapperValve</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">198</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>catalina<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span>StandardContextValve</span><span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">StandardContextValve</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">96</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>catalina<span class="token punctuation">.</span>authenticator<span class="token punctuation">.</span></span>AuthenticatorBase</span><span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">AuthenticatorBase</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">474</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>catalina<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span>StandardHostValve</span><span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">StandardHostValve</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">140</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>catalina<span class="token punctuation">.</span>valves<span class="token punctuation">.</span></span>ErrorReportValve</span><span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">ErrorReportValve</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">79</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>catalina<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span>StandardEngineValve</span><span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">StandardEngineValve</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">87</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>catalina<span class="token punctuation">.</span>connector<span class="token punctuation">.</span></span>CoyoteAdapter</span><span class="token punctuation">.</span><span class="token function">service</span><span class="token punctuation">(</span><span class="token class-name">CoyoteAdapter</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">349</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>coyote<span class="token punctuation">.</span>http11<span class="token punctuation">.</span></span>Http11Processor</span><span class="token punctuation">.</span><span class="token function">service</span><span class="token punctuation">(</span><span class="token class-name">Http11Processor</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">783</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>coyote<span class="token punctuation">.</span></span>AbstractProcessorLight</span><span class="token punctuation">.</span><span class="token function">process</span><span class="token punctuation">(</span><span class="token class-name">AbstractProcessorLight</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">66</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>coyote<span class="token punctuation">.</span></span>AbstractProtocol</span>$<span class="token class-name">ConnectionHandler</span><span class="token punctuation">.</span><span class="token function">process</span><span class="token punctuation">(</span><span class="token class-name">AbstractProtocol</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">798</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>tomcat<span class="token punctuation">.</span>util<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span>NioEndpoint</span>$<span class="token class-name">SocketProcessor</span><span class="token punctuation">.</span><span class="token function">doRun</span><span class="token punctuation">(</span><span class="token class-name">NioEndpoint</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">1434</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>tomcat<span class="token punctuation">.</span>util<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span>SocketProcessorBase</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">SocketProcessorBase</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">49</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>ThreadPoolExecutor</span><span class="token punctuation">.</span><span class="token function">runWorker</span><span class="token punctuation">(</span><span class="token class-name">ThreadPoolExecutor</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">1142</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>ThreadPoolExecutor</span>$<span class="token class-name">Worker</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">ThreadPoolExecutor</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">617</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>tomcat<span class="token punctuation">.</span>util<span class="token punctuation">.</span>threads<span class="token punctuation">.</span></span>TaskThread</span>$<span class="token class-name">WrappingRunnable</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">TaskThread</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">61</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>Thread</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">745</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="è§£å†³æ–¹æ³•ï¼š"><a href="#è§£å†³æ–¹æ³•ï¼š" class="headerlink" title="è§£å†³æ–¹æ³•ï¼š"></a>è§£å†³æ–¹æ³•ï¼š</h3><ul><li>ä¿®æ”¹char(1)ä¸º varchar() æˆ– ç»™å®šä¸€ä¸ªé»˜è®¤å€¼</li><li>ä¿®æ”¹æ•°æ®åº“æ–¹è¨€ï¼š MySQL8Dialect<br>registerColumnType(Types.NULL, â€œstringâ€);<br>registerHibernateType(Types.NULL,â€œstringâ€);</li></ul>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> mysql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>elasticsearch æŸ¥è¯¢</title>
      <link href="/2022/06/29/elasticsearch-query/"/>
      <url>/2022/06/29/elasticsearch-query/</url>
      
        <content type="html"><![CDATA[<h1 id="åˆ†é¡µ"><a href="#åˆ†é¡µ" class="headerlink" title="åˆ†é¡µ"></a>åˆ†é¡µ</h1><pre class="line-numbers language-none"><code class="language-none">GET &#x2F;_search&#123;    &quot;from&quot; : 0, &quot;size&quot; : 10,    &quot;query&quot; : &#123;        &quot;term&quot; : &#123; &quot;user&quot; : &quot;kimchy&quot; &#125;    &#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="æ’åº"><a href="#æ’åº" class="headerlink" title="æ’åº"></a>æ’åº</h1><pre class="line-numbers language-none"><code class="language-none">POST &#x2F;_search&#123;   &quot;query&quot; : &#123;      &quot;term&quot; : &#123; &quot;product&quot; : &quot;chocolate&quot; &#125;   &#125;,   &quot;sort&quot; : [      &#123;&quot;price&quot; : &#123;&quot;order&quot; : &quot;asc&quot;, &quot;mode&quot; : &quot;avg&quot;&#125;&#125;   ]&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="in-æˆ–è€…-not-in-æŸ¥è¯¢"><a href="#in-æˆ–è€…-not-in-æŸ¥è¯¢" class="headerlink" title="in æˆ–è€… not in æŸ¥è¯¢"></a>in æˆ–è€… not in æŸ¥è¯¢</h1><pre class="line-numbers language-none"><code class="language-none">GET &#x2F;kibana_sample_data_logs&#x2F;_search&#123;  &quot;query&quot;: &#123;    &quot;bool&quot;: &#123;    &#x2F;&#x2F; mustæ˜¯ï¼šin æŸ¥è¯¢ï¼Œmust_notï¼šæ˜¯ not in æŸ¥è¯¢      &quot;must&quot;: [        &#123;          &quot;terms&quot;: &#123;            &quot;clientip&quot;: [&quot;118.151.35.151&quot;, &quot;254.207.11.2&quot;]          &#125;        &#125;      ]    &#125;  &#125;,  &quot;sort&quot;: [    &#123;      &quot;utc_time&quot;: &#123;        &quot;order&quot;: &quot;desc&quot;      &#125;    &#125;  ],  &quot;from&quot;: 0, &quot;size&quot;: 20&#125;BoolQueryBuilder boolBuilder &#x3D; QueryBuilders.boolQuery();boolBuilder.must(QueryBuilders.matchPhraseQuery(&quot;param&quot;, &quot;1&quot;));boolBuilder.must(QueryBuilders.matchPhraseQuery(&quot;param&quot;, &quot;2&quot;));boolBuilder.must(QueryBuilders.matchPhraseQuery(&quot;param&quot;, &quot;3&quot;));<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="or-and-æ¡ä»¶æŸ¥è¯¢"><a href="#or-and-æ¡ä»¶æŸ¥è¯¢" class="headerlink" title="or and æ¡ä»¶æŸ¥è¯¢"></a>or and æ¡ä»¶æŸ¥è¯¢</h1><pre class="line-numbers language-none"><code class="language-none">1.mustæ–‡æ¡£ å¿…é¡» åŒ¹é…è¿™äº›æ¡ä»¶æ‰èƒ½è¢«åŒ…å«è¿›æ¥ã€‚ç›¸å½“äºsqlä¸­çš„ and2.must_notæ–‡æ¡£ å¿…é¡»ä¸ åŒ¹é…è¿™äº›æ¡ä»¶æ‰èƒ½è¢«åŒ…å«è¿›æ¥ã€‚ç›¸å½“äºsqlä¸­çš„ not3.shouldå¦‚æœæ»¡è¶³è¿™äº›è¯­å¥ä¸­çš„ä»»æ„è¯­å¥ï¼Œå°†å¢åŠ  _score ï¼Œå¦åˆ™ï¼Œæ— ä»»ä½•å½±å“ã€‚å®ƒä»¬ä¸»è¦ç”¨äºä¿®æ­£æ¯ä¸ªæ–‡æ¡£çš„ç›¸å…³æ€§å¾—åˆ†ã€‚ç›¸å½“äºsqlä¸­çš„or4.filterå¿…é¡» åŒ¹é…ï¼Œä½†å®ƒä»¥ä¸è¯„åˆ†ã€è¿‡æ»¤æ¨¡å¼æ¥è¿›è¡Œã€‚è¿™äº›è¯­å¥å¯¹è¯„åˆ†æ²¡æœ‰è´¡çŒ®ï¼Œåªæ˜¯æ ¹æ®è¿‡æ»¤æ ‡å‡†æ¥æ’é™¤æˆ–åŒ…å«æ–‡æ¡£ã€‚æ„é€ æŸ¥è¯¢æ¡ä»¶1. termQueryï¼šç²¾ç¡®æŸ¥è¯¢ï¼ˆä¸åˆ†è¯ï¼‰ä½¿ç”¨termQueryè¦æ³¨æ„çš„æ˜¯ï¼ŒElasticsearch5ä¹‹åï¼Œå–æ¶ˆäº†stringç±»å‹ï¼Œå°†åŸæ¥çš„stringç±»å‹æ‹†åˆ†ä¸ºtextå’Œkeywordä¸¤ç§ç±»å‹ï¼Œä»–ä»¬çš„åŒºåˆ«åœ¨äºtextä¼šå¯¹å­—æ®µè¿›è¡Œåˆ†è¯å¤„ç†ï¼Œè€Œkeywordåˆ™ä¸ä¼šã€‚2. matchQueryï¼šåŒ¹é…æŸ¥è¯¢ï¼ˆåˆ†è¯ï¼‰match queryæœç´¢çš„æ—¶å€™ï¼Œé¦–å…ˆä¼šè§£ææŸ¥è¯¢å­—ç¬¦ä¸²ï¼Œè¿›è¡Œåˆ†è¯ï¼Œç„¶åæŸ¥è¯¢ï¼Œæ‰€ä»¥å‡å¦‚æˆ‘æœç´¢çš„æ¡ä»¶è¾“å…¥çš„æ˜¯&quot;å…­å¹´çº§&quot;ï¼Œåˆ™ä¼šæŠŠå„ä¸ªå¹´çº§ï¼ˆä¸€å¹´çº§è‡³ä¹å¹´çº§ï¼‰çš„æ•°æ®éƒ½æŸ¥è¯¢å‡ºæ¥ï¼Œå› ä¸ºå…¶ä¸­éƒ½åŒ…å«â€™å¹´çº§â€™ ã€‚3. queryStringï¼šç²¾ç¡®æŸ¥è¯¢4. wildcardQueryï¼šæ¨¡ç³ŠæŸ¥è¯¢5. rangeQueryï¼šèŒƒå›´æŸ¥è¯¢<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="å¤šå­—æ®µæœç´¢"><a href="#å¤šå­—æ®µæœç´¢" class="headerlink" title="å¤šå­—æ®µæœç´¢"></a>å¤šå­—æ®µæœç´¢</h1><pre class="line-numbers language-none"><code class="language-none">GET &#x2F;kibana_sample_data_logs&#x2F;_search&#123;  &quot;query&quot;: &#123;    &quot;multi_match&quot;: &#123;      &quot;query&quot;: &quot;ä½ å¥½ www.elastic.co Chrome&quot;,      &quot;fields&quot;: [&quot;message&quot;, &quot;host&quot;]    &#125;  &#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="operator-å¯ä»¥è®¾ç½®ä¸º-or-é»˜è®¤-æˆ–è€…-and"><a href="#operator-å¯ä»¥è®¾ç½®ä¸º-or-é»˜è®¤-æˆ–è€…-and" class="headerlink" title="operator: å¯ä»¥è®¾ç½®ä¸º or(é»˜è®¤) æˆ–è€… and"></a>operator: å¯ä»¥è®¾ç½®ä¸º or(é»˜è®¤) æˆ–è€… and</h1><pre class="line-numbers language-none"><code class="language-none">å’Œåˆ†è¯æœ‰å…³ç³»ï¼šå¦‚ï¼šæ•°æ®æ˜¯ï¼šä¸‡é‡Œé•¿åŸçœŸä¼Ÿå¤§åˆ†è¯åï¼š[&quot;ä¸‡é‡Œé•¿åŸ&quot;, &quot;ä¸‡é‡Œ&quot;,&quot;ä¸‡&quot;,&quot;é‡Œé•¿&quot;,&quot;é‡Œ&quot;,&quot;é•¿åŸ&quot; ...]ä¸ºoræ—¶ï¼šç´¢å¼•åº“ä¸­ï¼Œåªè¦æ–‡æ¡£çš„contentè¿™ä¸ªå­—æ®µå†…å®¹åŒ…å«â€œä¸‡é‡Œé•¿åŸâ€ï¼Œâ€œé‡Œâ€ï¼Œâ€œçœŸâ€ï¼Œâ€œä¼Ÿå¤§â€ç­‰ä»»ä½•ä¸€ä¸ªåˆ†è¯ï¼Œè¯¥æ¡æ–‡æ¡£å°±ä¼šè¢«ç´¢å¼•åˆ°ã€‚ä¸ºandæ—¶ï¼šç´¢å¼•åº“ä¸­ï¼Œæ–‡æ¡£çš„contentè¿™ä¸ªå­—æ®µå¿…é¡»åŒ…å«â€œä¸‡é‡Œé•¿åŸâ€ï¼Œâ€œé‡Œâ€ï¼Œâ€œçœŸâ€ï¼Œâ€œä¼Ÿå¤§â€ç­‰æ‰€æœ‰åˆ†è¯ ï¼Œè¿™å°±æ˜¯andã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="java-api"><a href="#java-api" class="headerlink" title="java api"></a>java api</h1><p><a href="https://www.bbsmax.com/A/B0zqrrEZJv/">java api</a></p><h1 id="æ³¨æ„ç‚¹-RefreshPolicy"><a href="#æ³¨æ„ç‚¹-RefreshPolicy" class="headerlink" title="æ³¨æ„ç‚¹ RefreshPolicy"></a>æ³¨æ„ç‚¹ RefreshPolicy</h1><pre class="line-numbers language-none"><code class="language-none">é»˜è®¤æƒ…å†µä¸‹ElasticSearchç´¢å¼•çš„refresh_intervalä¸º1ç§’ï¼Œè¿™æ„å‘³ç€æ•°æ®å†™1ç§’æ‰å°±å¯ä»¥è¢«æœç´¢åˆ°ã€‚æ¯æ¬¡ç´¢å¼•refreshä¼šäº§ç”Ÿä¸€ä¸ªæ–°çš„ lucene æ®µï¼Œè¿™ä¼šå¯¼è‡´é¢‘ç¹çš„ segment merge è¡Œä¸ºï¼Œå¯¹ç³»ç»Ÿ CPU å’Œ IO å ç”¨éƒ½æ¯”è¾ƒé«˜ã€‚å¦‚æœäº§å“å¯¹äºå®æ—¶æ€§è¦æ±‚ä¸é«˜ï¼Œåˆ™å¯ä»¥é™ä½åˆ·æ–°å‘¨æœŸï¼Œå¦‚ï¼šindex.refresh_interval: 120sã€‚ä½†æ˜¯è¿™ç§ç‰¹æ€§å¯¹äºåŠŸèƒ½æµ‹è¯•æ¥è¯´æ¯”è¾ƒéº»çƒ¦ï¼šå› ä¸ºå®æ—¶æ€§ä¸èƒ½ä¿è¯ï¼Œæ‰€ä»¥æ¯æ¬¡æ’å…¥æµ‹è¯•æ•°æ®ä¹‹åï¼Œéƒ½éœ€è¦sleepä¸€æ®µæ—¶é—´ï¼Œæ‰èƒ½è¿›è¡Œæµ‹è¯•ã€‚å› ä¸ºå®æ—¶æ€§ä¸èƒ½ä¿è¯ï¼ŒåŠæ—¶é€šè¿‡sleepç­–ç•¥é€šè¿‡çš„caseï¼Œä¹Ÿå¯èƒ½å¶å°”å¤±è´¥ã€‚ä¸ºäº†è§£å†³ä¸Šè¿°é—®é¢˜ï¼Œéœ€è¦æä¾›ElasticSearchå¢åˆ æ”¹æ•°æ®ä¹‹åæ•°æ®ç«‹å³åˆ·æ–°çš„ç­–ç•¥ã€‚å¯çŸ¥æœ‰ä»¥ä¸‹ä¸‰ç§åˆ·æ–°ç­–ç•¥ï¼šRefreshPolicy#IMMEDIATE:è¯·æ±‚å‘ElasticSearchæäº¤äº†æ•°æ®ï¼Œç«‹å³è¿›è¡Œæ•°æ®åˆ·æ–°ï¼Œç„¶åå†ç»“æŸè¯·æ±‚ã€‚ä¼˜ç‚¹ï¼šå®æ—¶æ€§é«˜ã€æ“ä½œå»¶æ—¶çŸ­ã€‚ç¼ºç‚¹ï¼šèµ„æºæ¶ˆè€—é«˜ã€‚RefreshPolicy#WAIT_UNTIL:è¯·æ±‚å‘ElasticSearchæäº¤äº†æ•°æ®ï¼Œç­‰å¾…æ•°æ®å®Œæˆåˆ·æ–°ï¼Œç„¶åå†ç»“æŸè¯·æ±‚ã€‚ä¼˜ç‚¹ï¼šå®æ—¶æ€§é«˜ã€æ“ä½œå»¶æ—¶é•¿ã€‚ç¼ºç‚¹ï¼šèµ„æºæ¶ˆè€—ä½ã€‚RefreshPolicy#NONE:é»˜è®¤ç­–ç•¥ã€‚è¯·æ±‚å‘ElasticSearchæäº¤äº†æ•°æ®ï¼Œä¸å…³ç³»æ•°æ®æ˜¯å¦å·²ç»å®Œæˆåˆ·æ–°ï¼Œç›´æ¥ç»“æŸè¯·æ±‚ã€‚ä¼˜ç‚¹ï¼šæ“ä½œå»¶æ—¶çŸ­ã€èµ„æºæ¶ˆè€—ä½ã€‚ç¼ºç‚¹ï¼šå®æ—¶æ€§ä½updateRequest.setRefreshPolicy(WriteRequest.RefreshPolicy.WAIT_UNTIL);æ¯ç¬”500msä»¥ä¸Šï¼Œç‰¹åˆ«å½±å“æ€§èƒ½ã€‚å°½é‡ä¸è¦ä½¿ç”¨<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> elasticsearch </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>elasticsearché‡è¦çš„è®¾ç½®</title>
      <link href="/2022/06/27/elasticsearch-setting/"/>
      <url>/2022/06/27/elasticsearch-setting/</url>
      
        <content type="html"><![CDATA[<h1 id="1-å †å¤§å°æ£€æŸ¥"><a href="#1-å †å¤§å°æ£€æŸ¥" class="headerlink" title="1. å †å¤§å°æ£€æŸ¥"></a>1. å †å¤§å°æ£€æŸ¥</h1><blockquote><p>å¦‚æœ JVM ä»¥ä¸ç›¸ç­‰çš„åˆå§‹å †å¤§å°å’Œæœ€å¤§å †å¤§å°å¯åŠ¨ï¼Œåˆ™åœ¨ç³»ç»Ÿä½¿ç”¨æœŸé—´è°ƒæ•´ JVM å †çš„å¤§å°æ—¶ï¼Œå®ƒå¾ˆå®¹æ˜“å‡ºç°æš‚åœã€‚ä¸ºé¿å…è¿™äº›è°ƒæ•´å¤§å°æš‚åœï¼Œæœ€å¥½åœ¨åˆå§‹å †å¤§å°ç­‰äºæœ€å¤§å †å¤§å°çš„æƒ…å†µä¸‹å¯åŠ¨ JVMã€‚æ­¤å¤–ï¼Œå¦‚æœ bootstrap.memory_lockå¯ç”¨ï¼ŒJVM å°†åœ¨å¯åŠ¨æ—¶é”å®šå †çš„åˆå§‹å¤§å°ã€‚å¦‚æœåˆå§‹å †å¤§å°ä¸ç­‰äºæœ€å¤§å †å¤§å°ï¼Œåˆ™åœ¨è°ƒæ•´å¤§å°åï¼Œæ‰€æœ‰ JVM å †éƒ½ä¸ä¼šé”å®šåœ¨å†…å­˜ä¸­ã€‚è¦é€šè¿‡å †å¤§å°æ£€æŸ¥ï¼Œæ‚¨å¿…é¡»é…ç½®å †å¤§å°ã€‚<br>-xms: 1g &#x2F;&#x2F; æœ€å°å †å†…å­˜<br>-xmx: 1g &#x2F;&#x2F; æœ€å¤§å †å†…å­˜</p></blockquote><h1 id="2-æ–‡ä»¶æè¿°ç¬¦"><a href="#2-æ–‡ä»¶æè¿°ç¬¦" class="headerlink" title="2. æ–‡ä»¶æè¿°ç¬¦"></a>2. æ–‡ä»¶æè¿°ç¬¦</h1><blockquote><p>Elasticsearch éœ€è¦å¤§é‡æ–‡ä»¶æè¿°ç¬¦ï¼ˆä¾‹å¦‚ï¼Œæ¯ä¸ªåˆ†ç‰‡ç”±å¤šä¸ªæ®µå’Œå…¶ä»–æ–‡ä»¶ç»„æˆï¼ŒåŠ ä¸Šä¸å…¶ä»–èŠ‚ç‚¹çš„è¿æ¥ç­‰ï¼‰ã€‚æ­¤å¼•å¯¼æ£€æŸ¥åœ¨ OS X å’Œ Linux ä¸Šå¼ºåˆ¶æ‰§è¡Œã€‚è¦é€šè¿‡æ–‡ä»¶æè¿°ç¬¦æ£€æŸ¥ï¼Œæ‚¨å¯èƒ½å¿…é¡»é…ç½®æ–‡ä»¶æè¿°ç¬¦ã€‚<br><a href="https://blog.csdn.net/qq_32348883/article/details/124265412">https://blog.csdn.net/qq_32348883/article/details/124265412</a><br>ulimit -n 65535</p></blockquote><h1 id="3-å†…å­˜é”å®šæ£€æŸ¥"><a href="#3-å†…å­˜é”å®šæ£€æŸ¥" class="headerlink" title="3. å†…å­˜é”å®šæ£€æŸ¥"></a>3. å†…å­˜é”å®šæ£€æŸ¥</h1><blockquote><p>å½“ JVM è¿›è¡Œä¸»è¦çš„åƒåœ¾å›æ”¶æ—¶ï¼Œå®ƒä¼šè§¦åŠå †çš„æ¯ä¸€é¡µã€‚å¦‚æœè¿™äº›é¡µé¢ä¸­çš„ä»»ä½•ä¸€ä¸ªè¢«æ¢å‡ºåˆ°ç£ç›˜ï¼Œåˆ™å¿…é¡»å°†å®ƒä»¬æ¢å›å†…å­˜ã€‚è¿™ä¼šå¯¼è‡´å¤§é‡ç£ç›˜æŠ–åŠ¨ï¼Œè€Œ Elasticsearch æ›´æ„¿æ„ä½¿ç”¨å®ƒæ¥æœåŠ¡è¯·æ±‚ã€‚æœ‰å‡ ç§æ–¹æ³•å¯ä»¥é…ç½®ç³»ç»Ÿä»¥ç¦æ­¢äº¤æ¢ã€‚ä¸€ç§æ–¹æ³•æ˜¯è¯·æ±‚ JVM é€šè¿‡mlockall(Unix) æˆ–è™šæ‹Ÿé” (Windows) å°†å †é”å®šåœ¨å†…å­˜ä¸­ã€‚è¿™æ˜¯é€šè¿‡ Elasticsearch è®¾ç½®å®Œæˆçš„ bootstrap.memory_lockã€‚ä½†æ˜¯ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå¯ä»¥å°†æ­¤è®¾ç½®ä¼ é€’ç»™ Elasticsearchï¼Œä½† Elasticsearch æ— æ³•é”å®šå †ï¼ˆä¾‹å¦‚ï¼Œå¦‚æœelasticsearch ç”¨æˆ·æ²¡æœ‰memlock unlimited. å†…å­˜é”æ£€æŸ¥éªŒè¯æ˜¯å¦bootstrap.memory_lockè®¾ç½®å·²å¯ç”¨ï¼ŒJVM å·²æˆåŠŸé”å®šå †ã€‚è¦é€šè¿‡å†…å­˜é”å®šæ£€æŸ¥ï¼Œæ‚¨å¯èƒ½å¿…é¡»é…ç½®<br>bootstrap.memory_lock</p></blockquote><h1 id="4-æœ€å¤§çº¿ç¨‹æ•°è®¾ç½®"><a href="#4-æœ€å¤§çº¿ç¨‹æ•°è®¾ç½®" class="headerlink" title="4. æœ€å¤§çº¿ç¨‹æ•°è®¾ç½®"></a>4. æœ€å¤§çº¿ç¨‹æ•°è®¾ç½®</h1><blockquote><p>Elasticsearch é€šè¿‡å°†è¯·æ±‚åˆ†è§£ä¸ºå¤šä¸ªé˜¶æ®µå¹¶å°†è¿™äº›é˜¶æ®µäº¤ç»™ä¸åŒçš„çº¿ç¨‹æ± æ‰§è¡Œå™¨æ¥æ‰§è¡Œè¯·æ±‚ã€‚Elasticsearch ä¸­çš„å„ç§ä»»åŠ¡éƒ½æœ‰ä¸åŒçš„çº¿ç¨‹æ± æ‰§è¡Œå™¨ã€‚å› æ­¤ï¼ŒElasticsearch éœ€è¦èƒ½å¤Ÿåˆ›å»ºå¤§é‡çº¿ç¨‹ã€‚æœ€å¤§çº¿ç¨‹æ•°æ£€æŸ¥ç¡®ä¿ Elasticsearch è¿›ç¨‹åœ¨æ­£å¸¸ä½¿ç”¨æƒ…å†µä¸‹æœ‰æƒåˆ›å»ºè¶³å¤Ÿå¤šçš„çº¿ç¨‹ã€‚æ­¤æ£€æŸ¥ä»…åœ¨ Linux ä¸Šå¼ºåˆ¶æ‰§è¡Œã€‚å¦‚æœæ‚¨åœ¨ Linux ä¸Šï¼Œè¦é€šè¿‡æœ€å¤§çº¿ç¨‹æ•°æ£€æŸ¥ï¼Œæ‚¨å¿…é¡»é…ç½®æ‚¨çš„ç³»ç»Ÿä»¥å…è®¸ Elasticsearch è¿›ç¨‹èƒ½å¤Ÿåˆ›å»ºè‡³å°‘ <strong>4096</strong> ä¸ªçº¿ç¨‹ã€‚è¿™å¯ä»¥é€šè¿‡&#x2F;etc&#x2F;security&#x2F;limits.conf ä½¿ç”¨nprocè®¾ç½®æ¥å®Œæˆ<br>ulimit -u 4096</p></blockquote><h1 id="5-æ–‡ä»¶å¤§å°è®¾ç½®"><a href="#5-æ–‡ä»¶å¤§å°è®¾ç½®" class="headerlink" title="5. æ–‡ä»¶å¤§å°è®¾ç½®"></a>5. æ–‡ä»¶å¤§å°è®¾ç½®</h1><blockquote><p>ä½œä¸ºå•ä¸ªåˆ†ç‰‡ç»„ä»¶çš„æ®µæ–‡ä»¶å’Œä½œä¸º translog ç»„ä»¶çš„ translog ç”Ÿæˆå¯èƒ½ä¼šå˜å¾—å¾ˆå¤§ï¼ˆè¶…è¿‡æ•° GBï¼‰ã€‚åœ¨ Elasticsearch è¿›ç¨‹å¯ä»¥åˆ›å»ºçš„æœ€å¤§æ–‡ä»¶å¤§å°å—åˆ°é™åˆ¶çš„ç³»ç»Ÿä¸Šï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´å†™å…¥å¤±è´¥ã€‚å› æ­¤ï¼Œè¿™é‡Œæœ€å®‰å…¨çš„é€‰æ‹©æ˜¯æœ€å¤§æ–‡ä»¶å¤§å°æ˜¯æ— é™çš„ï¼Œè¿™å°±æ˜¯æœ€å¤§æ–‡ä»¶å¤§å°å¼•å¯¼æ£€æŸ¥æ‰€å¼ºåˆ¶æ‰§è¡Œçš„ã€‚è¦é€šè¿‡æœ€å¤§æ–‡ä»¶æ£€æŸ¥ï¼Œæ‚¨å¿…é¡»å°†ç³»ç»Ÿé…ç½®ä¸ºå…è®¸ Elasticsearch è¿›ç¨‹å†™å…¥æ— é™å¤§å°çš„æ–‡ä»¶ã€‚è¿™å¯ä»¥é€šè¿‡ &#x2F;etc&#x2F;security&#x2F;limits.confä½¿ç”¨fsizeè®¾ç½®æ¥å®Œæˆunlimited</p></blockquote><h1 id="6-æœ€å¤§å¤§å°è™šæ‹Ÿå†…å­˜æ£€æŸ¥"><a href="#6-æœ€å¤§å¤§å°è™šæ‹Ÿå†…å­˜æ£€æŸ¥" class="headerlink" title="6. æœ€å¤§å¤§å°è™šæ‹Ÿå†…å­˜æ£€æŸ¥"></a>6. æœ€å¤§å¤§å°è™šæ‹Ÿå†…å­˜æ£€æŸ¥</h1><blockquote><p>Elasticsearch å’Œ Lucene ç”¨äºmmapå°†ç´¢å¼•çš„ä¸€éƒ¨åˆ†æ˜ å°„åˆ° Elasticsearch åœ°å€ç©ºé—´ï¼Œæ•ˆæœéå¸¸å¥½ã€‚è¿™ä½¿æŸäº›ç´¢å¼•æ•°æ®è¿œç¦» JVM å †ï¼Œä½†åœ¨å†…å­˜ä¸­ä»¥å®ç°æå¿«çš„è®¿é—®ã€‚ä¸ºä½¿å…¶æœ‰æ•ˆï¼ŒElasticsearch åº”å…·æœ‰æ— é™çš„åœ°å€ç©ºé—´ã€‚æœ€å¤§å¤§å°è™šæ‹Ÿå†…å­˜æ£€æŸ¥å¼ºåˆ¶ Elasticsearch è¿›ç¨‹å…·æœ‰æ— é™çš„åœ°å€ç©ºé—´ï¼Œå¹¶ä¸”ä»…åœ¨ Linux ä¸Šå¼ºåˆ¶æ‰§è¡Œã€‚è¦é€šè¿‡æœ€å¤§å¤§å°è™šæ‹Ÿå†…å­˜æ£€æŸ¥ï¼Œæ‚¨å¿…é¡»å°†ç³»ç»Ÿé…ç½®ä¸ºå…è®¸ Elasticsearch è¿›ç¨‹æ‹¥æœ‰æ— é™åœ°å€ç©ºé—´çš„èƒ½åŠ›ã€‚è¿™å¯ä»¥é€šè¿‡&#x2F;etc&#x2F;security&#x2F;limits.confä½¿ç”¨asè®¾ç½®æ¥å®Œæˆunlimited</p></blockquote><h1 id="7-max-map-countæ–‡ä»¶åŒ…å«é™åˆ¶ä¸€ä¸ªè¿›ç¨‹å¯ä»¥æ‹¥æœ‰çš„VMA-è™šæ‹Ÿå†…å­˜åŒºåŸŸ-çš„æ•°é‡"><a href="#7-max-map-countæ–‡ä»¶åŒ…å«é™åˆ¶ä¸€ä¸ªè¿›ç¨‹å¯ä»¥æ‹¥æœ‰çš„VMA-è™šæ‹Ÿå†…å­˜åŒºåŸŸ-çš„æ•°é‡" class="headerlink" title="7. max_map_countæ–‡ä»¶åŒ…å«é™åˆ¶ä¸€ä¸ªè¿›ç¨‹å¯ä»¥æ‹¥æœ‰çš„VMA(è™šæ‹Ÿå†…å­˜åŒºåŸŸ)çš„æ•°é‡"></a>7. max_map_countæ–‡ä»¶åŒ…å«é™åˆ¶ä¸€ä¸ªè¿›ç¨‹å¯ä»¥æ‹¥æœ‰çš„VMA(è™šæ‹Ÿå†…å­˜åŒºåŸŸ)çš„æ•°é‡</h1><blockquote><p>Elasticsearch è¿˜éœ€è¦èƒ½å¤Ÿåˆ›å»ºè®¸å¤šå†…å­˜æ˜ å°„åŒºåŸŸã€‚æœ€å¤§æ˜ å°„è®¡æ•°æ£€æŸ¥æ£€æŸ¥å†…æ ¸æ˜¯å¦å…è®¸è¿›ç¨‹å…·æœ‰è‡³å°‘ 262,144 ä¸ªå†…å­˜æ˜ å°„åŒºåŸŸï¼Œå¹¶ä¸”ä»…åœ¨ Linux ä¸Šå¼ºåˆ¶æ‰§è¡Œã€‚è¦é€šè¿‡æœ€å¤§åœ°å›¾è®¡æ•°æ£€æŸ¥ï¼Œæ‚¨å¿…é¡»å°†vm.max_map_count é…ç½® sysctl ä¸ºè‡³å°‘262144.</p></blockquote><h1 id="8-ç³»ç»Ÿè°ƒç”¨è¿‡æ»¤æ£€æŸ¥"><a href="#8-ç³»ç»Ÿè°ƒç”¨è¿‡æ»¤æ£€æŸ¥" class="headerlink" title="8. ç³»ç»Ÿè°ƒç”¨è¿‡æ»¤æ£€æŸ¥"></a>8. ç³»ç»Ÿè°ƒç”¨è¿‡æ»¤æ£€æŸ¥</h1><blockquote><p>Elasticsearch ä¼šæ ¹æ®æ“ä½œç³»ç»Ÿï¼ˆä¾‹å¦‚ï¼ŒLinux ä¸Šçš„ seccompï¼‰å®‰è£…å„ç§é£æ ¼çš„ç³»ç»Ÿè°ƒç”¨è¿‡æ»¤å™¨ã€‚å®‰è£…è¿™äº›ç³»ç»Ÿè°ƒç”¨è¿‡æ»¤å™¨æ˜¯ä¸ºäº†é˜²æ­¢æ‰§è¡Œä¸åˆ†å‰ç›¸å…³çš„ç³»ç»Ÿè°ƒç”¨ï¼Œä»¥æ­¤ä½œä¸ºé˜²å¾¡æœºåˆ¶æ¥æŠµå¾¡å¯¹ Elasticsearch çš„ä»»æ„ä»£ç æ‰§è¡Œæ”»å‡»ã€‚ç³»ç»Ÿè°ƒç”¨è¿‡æ»¤å™¨æ£€æŸ¥ç¡®ä¿å¦‚æœå¯ç”¨äº†ç³»ç»Ÿè°ƒç”¨è¿‡æ»¤å™¨ï¼Œåˆ™å®ƒä»¬å·²æˆåŠŸå®‰è£…ã€‚è¦é€šè¿‡ç³»ç»Ÿè°ƒç”¨è¿‡æ»¤å™¨æ£€æŸ¥ï¼Œæ‚¨å¿…é¡»ä¿®å¤ç³»ç»Ÿä¸Šé˜»æ­¢ç³»ç»Ÿè°ƒç”¨è¿‡æ»¤å™¨å®‰è£…çš„ä»»ä½•é…ç½®é”™è¯¯ï¼ˆæ£€æŸ¥æ‚¨çš„æ—¥å¿—ï¼‰ï¼Œæˆ–è€…é€šè¿‡è®¾ç½®ä¸ºæ¥è‡ªè¡Œæ‰¿æ‹…ç¦ç”¨ç³»ç»Ÿè°ƒç”¨è¿‡æ»¤å™¨çš„é£é™©ã€‚bootstrap.system_call_filter: false</p></blockquote><h1 id="9-elasticsearch-yml"><a href="#9-elasticsearch-yml" class="headerlink" title="9. elasticsearch.yml"></a>9. elasticsearch.yml</h1><table><thead><tr><th>é…ç½®key</th><th>é…ç½®value</th><th>è¯´æ˜</th><th>example</th></tr></thead><tbody><tr><td>path.logs</td><td>&#x2F;var&#x2F;log&#x2F;elasticsearch</td><td>æ—¥å¿—ä¿å­˜çš„æ–‡ä»¶è·¯å¾„</td><td></td></tr><tr><td>path.data</td><td>&#x2F;var&#x2F;data&#x2F;elasticsearch</td><td>æ•°æ®ä¿å­˜çš„æ–‡ä»¶è·¯å¾„</td><td></td></tr><tr><td><a href="http://cluster.name/">cluster.name</a></td><td>myes</td><td>é›†ç¾¤åç§°</td><td></td></tr><tr><td><a href="http://node.name/">node.name</a></td><td>node1</td><td>èŠ‚ç‚¹åç§°</td><td>node.name&#x3D;${} HOSTNAME</td></tr><tr><td>network.host</td><td>192.168.1.1</td><td>ç½‘ç»œIPè®¾ç½®</td><td></td></tr><tr><td>discovery.zen.ping.unicast.hosts</td><td>[â€œ192.168.1.11â€,â€œ192.168.1.12â€,â€œ192.168.1.13â€]</td><td>é›†ç¾¤å‘ç°å…¶ä»–èŠ‚ç‚¹æœºå™¨é…ç½®</td><td></td></tr><tr><td>discovery.zen.minimum_master_nodes</td><td>2</td><td>é¿å…è„‘è£‚è®¾ç½®ï¼Œè®¾ç½®å½¢æˆé›†ç¾¤æœ€å°‘éœ€è¦çš„ç¥¨æ•°ã€‚è®¡ç®—å…¬å¼ï¼š(master_eligible_nodes &#x2F; 2) + 1 å¿…é¡»è¶…è¿‡æ‰€æœ‰æœºå™¨çš„ä¸€åŠ</td><td></td></tr></tbody></table><h1 id="10-jvm-options"><a href="#10-jvm-options" class="headerlink" title="10. jvm.options"></a>10. jvm.options</h1><pre class="line-numbers language-none"><code class="language-none">è®¾ç½®Xmså’ŒXmxä¸è¶…è¿‡ç‰©ç† RAM çš„ 50%ï¼Œä»¥ç¡®ä¿æœ‰è¶³å¤Ÿçš„ç‰©ç† RAM ç•™ç»™å†…æ ¸æ–‡ä»¶ç³»ç»Ÿç¼“å­˜ã€‚- Xms2g - Xmx2gè¯·æ³¨æ„ï¼ŒElasticsearch é™„å¸¦çš„é»˜è®¤ JVM é…ç½®å°† Elasticsearch é…ç½®ä¸ºä½¿ç”¨ CMS æ”¶é›†å™¨ã€‚-XX:+UseSerialGC<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> elasticsearch </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>elasticsearch8.2é›†ç¾¤å®‰è£…éƒ¨ç½²</title>
      <link href="/2022/05/18/elasticsearch8-2-install/"/>
      <url>/2022/05/18/elasticsearch8-2-install/</url>
      
        <content type="html"><![CDATA[<h1 id="1-ä¸‹è½½"><a href="#1-ä¸‹è½½" class="headerlink" title="- 1. ä¸‹è½½"></a>- 1. ä¸‹è½½</h1><pre class="line-numbers language-none"><code class="language-none">[elasticsearchä¸‹è½½åœ°å€](https:&#x2F;&#x2F;www.elastic.co&#x2F;start)[elasticsearchä¸‹è½½åœ°å€](https:&#x2F;&#x2F;www.elastic.co&#x2F;downloads&#x2F;elasticsearch)[elasticsearchç‰ˆæœ¬æ”¯æŒ](https:&#x2F;&#x2F;www.elastic.co&#x2F;support&#x2F;matrix)[elastic8.2 æ–‡æ¡£](https:&#x2F;&#x2F;www.elastic.co&#x2F;guide&#x2F;en&#x2F;elasticsearch&#x2F;reference&#x2F;8.2&#x2F;index.html)[ä¸­æ–‡æ–‡æ¡£ï¼ˆæœ‰äº›ä¸œè¥¿å¯èƒ½è¿‡æ—¶ï¼‰](https:&#x2F;&#x2F;www.elastic.co&#x2F;guide&#x2F;cn&#x2F;elasticsearch&#x2F;guide&#x2F;current&#x2F;index.html)[elasticsearchæ¦‚å¿µä»‹ç»](http:&#x2F;&#x2F;t.zoukankan.com&#x2F;kevingrace-p-10682264.html)[è¿ç»´æŒ‡å—](https:&#x2F;&#x2F;cloud.tencent.com&#x2F;developer&#x2F;article&#x2F;1836799)[å®¢æˆ·ç«¯](https:&#x2F;&#x2F;www.elastic.co&#x2F;guide&#x2F;en&#x2F;elasticsearch&#x2F;client&#x2F;index.html)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="2-é›†ç¾¤é…ç½®æ–‡ä»¶"><a href="#2-é›†ç¾¤é…ç½®æ–‡ä»¶" class="headerlink" title="- 2. é›†ç¾¤é…ç½®æ–‡ä»¶"></a>- 2. é›†ç¾¤é…ç½®æ–‡ä»¶</h1><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">cluster.name</span><span class="token punctuation">:</span> myes<span class="token key atrule">node.name</span><span class="token punctuation">:</span> node<span class="token punctuation">-</span><span class="token number">1</span><span class="token key atrule">network.host</span><span class="token punctuation">:</span> 127.0.0.1<span class="token comment">#transport.tcp.port: 9300</span><span class="token key atrule">http.port</span><span class="token punctuation">:</span> <span class="token number">9200</span><span class="token key atrule">http.cors.enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span><span class="token key atrule">http.cors.allow-origin</span><span class="token punctuation">:</span> <span class="token string">"*"</span><span class="token key atrule">discovery.seed_hosts</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"127.0.0.1:9300"</span><span class="token punctuation">,</span> <span class="token string">"127.0.0.1:9301"</span><span class="token punctuation">,</span><span class="token string">"127.0.0.1:9302"</span><span class="token punctuation">]</span><span class="token key atrule">cluster.initial_master_nodes</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"127.0.0.1:9300"</span><span class="token punctuation">,</span> <span class="token string">"127.0.0.1:9301"</span><span class="token punctuation">,</span><span class="token string">"127.0.0.1:9302"</span><span class="token punctuation">]</span><span class="token key atrule">path.data</span><span class="token punctuation">:</span> ./data<span class="token key atrule">path.logs</span><span class="token punctuation">:</span> ./logs<span class="token comment"># ä¸éœ€è¦è®¤è¯è®¾ç½®æˆ false </span><span class="token key atrule">xpack.security.enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span><span class="token key atrule">xpack.security.transport.ssl.enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span><span class="token key atrule">xpack.security.transport.ssl.verification_mode</span><span class="token punctuation">:</span> certificate<span class="token comment"># è¯ä¹¦çš„ä½ç½®</span><span class="token key atrule">xpack.security.transport.ssl.keystore.path</span><span class="token punctuation">:</span> certs/elastic<span class="token punctuation">-</span>certificates.p12<span class="token key atrule">xpack.security.transport.ssl.truststore.path</span><span class="token punctuation">:</span> certs/elastic<span class="token punctuation">-</span>certificates.p12æ³¨æ„ ï¼šåœ¨ä¸€å°æœºå™¨ä¸Šç”Ÿæˆ elastic<span class="token punctuation">-</span>certificates.p12 åï¼Œå°†æ–‡ä»¶å¤åˆ¶åˆ°å…¶ä»–æœºå™¨ä¸Šä¸èƒ½é‡æ–°ç”Ÿæˆ<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="3-é›†ç¾¤è®¤è¯è®¾ç½®"><a href="#3-é›†ç¾¤è®¤è¯è®¾ç½®" class="headerlink" title="- 3. é›†ç¾¤è®¤è¯è®¾ç½®"></a>- 3. é›†ç¾¤è®¤è¯è®¾ç½®</h1><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml">1. é…ç½®æ–‡ä»¶éœ€è®¾ç½®<span class="token key atrule">xpack.security.enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span><span class="token key atrule">xpack.security.transport.ssl.enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span><span class="token key atrule">xpack.security.transport.ssl.verification_mode</span><span class="token punctuation">:</span> certificate<span class="token key atrule">xpack.security.transport.ssl.keystore.path</span><span class="token punctuation">:</span> certs/elastic<span class="token punctuation">-</span>certificates.p12<span class="token key atrule">xpack.security.transport.ssl.truststore.path</span><span class="token punctuation">:</span> certs/elastic<span class="token punctuation">-</span>certificates.p122. ç”Ÿæˆé€šè®¯è¯ä¹¦./bin/elasticsearch<span class="token punctuation">-</span>certutil ca./bin/elasticsearch<span class="token punctuation">-</span>certutil cert <span class="token punctuation">-</span><span class="token punctuation">-</span>ca elastic<span class="token punctuation">-</span>stack<span class="token punctuation">-</span>ca.p12mkdir config/certsmv <span class="token important">*.p12</span> config/certs3. æ‰€æœ‰èŠ‚ç‚¹è®¾ç½®èŠ‚ç‚¹é€šä¿¡å¯†ç ï¼ˆå› æ¯ä¸ªèŠ‚ç‚¹ä½¿ç”¨ç›¸åŒçš„è¯ä¹¦æ–‡ä»¶ï¼‰å¿…é¡»è®¾ç½®æ‰€æœ‰é›†ç¾¤çš„è¯ä¹¦å¯†ç ./bin/elasticsearch<span class="token punctuation">-</span>keystore add xpack.security.transport.ssl.keystore.secure_password./bin/elasticsearch<span class="token punctuation">-</span>keystore add xpack.security.transport.ssl.truststore.secure_password4. è®¾ç½®è´¦å·å¯†ç ï¼Œelastic é›†ç¾¤å†…ç½®çš„ä¸€äº›è´¦å·å¯†ç ./bin/elasticsearch<span class="token punctuation">-</span>setup<span class="token punctuation">-</span>passwords interactive<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="4-java-lang-RuntimeException-can-not-run-elasticsearch-as-root"><a href="#4-java-lang-RuntimeException-can-not-run-elasticsearch-as-root" class="headerlink" title="- 4. java.lang.RuntimeException: can not run elasticsearch as root"></a>- 4. java.lang.RuntimeException: can not run elasticsearch as root</h1><pre class="line-numbers language-base" data-language="base"><code class="language-base">groupadd elasticuseradd elastic -g elasticpasswd elasticchown -R elastic:elastic elasticsearch-8.2.0su elastic.&#x2F;bin&#x2F;elasticsearch<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="5-org-elasticsearch-ElasticsearchException-Failure-running-machine-learning-native-code-This-could-be-due-to-running-on-an-unsupported-OS-or-distribution-missing-OS-libraries-or-a-problem-with-the-temp-directory-To-bypass-this-problem-by-running-Elasticsearch-without-machine-learning-functionality-set-xpack-ml-enabled-false"><a href="#5-org-elasticsearch-ElasticsearchException-Failure-running-machine-learning-native-code-This-could-be-due-to-running-on-an-unsupported-OS-or-distribution-missing-OS-libraries-or-a-problem-with-the-temp-directory-To-bypass-this-problem-by-running-Elasticsearch-without-machine-learning-functionality-set-xpack-ml-enabled-false" class="headerlink" title="- 5. org.elasticsearch.ElasticsearchException: Failure running machine learning native code. This could be due to running on an unsupported OS or distribution, missing OS libraries, or a problem with the temp directory. To bypass this problem by running Elasticsearch without machine learning functionality set [xpack.ml.enabled: false]."></a>- 5. org.elasticsearch.ElasticsearchException: Failure running machine learning native code. This could be due to running on an unsupported OS or distribution, missing OS libraries, or a problem with the temp directory. To bypass this problem by running Elasticsearch without machine learning functionality set [xpack.ml.enabled: false].</h1><pre class="line-numbers language-none"><code class="language-none">ç¼–è¾‘ï¼šconfig\elasticsearch.ymlå¢åŠ é…ç½®ï¼šxpack.ml.enabled: false<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h1 id="6-bootstrap-check-failure-1-of-2-max-virtual-memory-areas-vm-max-map-count-65530-is-too-low-increase-to-at-least-262144"><a href="#6-bootstrap-check-failure-1-of-2-max-virtual-memory-areas-vm-max-map-count-65530-is-too-low-increase-to-at-least-262144" class="headerlink" title="- 6. bootstrap check failure [1] of [2]: max virtual memory areas vm.max_map_count [65530] is too low, increase to at least [262144]"></a>- 6. bootstrap check failure [1] of [2]: max virtual memory areas vm.max_map_count [65530] is too low, increase to at least [262144]</h1><pre class="line-numbers language-none"><code class="language-none">ä¿®æ”¹ï¼šsysctl -w vm.max_map_count&#x3D;262144æŸ¥çœ‹ï¼šsysctl -a | grep vm.max_map_count<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h1 id="7-bootstrap-check-failure-1-of-1-system-call-filters-failed-to-install-check-the-logs-and-fix-your-configuration"><a href="#7-bootstrap-check-failure-1-of-1-system-call-filters-failed-to-install-check-the-logs-and-fix-your-configuration" class="headerlink" title="- 7. bootstrap check failure [1] of [1]: system call filters failed to install; check the logs and fix your configuration"></a>- 7. bootstrap check failure [1] of [1]: system call filters failed to install; check the logs and fix your configuration</h1><pre class="line-numbers language-none"><code class="language-none">ä¿®æ”¹ï¼š config\elasticsearch.ymlbootstrap.memory_lock: falsebootstrap.system_call_filter: false<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h1 id="8-æŸ¥è¯¢-ES-é›†ç¾¤çŠ¶æ€"><a href="#8-æŸ¥è¯¢-ES-é›†ç¾¤çŠ¶æ€" class="headerlink" title="- 8. æŸ¥è¯¢ ES é›†ç¾¤çŠ¶æ€"></a>- 8. æŸ¥è¯¢ ES é›†ç¾¤çŠ¶æ€</h1><p><a href="https://www.cnblogs.com/aping-blog/p/16066928.html">https://www.cnblogs.com/aping-blog/p/16066928.html</a></p><p><a href="/archives/elasticsearch-zhong-yao-de-she-zhi" title="elasticsearché‡è¦çš„è®¾ç½®">ä¸Šä¸€ç¯‡ </a><a href="/archives/oauth2jwt" title="oauth2 jwt">ä¸‹ä¸€ç¯‡</a></p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> elasticsearch </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>quartzå¯åŠ¨æ‰§è¡Œæµç¨‹</title>
      <link href="/2022/03/04/quartz-workflow/"/>
      <url>/2022/03/04/quartz-workflow/</url>
      
        <content type="html"><![CDATA[<p>spring æ•´åˆ quartz åˆå§‹åŒ–æ‰§è¡Œæµç¨‹, å†™çš„ä¸æ˜¯ä¸€èˆ¬ä¹±</p><blockquote><p>SchedulerFactoryBean.afterPropertiesSet()<br>-&gt; prepareSchedulerFactory()<br>-&gt; initSchedulerFactory() åˆå§‹åŒ–StdSchedulerFactory<br>-&gt; prepareScheduler(SchedulerFactory schedulerFactory)<br>-&gt; createScheduler() åˆ›å»ºè°ƒåº¦å™¨<br>-&gt; StdSchedulerFactory.getScheduler()<br>-&gt; instantiate()</p></blockquote><ol><li>åˆå§‹åŒ– è¯»å– quartz.properties ä¸­çš„é…ç½®</li><li>å®ä¾‹åŒ– QuartzSchedulerResources -&gt;<br>a. åˆå§‹åŒ– JobStore ï¼ˆJobStoreSupportï¼‰<br>b. åˆå§‹åŒ– SimpleThreadPool -&gt; initialize()<br>â€¦ ç­‰ç­‰å…¶ä»–ä¿¡æ¯</li><li>å®ä¾‹åŒ– QuartzScheduler<br>a. å®ä¾‹åŒ– QuartzSchedulerThread<br>b. QuartzSchedulerResources.getThreadExecutor().execute(QuartzSchedulerThread)<br>b1. QuartzSchedulerThread.run() -&gt; getJobStore().acquireNextTriggers() è·å–å¯ä»¥æ‰§è¡Œçš„è§¦å‘å™¨ -&gt; æ ¹æ®è§¦å‘å™¨è·å–jobçš„è¯¦ç»†ä¿¡æ¯ getJobStore().triggersFired(triggers) å°è£…æˆå¯¹è±¡ TriggerFiredResult -&gt; TriggerFiredBundle<br>b2. æ ¹æ® TriggerFiredBundle åˆ›å»ºä»»åŠ¡æ‰§è¡Œè„šæœ¬ -&gt; getJobRunShellFactory().createJobRunShell(TriggerFiredBundle); -&gt; shell.initialize(this.qs);<br>b3. å°†ä»»åŠ¡æ·»åŠ è¿›WorkerThreadï¼š getThreadPool().runInThread(shell)<br>b4. æ‰§è¡Œå…·ä½“ä»»åŠ¡ï¼šJobRunShell.run() -&gt; è·å– JobDetail</li></ol><p>-&gt; SchedulerFactoryBean.start() ä»€ä¹ˆæ—¶æœºè§¦å‘startï¼š SchedulerFactoryBean å®ç°äº† SmartLifecycle æ¥å£, åœ¨ spring å®¹å™¨åˆå§‹åŒ–å®Œæˆåï¼Œä¼šè°ƒç”¨ AbstractApplicationContext.finishRefresh()<br>-&gt; ClusterManager.initialize() -&gt; this.manage() -&gt; run()</p><h3 id="é—®é¢˜1-å‰é¢åˆå§‹åŒ–æ˜¯å°±å·²ç»æäº¤å¦ä¸€ä¸ªçº¿ç¨‹-QuartzSchedulerResources-getThreadExecutor-execute-QuartzSchedulerThread-æ‰§è¡Œäº†å»æ•°æ®åº“æ‰«æä»»åŠ¡ä½†æ˜¯å…¶å®è¿˜æœ‰å¾ˆå¤šä¸œè¥¿æ²¡æœ‰åˆå§‹åŒ–å®Œï¼Œè¿™ä¸ªæ˜¯æ€ä¹ˆå¤„ç†çš„ï¼Ÿ"><a href="#é—®é¢˜1-å‰é¢åˆå§‹åŒ–æ˜¯å°±å·²ç»æäº¤å¦ä¸€ä¸ªçº¿ç¨‹-QuartzSchedulerResources-getThreadExecutor-execute-QuartzSchedulerThread-æ‰§è¡Œäº†å»æ•°æ®åº“æ‰«æä»»åŠ¡ä½†æ˜¯å…¶å®è¿˜æœ‰å¾ˆå¤šä¸œè¥¿æ²¡æœ‰åˆå§‹åŒ–å®Œï¼Œè¿™ä¸ªæ˜¯æ€ä¹ˆå¤„ç†çš„ï¼Ÿ" class="headerlink" title="é—®é¢˜1. å‰é¢åˆå§‹åŒ–æ˜¯å°±å·²ç»æäº¤å¦ä¸€ä¸ªçº¿ç¨‹ QuartzSchedulerResources.getThreadExecutor().execute(QuartzSchedulerThread) æ‰§è¡Œäº†å»æ•°æ®åº“æ‰«æä»»åŠ¡ä½†æ˜¯å…¶å®è¿˜æœ‰å¾ˆå¤šä¸œè¥¿æ²¡æœ‰åˆå§‹åŒ–å®Œï¼Œè¿™ä¸ªæ˜¯æ€ä¹ˆå¤„ç†çš„ï¼Ÿ"></a>é—®é¢˜1. å‰é¢åˆå§‹åŒ–æ˜¯å°±å·²ç»æäº¤å¦ä¸€ä¸ªçº¿ç¨‹ QuartzSchedulerResources.getThreadExecutor().execute(QuartzSchedulerThread) æ‰§è¡Œäº†å»æ•°æ®åº“æ‰«æä»»åŠ¡ä½†æ˜¯å…¶å®è¿˜æœ‰å¾ˆå¤šä¸œè¥¿æ²¡æœ‰åˆå§‹åŒ–å®Œï¼Œè¿™ä¸ªæ˜¯æ€ä¹ˆå¤„ç†çš„ï¼Ÿ</h3><blockquote><p>ç­”ï¼š QuartzSchedulerThread ä¸­æœ‰ä¸ªå˜é‡ paused åˆå§‹åŒ–æ—¶ä¸º true ï¼Œåˆ™è¯¥çº¿ç¨‹ä¸€ç›´å¤„äºè½®è¯¢æ­»å¾ªç¯çŠ¶æ€ï¼Œåœ¨è°ƒç”¨ QuartzScheduler.start() æ–¹æ³•é‡Œé¢ this.schedThread.togglePause(false); è®¾ç½®æˆ false ,åˆ™ QuartzSchedulerThread æ‰èƒ½å»æ‰§è¡Œæ•°æ®åº“ä»»åŠ¡æ‰«æåŠ è½½</p></blockquote><h3 id="é—®é¢˜2-å¦‚ä½•æ„ŸçŸ¥é›†ç¾¤ä¸­å…¶ä»–æœºå™¨ï¼Ÿ"><a href="#é—®é¢˜2-å¦‚ä½•æ„ŸçŸ¥é›†ç¾¤ä¸­å…¶ä»–æœºå™¨ï¼Ÿ" class="headerlink" title="é—®é¢˜2. å¦‚ä½•æ„ŸçŸ¥é›†ç¾¤ä¸­å…¶ä»–æœºå™¨ï¼Ÿ"></a>é—®é¢˜2. å¦‚ä½•æ„ŸçŸ¥é›†ç¾¤ä¸­å…¶ä»–æœºå™¨ï¼Ÿ</h3><blockquote><p>ç­”ï¼š åœ¨ QuartzScheduler.start() å¯åŠ¨æ—¶ä¼šè°ƒç”¨ QuartzSchedulerResources.getJobStore().schedulerStarted() å¯åŠ¨ä¸€ä¸ªé›†ç¾¤ç®¡ç†çº¿ç¨‹æ¥æ„ŸçŸ¥ new JobStoreSupport.ClusterManager() -&gt; this.manage() -&gt; doCheckin()<br>æ¯ä¸ªæœºå™¨å¯åŠ¨æ—¶éƒ½ä¼šæ‰§è¡Œç­¾å…¥åŠ¨ä½œï¼Œå¦‚æœæ˜¯ç¬¬ä¸€æ¬¡ç­¾å…¥åˆ™æ–°å¢è®°å½•åˆ°è¡¨qrtz_scheduler_stateä¸­å¹¶è®¾ç½®ç­¾å…¥æ—¶é—´ï¼Œå¦‚æœä¸æ˜¯ç¬¬ä¸€æ¬¡åˆ™æ›´æ–°ç­¾å…¥æ—¶é—´ï¼Œæ„ŸçŸ¥åŒä¸€é›†ç¾¤æ ¹æ® SCHED_NAME æ¥åˆ¤æ–­æ˜¯å¦æœ‰é›†ç¾¤æœºå™¨ç¦»çº¿<br>protected long calcFailedIfAfter(SchedulerStateRecord rec) {<br>return rec.getCheckinTimestamp() + Math.max(rec.getCheckinInterval(), System.currentTimeMillis() - this.lastCheckin) + 7500L &gt; å½“å‰æ—¶é—´;<br>}<br>å¦‚æœæ‰«æåˆ°æœ‰æœºå™¨ç¦»çº¿ï¼Œåˆ™é”å®š STATE_ACCESS å¹¶å†æ¬¡æ£€æŸ¥æ˜¯å¦æœ‰ç¦»çº¿çš„æœºå™¨ï¼Œå¦‚æœè¿˜æ˜¯æ£€æŸ¥åˆ°ï¼Œåˆ™é”å®š TRIGGER_ACCESS æ‰«æè¡¨ qrtz_fired_triggers åˆ¤æ–­è§¦å‘å™¨çš„çŠ¶æ€ï¼Œé‡Šæ”¾ blocked triggers -&gt; STATE_WAITING å’Œ acquired triggers -&gt; STATE_PAUSED ã€‚å¦‚æœ job è®¾ç½®äº†å¤±æ•ˆè½¬ç§» isJobRequestsRecovery ï¼Œåˆ™æ›´æ–°è¡¨ qrtz_triggers è§¦å‘å™¨ä¸ºç­‰å¾…æ‰§è¡ŒçŠ¶æ€ï¼ˆWAITINGï¼‰ï¼Œæœ€ååˆ é™¤ deleteFiredTriggers è¡¨çš„æ•°æ®</p></blockquote><h3 id="æ ¹æ®ä¸Šé¢çš„æè¿°ï¼Œæœ‰ä¸ªé—®é¢˜ï¼šä»€ä¹ˆæ—¶å€™æ–°å¢-qrtz-fired-triggers-è¡¨çš„æ•°æ®å‘¢ï¼Ÿ"><a href="#æ ¹æ®ä¸Šé¢çš„æè¿°ï¼Œæœ‰ä¸ªé—®é¢˜ï¼šä»€ä¹ˆæ—¶å€™æ–°å¢-qrtz-fired-triggers-è¡¨çš„æ•°æ®å‘¢ï¼Ÿ" class="headerlink" title="æ ¹æ®ä¸Šé¢çš„æè¿°ï¼Œæœ‰ä¸ªé—®é¢˜ï¼šä»€ä¹ˆæ—¶å€™æ–°å¢ qrtz_fired_triggers è¡¨çš„æ•°æ®å‘¢ï¼Ÿ"></a>æ ¹æ®ä¸Šé¢çš„æè¿°ï¼Œæœ‰ä¸ªé—®é¢˜ï¼šä»€ä¹ˆæ—¶å€™æ–°å¢ qrtz_fired_triggers è¡¨çš„æ•°æ®å‘¢ï¼Ÿ</h3><blockquote><p>ç­”ï¼š QuartzSchedulerThread -&gt; acquireNextTrigger() ä¼šæ–°å¢é‚£ä¸ªæœºå™¨æ‰§è¡Œäº†triggers çš„è®°å½•æ¿€æ´»äº†æ‰€æœ‰çš„è§¦å‘å™¨ï¼Œåˆ™å…¶ä»–çš„æœºå™¨æ ¹æ®æŠ¢å é”æ¥è·å¾—æ‰§è¡Œè§¦å‘å™¨çš„æƒåˆ©ï¼Œ æ‰§è¡ŒacquireNextTrigger()æ–¹æ³•æ—¶ä¼šæŠ¢å é”ï¼Œ quart ä¸æ”¯æŒä»»åŠ¡åˆ†ç‰‡ï¼Œåªèƒ½åœ¨ä¸€ä¸ªæœºå™¨ä¸Šæ‰§è¡Œ</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ideaå¸¸ç”¨æ’ä»¶</title>
      <link href="/2022/03/02/idea-plugin/"/>
      <url>/2022/03/02/idea-plugin/</url>
      
        <content type="html"><![CDATA[<ul><li>alibaba java coding guidelines ä»£ç è§„èŒƒ</li><li>git commit template gitæäº¤æ¨¡æ¿</li><li>ide eval reset</li><li>java bean to json</li><li>SequenceDiagram ä»£ç æ—¶åºå›¾</li><li>SonarLint ä»£ç è§„èŒƒ</li><li>Translation ç¿»è¯‘</li><li>JRebel or XRebel çƒ­éƒ¨ç½²</li><li>RESTfultoolkit</li><li>MyBatisCodeHelper-Pro</li></ul>]]></content>
      
      
      <categories>
          
          <category> Default </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Default </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>xxl-jobæ‰§è¡Œæµç¨‹å’ŒåŸç†</title>
      <link href="/2022/02/24/xxljob-workflow/"/>
      <url>/2022/02/24/xxljob-workflow/</url>
      
        <content type="html"><![CDATA[<h2 id="xxl-jobé¡¹ç›®åœ°å€-ğŸ‘ˆ"><a href="#xxl-jobé¡¹ç›®åœ°å€-ğŸ‘ˆ" class="headerlink" title="xxl-jobé¡¹ç›®åœ°å€ ğŸ‘ˆ"></a><a href="https://github.com/xuxueli/xxl-job">xxl-jobé¡¹ç›®åœ°å€ ğŸ‘ˆ</a></h2><p><img src="/img/xxljob%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B%E5%92%8C%E5%8E%9F%E7%90%86.png" alt="xxljobæ‰§è¡Œæµç¨‹å’ŒåŸç†.png"><br><img src="/img/xxljob%E6%9E%B6%E6%9E%84%E5%9B%BE.png" alt="xxljobæ¶æ„å›¾.png"></p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>springboot redis æ­»é”é—®é¢˜</title>
      <link href="/2021/09/29/spring-redis-cache-lock/"/>
      <url>/2021/09/29/spring-redis-cache-lock/</url>
      
        <content type="html"><![CDATA[<h1 id="ç°è±¡"><a href="#ç°è±¡" class="headerlink" title="ç°è±¡"></a>ç°è±¡</h1><ul><li>è°ƒç”¨æŸä¸ªä½¿ç”¨äº† @Cacheable çš„æ¥å£ï¼Œä¸€ç›´æ²¡æœ‰å“åº”ï¼Œä½†æ˜¯ä¸šåŠ¡ä»£ç éƒ½æ‰§è¡Œå®Œæˆã€‚ å¦‚æœä½¿ç”¨çš„æ˜¯ lockingRedisCacheWriter å®ä¾‹åŒ–çš„ç¼“å­˜ï¼Œé‚£ä¹ˆåœ¨å¼€å‘é˜¶æ®µä¸æ–­é‡å¯åº”ç”¨å¼ºåˆ¶æ€æ‰è¿›ç¨‹ï¼Œä¼šå¯¼è‡´é”æ²¡æœ‰é‡Šæ”¾é—®é¢˜ã€‚</li></ul><h1 id="ç¼“å­˜æ³¨è§£"><a href="#ç¼“å­˜æ³¨è§£" class="headerlink" title="ç¼“å­˜æ³¨è§£"></a>ç¼“å­˜æ³¨è§£</h1><p>@Cacheableã€@CacheEvictã€@CachePutã€@Caching</p><h1 id="spring-redis-çš„å®ç°"><a href="#spring-redis-çš„å®ç°" class="headerlink" title="spring redis çš„å®ç°"></a>spring redis çš„å®ç°</h1><p>RedisCacheManagerã€RedisCache æ ¸å¿ƒç±»<br>å…¶ä¸­ RedisCache å®ç°äº† redis å…·ä½“çš„ç¼“å­˜æ–¹å¼å’Œæ‰§è¡Œçš„rediså‘½ä»¤</p><p>åˆ›å»ºç¼“å­˜æ—¶çš„ cacheNames<br>å…¶ä¸­å®šä¹‰äº† RedisCacheMetadata.class ä¼šç”Ÿæˆä¸€ä¸ª cacheLockName &#x3D; cacheName + â€œ~lockâ€ çš„ç¼“å­˜é”çš„ key</p><p>åœ¨ get ç¼“å­˜æ—¶ï¼Œåˆ¤æ–­ redis æœ‰æ²¡æœ‰ç¼“å­˜è¿™ä¸ª keyï¼Œæ²¡æœ‰åˆ™åˆ›å»ºè¿™ä¸ªç¼“å­˜ï¼Œè°ƒç”¨çš„æ˜¯new RedisCache.RedisWriteThroughCallback().doInRedis()ï¼Œå…¶ä¸­ç¬¬ä¸€æ­¥å°±æ˜¯ lock() ï¼Œä½¿ç”¨çš„å°±æ˜¯ä¸Šé¢çš„é‚£ä¸ªç¼“å­˜é”çš„ key ï¼Œå¹¶ä¸”æ²¡æœ‰è®¾ç½®è¶…æ—¶æ—¶é—´ï¼Œä»£ç å¦‚ä¸‹ï¼Œå½“è¿™ä¸ªç¼“å­˜é”çš„ key æ—©å·²åœ¨ redis ä¸­å­˜åœ¨ï¼Œé‚£ä¸‹çš„ä»£ç å°±æ˜¯æ­»å¾ªç¯ï¼Œç›´åˆ°redisè¿æ¥è€—å°½æœåŠ¡ä¸å¯ç”¨ã€‚</p><h1 id="è§£å†³æ–¹æ³•å°±æ˜¯åˆ é™¤è¿™ä¸ªkey"><a href="#è§£å†³æ–¹æ³•å°±æ˜¯åˆ é™¤è¿™ä¸ªkey" class="headerlink" title="è§£å†³æ–¹æ³•å°±æ˜¯åˆ é™¤è¿™ä¸ªkey"></a>è§£å†³æ–¹æ³•å°±æ˜¯åˆ é™¤è¿™ä¸ªkey</h1><p>çº¿ç¨‹ BLOCKED åˆ†æï¼š<br>æ‰§è¡Œä»£ç  xxx æ—¶ä½¿ç”¨äº†ç¼“å­˜æ³¨è§£ @Cacheable ï¼Œè¯¥æ³¨è§£å®ç°æœ€ç»ˆæ˜¯é€šè¿‡ org.springframework.data.redis.cache.DefaultRedisCacheWriter.get() è·å–redis æ˜¯å¦å­˜åœ¨ç¼“å­˜ï¼Œæºç å¦‚ä¸‹ï¼šï¼ˆspring-data-redis 2.3.4 Release ç‰ˆæœ¬ï¼‰</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> key<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token class-name">Assert</span><span class="token punctuation">.</span>*notNull<span class="token operator">*</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> â€œ<span class="token class-name">Name</span> must not be <span class="token keyword">null</span><span class="token operator">!</span>â€<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token class-name">Assert</span><span class="token punctuation">.</span>*notNull<span class="token operator">*</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> â€œ<span class="token class-name">Key</span> must not be <span class="token keyword">null</span><span class="token operator">!</span>â€<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> <span class="token punctuation">(</span>connection<span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> connection<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">// æ‰§è¡Œ execute</span><span class="token keyword">private</span> <span class="token class-name">T</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token class-name">Function</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">RedisConnection</span><span class="token punctuation">,</span> <span class="token class-name">T</span><span class="token punctuation">></span></span> callback<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">RedisConnection</span> connection <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>connectionFactory<span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token class-name">Object</span> var4<span class="token punctuation">;</span>    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>       <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">checkAndPotentiallyWaitUntilUnlocked</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> connection<span class="token punctuation">)</span><span class="token punctuation">;</span> var4 <span class="token operator">=</span> callback<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>connection<span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>      connection<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token punctuation">&#125;</span> <span class="token keyword">return</span> var4<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>    <span class="token comment">// æ‰§è¡ŒåŠ é”é€»è¾‘ checkAndPotentiallyWaitUntilUnlocked</span>    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">checkAndPotentiallyWaitUntilUnlocked</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token class-name">RedisConnection</span> connection<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>       <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">isLockingCacheWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>         <span class="token keyword">try</span> <span class="token punctuation">&#123;</span> <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">doCheckLock</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> connection<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>          <span class="token class-name">Thread</span><span class="token punctuation">.</span>*sleep<span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>sleepTime<span class="token punctuation">.</span><span class="token function">toMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token punctuation">&#125;</span>      <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> var4<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Thread</span><span class="token punctuation">.</span>*currentThread<span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">interrupt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">PessimisticLockingFailureException</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span>*format<span class="token operator">*</span><span class="token punctuation">(</span>â€œ<span class="token class-name">Interrupted</span> <span class="token keyword">while</span> waiting <span class="token keyword">to</span> <span class="token namespace">unlock</span> cache <span class="token operator">%</span>sâ€<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">,</span> var4<span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">// è·å–é” åˆ¤æ–­è¿™ä¸ªé” key æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨å°±ä¸€ç›´å¾ªç¯ç­‰å¾…é”èµ„æº,ä½†æ˜¯é€šè¿‡åœ¨ redis æœåŠ¡å™¨åˆæ²¡æœ‰æ‰¾åˆ°ç›¸å…³çš„ ï½lock</span><span class="token keyword">boolean</span> <span class="token function">doCheckLock</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token class-name">RedisConnection</span> connection<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>   <span class="token keyword">return</span> connection<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token operator">*</span>createCacheLockKey<span class="token operator">*</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token comment">// åˆ›å»ºé” key</span><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">createCacheLockKey</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>   <span class="token keyword">return</span> <span class="token punctuation">(</span>name <span class="token operator">+</span> â€œ<span class="token operator">~</span>lockâ€<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span>*<span class="token constant">UTF_8</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>ä»£ç å’Œæ³¨é‡Šå¾—çŸ¥åŠ é”é€»è¾‘å¯¼è‡´ä¸€ç›´åœ¨ç­‰å¾…ä¸­çš„çŠ¶æ€ï¼Œå¯¼è‡´çº¿ç¨‹é˜»å¡ã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="è§£å†³æ–¹æ¡ˆï¼š"><a href="#è§£å†³æ–¹æ¡ˆï¼š" class="headerlink" title="è§£å†³æ–¹æ¡ˆï¼š"></a>è§£å†³æ–¹æ¡ˆï¼š</h1><p>ç»æºç è·Ÿè¸ªå‘ç°æœ‰ä¸¤ç§å®ç°ï¼š nonLockingRedisCacheWriter å’Œ lockingRedisCacheWriter ï¼Œé»˜è®¤æ˜¯é€šè¿‡ nonLockingRedisCacheWriter å®ä¾‹åŒ–çš„ï¼Œæºç å¦‚ä¸‹</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">RedisCacheWriter</span> <span class="token punctuation">&#123;</span>   <span class="token keyword">static</span> <span class="token class-name">RedisCacheWriter</span> <span class="token function">nonLockingRedisCacheWriter</span><span class="token punctuation">(</span><span class="token class-name">RedisConnectionFactory</span> connectionFactory<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">Assert</span><span class="token punctuation">.</span>*notNull<span class="token operator">*</span><span class="token punctuation">(</span>connectionFactory<span class="token punctuation">,</span> â€œ<span class="token class-name">ConnectionFactory</span> must not be <span class="token keyword">null</span><span class="token operator">!</span>â€<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">DefaultRedisCacheWriter</span><span class="token punctuation">(</span>connectionFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token punctuation">&#125;</span>   <span class="token keyword">static</span> <span class="token class-name">RedisCacheWriter</span> <span class="token function">lockingRedisCacheWriter</span><span class="token punctuation">(</span><span class="token class-name">RedisConnectionFactory</span> connectionFactory<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">Assert</span><span class="token punctuation">.</span>*notNull<span class="token operator">*</span><span class="token punctuation">(</span>connectionFactory<span class="token punctuation">,</span> â€œ<span class="token class-name">ConnectionFactory</span> must not be <span class="token keyword">null</span><span class="token operator">!</span>â€<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">DefaultRedisCacheWriter</span><span class="token punctuation">(</span>connectionFactory<span class="token punctuation">,</span> <span class="token class-name">Duration</span><span class="token punctuation">.</span>*ofMillis<span class="token operator">*</span><span class="token punctuation">(</span><span class="token number">50L</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token punctuation">&#125;</span>   <span class="token keyword">void</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">String</span> var1<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> var2<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> var3<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">Duration</span> var4<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token annotation punctuation">@Nullable</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">String</span> var1<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> var2<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token annotation punctuation">@Nullable</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">putIfAbsent</span><span class="token punctuation">(</span><span class="token class-name">String</span> var1<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> var2<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> var3<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">Duration</span> var4<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">void</span> <span class="token function">remove</span><span class="token punctuation">(</span><span class="token class-name">String</span> var1<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> var2<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">void</span> <span class="token function">clean</span><span class="token punctuation">(</span><span class="token class-name">String</span> var1<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> var2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨å®ä¾‹åŒ–ç¼“å­˜ç®¡ç†ç»„ä»¶æ—¶æŒ‡å®šæ— é”ç¼“å­˜ï¼Œå¯ä»¥é¿å…è·å–ç¼“å­˜åŠ é”é—®é¢˜ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>jdk tools jvm jmap jstat jstack</title>
      <link href="/2021/07/02/jdk-tools/"/>
      <url>/2021/07/02/jdk-tools/</url>
      
        <content type="html"><![CDATA[<h3 id="jmapè¾“å‡ºå†…å­˜å¿«ç…§"><a href="#jmapè¾“å‡ºå†…å­˜å¿«ç…§" class="headerlink" title="jmapè¾“å‡ºå†…å­˜å¿«ç…§"></a>jmapè¾“å‡ºå†…å­˜å¿«ç…§</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">jmap <span class="token parameter variable">-dump:format</span><span class="token operator">=</span>b,file<span class="token operator">=</span>/data/jmap.hprof PIDå¢åŠ GCæ—¥å¿—<span class="token parameter variable">-XX:+HeapDumpOnOutOfMemoryError</span> -Xloggc:/data/tomcat/logs/gc.log <span class="token parameter variable">-XX:+PrintGCDateStamps</span> <span class="token parameter variable">-XX:+PrintGCDetails</span> <span class="token parameter variable">-XX:+PrintGCApplicationStoppedTime</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="jstat-æŸ¥çœ‹GCä¿¡æ¯"><a href="#jstat-æŸ¥çœ‹GCä¿¡æ¯" class="headerlink" title="jstat æŸ¥çœ‹GCä¿¡æ¯"></a>jstat æŸ¥çœ‹GCä¿¡æ¯</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token number">3000</span> æ˜¯æŒ‡å®šçš„é¢‘ç‡jstat <span class="token parameter variable">-gcutil</span> PID <span class="token number">3000</span>ä½¿ç”¨jstat -gccauseï¼šé¢å¤–è¾“å‡ºä¸Šæ¬¡GCåŸå› <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="jstack-æ­»é”é—®é¢˜"><a href="#jstack-æ­»é”é—®é¢˜" class="headerlink" title="jstack æ­»é”é—®é¢˜"></a>jstack æ­»é”é—®é¢˜</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">jstackä¸»è¦çš„ç”¨é€”æ˜¯æ‰“å°å‡ºThread dumpjstack pid  <span class="token operator">></span> ./stack.logé€‰é¡¹ä½œç”¨<span class="token parameter variable">-F</span>å½“æ­£å¸¸è¾“å‡ºè¯·æ±‚ä¸è¢«å“åº”æ—¶ï¼Œå¼ºåˆ¶è¾“å‡ºçº¿ç¨‹å †æ ˆ<span class="token parameter variable">-l</span>é™¤å †æ ˆå¤–ï¼Œæ˜¾ç¤ºå…³äºé”çš„é™„åŠ ä¿¡æ¯<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="sz-ä¸‹è½½å¤§æ–‡ä»¶é—®é¢˜"><a href="#sz-ä¸‹è½½å¤§æ–‡ä»¶é—®é¢˜" class="headerlink" title="sz ä¸‹è½½å¤§æ–‡ä»¶é—®é¢˜"></a>sz ä¸‹è½½å¤§æ–‡ä»¶é—®é¢˜</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># æŠŠisoåˆ‡åˆ†æˆ500Må¤§å°çš„æ–‡ä»¶</span><span class="token function">cat</span> xxxæ–‡ä»¶ <span class="token operator">|</span> <span class="token function">split</span> <span class="token parameter variable">-b</span> 500M - xxx_1<span class="token comment"># åˆ‡åˆ†åéƒ½æ˜¯ä»¥ .aa   .ab  .ac .... ç±»ä¼¼è¿™æ ·çš„ç»“æ„</span><span class="token comment"># sz ä¸‹è½½</span>sz xxx_1a*<span class="token comment"># åˆå¹¶æ–‡ä»¶</span><span class="token function">cat</span> xxx* <span class="token operator">></span> xxx_1<span class="token comment"># windows æ–‡ä»¶åˆå¹¶</span>copy /b ï¼œfilename1ï¼+ï¼œfilename2ï¼+â€¦+ï¼œfilenameNï¼ ï¼œæ–°filenameï¼<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>webservice çš„ä¸¤ç§è°ƒç”¨æ–¹å¼</title>
      <link href="/2021/05/26/webservice-call/"/>
      <url>/2021/05/26/webservice-call/</url>
      
        <content type="html"><![CDATA[<h3 id="CXF"><a href="#CXF" class="headerlink" title="CXF"></a>CXF</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WebserviceConfiguration</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> targetEndpointAddress<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> targetNameSpace<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> operationName<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> soapActionURI<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> binding<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">boolean</span> useSOAPAction<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">Integer</span> timeout<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">SOAPHeaderElement</span> soapHeaderElement<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">SOAPConstants</span> soapConstants<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">Object</span> params<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">boolean</span> isObject<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">boolean</span> isArg0<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getTargetEndpointAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> targetEndpointAddress<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setTargetEndpointAddress</span><span class="token punctuation">(</span><span class="token class-name">String</span> targetEndpointAddress<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>targetEndpointAddress <span class="token operator">=</span> targetEndpointAddress<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getTargetNameSpace</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> targetNameSpace<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setTargetNameSpace</span><span class="token punctuation">(</span><span class="token class-name">String</span> targetNameSpace<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>targetNameSpace <span class="token operator">=</span> targetNameSpace<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getOperationName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> operationName<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setOperationName</span><span class="token punctuation">(</span><span class="token class-name">String</span> operationName<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>operationName <span class="token operator">=</span> operationName<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getSoapActionURI</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> soapActionURI<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setSoapActionURI</span><span class="token punctuation">(</span><span class="token class-name">String</span> soapActionURI<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>soapActionURI <span class="token operator">=</span> soapActionURI<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">getUseSOAPAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> useSOAPAction<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setUseSOAPAction</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> useSOAPAction<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>useSOAPAction <span class="token operator">=</span> useSOAPAction<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token class-name">SOAPHeaderElement</span> <span class="token function">getSoapHeaderElement</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> soapHeaderElement<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setSoapHeaderElement</span><span class="token punctuation">(</span><span class="token class-name">SOAPHeaderElement</span> soapHeaderElement<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>soapHeaderElement <span class="token operator">=</span> soapHeaderElement<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">getParams</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> params<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setParams</span><span class="token punctuation">(</span><span class="token class-name">Object</span> params<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>params <span class="token operator">=</span> params<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token class-name">SOAPConstants</span> <span class="token function">getSoapConstants</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> soapConstants<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setSoapConstants</span><span class="token punctuation">(</span><span class="token class-name">SOAPConstants</span> soapConstants<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>soapConstants <span class="token operator">=</span> soapConstants<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token class-name">Integer</span> <span class="token function">getTimeout</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> timeout<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> timeout<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>timeout <span class="token operator">=</span> timeout<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getBinding</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> binding<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setBinding</span><span class="token punctuation">(</span><span class="token class-name">String</span> binding<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>binding <span class="token operator">=</span> binding<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> isObject<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setObject</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> object<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        isObject <span class="token operator">=</span> object<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isArg0</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> isArg0<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setArg0</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> arg0<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        isArg0 <span class="token operator">=</span> arg0<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>fastjson<span class="token punctuation">.</span></span><span class="token class-name">JSON</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>fastjson<span class="token punctuation">.</span>serializer<span class="token punctuation">.</span></span><span class="token class-name">JSONSerializer</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>fastjson<span class="token punctuation">.</span>serializer<span class="token punctuation">.</span></span><span class="token class-name">SimplePropertyPreFilter</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">hk<span class="token punctuation">.</span>com<span class="token punctuation">.</span>cre<span class="token punctuation">.</span>process<span class="token punctuation">.</span>knowledge<span class="token punctuation">.</span>thirdapi<span class="token punctuation">.</span>vo<span class="token punctuation">.</span></span><span class="token class-name">WebserviceResultVo</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>cxf<span class="token punctuation">.</span>endpoint<span class="token punctuation">.</span></span><span class="token class-name">Client</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>cxf<span class="token punctuation">.</span>endpoint<span class="token punctuation">.</span></span><span class="token class-name">ClientImpl</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>cxf<span class="token punctuation">.</span>endpoint<span class="token punctuation">.</span></span><span class="token class-name">Endpoint</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>cxf<span class="token punctuation">.</span>jaxws<span class="token punctuation">.</span>endpoint<span class="token punctuation">.</span>dynamic<span class="token punctuation">.</span></span><span class="token class-name">JaxWsDynamicClientFactory</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>cxf<span class="token punctuation">.</span>service<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Logger</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">LoggerFactory</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">ObjectUtils</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>activation<span class="token punctuation">.</span></span><span class="token class-name">DataHandler</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>xml<span class="token punctuation">.</span>namespace<span class="token punctuation">.</span></span><span class="token class-name">QName</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>beans<span class="token punctuation">.</span></span><span class="token class-name">PropertyDescriptor</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">Field</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Map</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CxfWebserviceUtils</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Logger</span> log <span class="token operator">=</span> <span class="token class-name">LoggerFactory</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token class-name">CxfWebserviceUtils</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">SimplePropertyPreFilter</span> <span class="token constant">PROPERTY_PRE_FILTER</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimplePropertyPreFilter</span><span class="token punctuation">(</span><span class="token class-name">DataHandler</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token annotation punctuation">@Override</span>        <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">apply</span><span class="token punctuation">(</span><span class="token class-name">JSONSerializer</span> serializer<span class="token punctuation">,</span> <span class="token class-name">Object</span> source<span class="token punctuation">,</span> <span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getClazz</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getClazz</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isInstance</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>serializer<span class="token punctuation">,</span> source<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">WebserviceResultVo</span> <span class="token function">send</span><span class="token punctuation">(</span><span class="token class-name">WebserviceConfiguration</span> configuration<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"CxfWebserviceUtils parmas:&#123;&#125;"</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>configuration<span class="token punctuation">,</span><span class="token constant">PROPERTY_PRE_FILTER</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">JaxWsDynamicClientFactory</span> factory <span class="token operator">=</span> <span class="token class-name">JaxWsDynamicClientFactory</span><span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">Client</span> client <span class="token operator">=</span> factory<span class="token punctuation">.</span><span class="token function">createClient</span><span class="token punctuation">(</span>configuration<span class="token punctuation">.</span><span class="token function">getTargetEndpointAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">QName</span> method <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QName</span><span class="token punctuation">(</span>configuration<span class="token punctuation">.</span><span class="token function">getTargetNameSpace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> configuration<span class="token punctuation">.</span><span class="token function">getOperationName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">Object</span> returnData <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span>configuration<span class="token punctuation">.</span><span class="token function">isObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                <span class="token class-name">ClientImpl</span> client1 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ClientImpl</span><span class="token punctuation">)</span> client<span class="token punctuation">;</span>                <span class="token class-name">Endpoint</span> endpoint <span class="token operator">=</span> client1<span class="token punctuation">.</span><span class="token function">getEndpoint</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token class-name">ServiceInfo</span> serviceInfo <span class="token operator">=</span> endpoint<span class="token punctuation">.</span><span class="token function">getService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getServiceInfos</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token class-name">QName</span> service <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QName</span><span class="token punctuation">(</span>configuration<span class="token punctuation">.</span><span class="token function">getTargetNameSpace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> configuration<span class="token punctuation">.</span><span class="token function">getBinding</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token class-name">BindingInfo</span> binding <span class="token operator">=</span> serviceInfo<span class="token punctuation">.</span><span class="token function">getBinding</span><span class="token punctuation">(</span>service<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token class-name">BindingOperationInfo</span> bindingOperation <span class="token operator">=</span> binding<span class="token punctuation">.</span><span class="token function">getOperation</span><span class="token punctuation">(</span>method<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token class-name">BindingMessageInfo</span> input <span class="token operator">=</span> bindingOperation<span class="token punctuation">.</span><span class="token function">getInput</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token class-name">MessagePartInfo</span> messagePartInfo <span class="token operator">=</span> input<span class="token punctuation">.</span><span class="token function">getMessageParts</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span> typeClass <span class="token operator">=</span> messagePartInfo<span class="token punctuation">.</span><span class="token function">getTypeClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span><span class="token punctuation">(</span>configuration<span class="token punctuation">.</span><span class="token function">isArg0</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                    typeClass <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PropertyDescriptor</span><span class="token punctuation">(</span><span class="token string">"arg0"</span><span class="token punctuation">,</span> typeClass<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getPropertyType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>                <span class="token class-name">Object</span> o <span class="token operator">=</span> typeClass<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span><span class="token punctuation">(</span>configuration<span class="token punctuation">.</span><span class="token function">getParams</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">instanceof</span> <span class="token class-name">Map</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                    <span class="token class-name">Map</span> params <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token punctuation">)</span> configuration<span class="token punctuation">.</span><span class="token function">getParams</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Object</span> o1 <span class="token operator">:</span> params<span class="token punctuation">.</span><span class="token function">keySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                        <span class="token class-name">PropertyDescriptor</span> descriptor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PropertyDescriptor</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>o1<span class="token punctuation">)</span><span class="token punctuation">,</span> typeClass<span class="token punctuation">)</span><span class="token punctuation">;</span>                        descriptor<span class="token punctuation">.</span><span class="token function">getWriteMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>o<span class="token punctuation">,</span> params<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>o1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">&#125;</span>                <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>configuration<span class="token punctuation">.</span><span class="token function">getParams</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">instanceof</span> <span class="token class-name">List</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token class-name">List</span> params <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">List</span><span class="token punctuation">)</span> configuration<span class="token punctuation">.</span><span class="token function">getParams</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token class-name">Field</span><span class="token punctuation">[</span><span class="token punctuation">]</span> declaredFields <span class="token operator">=</span> typeClass<span class="token punctuation">.</span><span class="token function">getDeclaredFields</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> declaredFields<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                        <span class="token class-name">PropertyDescriptor</span> descriptor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PropertyDescriptor</span><span class="token punctuation">(</span>declaredFields<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> typeClass<span class="token punctuation">)</span><span class="token punctuation">;</span>                        descriptor<span class="token punctuation">.</span><span class="token function">getWriteMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>o<span class="token punctuation">,</span> params<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">&#125;</span>                <span class="token punctuation">&#125;</span>                <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> invoke <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>method<span class="token punctuation">,</span> o<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">ObjectUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>invoke<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                    returnData <span class="token operator">=</span> invoke<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> o <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>                <span class="token keyword">if</span><span class="token punctuation">(</span>configuration<span class="token punctuation">.</span><span class="token function">getParams</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">instanceof</span> <span class="token class-name">Map</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                    <span class="token class-name">Map</span> params <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token punctuation">)</span> configuration<span class="token punctuation">.</span><span class="token function">getParams</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    o <span class="token operator">=</span> params<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>configuration<span class="token punctuation">.</span><span class="token function">getParams</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">instanceof</span> <span class="token class-name">List</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token class-name">List</span> params <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">List</span><span class="token punctuation">)</span> configuration<span class="token punctuation">.</span><span class="token function">getParams</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    o <span class="token operator">=</span> params<span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>                <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> invoke <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>method<span class="token punctuation">,</span> o<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">ObjectUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>invoke<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                    returnData <span class="token operator">=</span> invoke<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span><span class="token comment">//            Object[] invoke = client.invoke(method, ((List)configuration.getParams()).toArray());</span>            <span class="token keyword">if</span><span class="token punctuation">(</span>returnData <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"CxfWebserviceUtils response:&#123;&#125;"</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>returnData<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">return</span> <span class="token class-name">WebserviceResultVo</span><span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span>returnData<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"CxfWebserviceUtils response is null"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">return</span> <span class="token class-name">WebserviceResultVo</span><span class="token punctuation">.</span><span class="token function">fail</span><span class="token punctuation">(</span><span class="token string">"response is null"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"CxfWebserviceUtils error!"</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token class-name">WebserviceResultVo</span><span class="token punctuation">.</span><span class="token function">fail</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="Axis"><a href="#Axis" class="headerlink" title="Axis"></a>Axis</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Call</span> call <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Call</span><span class="token punctuation">)</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>axis<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span>Service</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">createCall</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//è®¾ç½®è¶…æ—¶æ—¶é—´</span><span class="token comment">//      call.setTimeout(new Integer(20000));</span>        <span class="token comment">//è®¾ç½®ç›®æ ‡æ¥å£çš„åœ°å€</span>        call<span class="token punctuation">.</span><span class="token function">setTargetEndpointAddress</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span>endpoint<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// </span>        call<span class="token punctuation">.</span><span class="token function">setSOAPActionURI</span><span class="token punctuation">(</span>soapActionURI<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//æ·»åŠ å¤´éƒ¨ä¿¡æ¯</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">ObjectUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>authDto<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">SOAPHeaderElement</span> soapHeaderElement <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SOAPHeaderElement</span><span class="token punctuation">(</span>targetNameSpace<span class="token punctuation">,</span> <span class="token string">"AuthenticationInfo"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">//è®¾ç½®å‚æ•°åç§°å’Œå€¼</span>            soapHeaderElement<span class="token punctuation">.</span><span class="token function">addChildElement</span><span class="token punctuation">(</span><span class="token string">"userName"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addTextNode</span><span class="token punctuation">(</span>authDto<span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            soapHeaderElement<span class="token punctuation">.</span><span class="token function">addChildElement</span><span class="token punctuation">(</span><span class="token string">"password"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addTextNode</span><span class="token punctuation">(</span>authDto<span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            soapHeaderElement<span class="token punctuation">.</span><span class="token function">addChildElement</span><span class="token punctuation">(</span><span class="token string">"authentication"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addTextNode</span><span class="token punctuation">(</span>authDto<span class="token punctuation">.</span><span class="token function">getAuthentication</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            soapHeaderElement<span class="token punctuation">.</span><span class="token function">addChildElement</span><span class="token punctuation">(</span><span class="token string">"locale"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addTextNode</span><span class="token punctuation">(</span>authDto<span class="token punctuation">.</span><span class="token function">getLocale</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            soapHeaderElement<span class="token punctuation">.</span><span class="token function">addChildElement</span><span class="token punctuation">(</span><span class="token string">"timeZone"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addTextNode</span><span class="token punctuation">(</span>authDto<span class="token punctuation">.</span><span class="token function">getTimezone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            call<span class="token punctuation">.</span><span class="token function">addHeader</span><span class="token punctuation">(</span>soapHeaderElement<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token comment">//è®¾ç½®å­—ç¬¦ç¼–ç </span>        call<span class="token punctuation">.</span><span class="token function">setEncodingStyle</span><span class="token punctuation">(</span><span class="token class-name">CharEncoding</span><span class="token punctuation">.</span><span class="token constant">UTF_8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//è®¾ç½®è¿”å›å€¼ç±»å‹</span>        call<span class="token punctuation">.</span><span class="token function">setReturnClass</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        call<span class="token punctuation">.</span><span class="token function">setReturnType</span><span class="token punctuation">(</span><span class="token class-name">XMLType</span><span class="token punctuation">.</span><span class="token constant">XSD_STRING</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//        call.setReturnType(XMLType.SOAP_ARRAY);</span>        <span class="token comment">// è®¾ç½®å…·ä½“è°ƒç”¨çš„æ–¹æ³•å // WSDLé‡Œé¢æè¿°çš„æ¥å£åç§°</span>        call<span class="token punctuation">.</span><span class="token function">setOperationName</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">QName</span><span class="token punctuation">(</span>targetNameSpace<span class="token punctuation">,</span> methodName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        call<span class="token punctuation">.</span><span class="token function">setUseSOAPAction</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// æ–‡ä»¶æµ</span>call<span class="token punctuation">.</span><span class="token function">addParameter</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">QName</span><span class="token punctuation">(</span>targetNameSpace<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">XMLType</span><span class="token punctuation">.</span><span class="token constant">SOAP_BASE64BINARY</span><span class="token punctuation">,</span> <span class="token class-name">ParameterMode</span><span class="token punctuation">.</span><span class="token constant">IN</span><span class="token punctuation">)</span><span class="token punctuation">;</span>call<span class="token punctuation">.</span><span class="token function">addParameter</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">QName</span><span class="token punctuation">(</span>targetNameSpace<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">XMLType</span><span class="token punctuation">.</span><span class="token constant">XSD_STRING</span><span class="token punctuation">,</span> <span class="token class-name">ParameterMode</span><span class="token punctuation">.</span><span class="token constant">IN</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token class-name">Object</span> returnData <span class="token operator">=</span> call<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>paramValues<span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Spring AOP</title>
      <link href="/2021/02/23/Spring-AOP/"/>
      <url>/2021/02/23/Spring-AOP/</url>
      
        <content type="html"><![CDATA[<h3 id="AOP-æ¦‚å¿µ"><a href="#AOP-æ¦‚å¿µ" class="headerlink" title="AOP æ¦‚å¿µ"></a>AOP æ¦‚å¿µ</h3><ul><li>Aspectï¼š<ul><li>Aspect å£°æ˜ç±»ä¼¼äº Java ä¸­çš„ç±»å£°æ˜ï¼Œåœ¨ Aspect ä¸­ä¼šåŒ…å«ç€ä¸€äº› Pointcut ä»¥åŠç›¸åº”çš„ Adviceã€‚</li></ul></li><li>Joint pointï¼š<ul><li>è¡¨ç¤ºåœ¨ç¨‹åºä¸­æ˜ç¡®å®šä¹‰çš„ç‚¹ï¼Œå…¸å‹çš„åŒ…æ‹¬æ–¹æ³•è°ƒç”¨ï¼Œå¯¹ç±»æˆå‘˜çš„è®¿é—®ä»¥åŠå¼‚å¸¸å¤„ç†ç¨‹åºå—çš„æ‰§è¡Œç­‰ç­‰ï¼Œå®ƒè‡ªèº«è¿˜å¯ä»¥åµŒå¥—å…¶å®ƒ joint pointã€‚</li></ul></li><li>Pointcutï¼š<ul><li>è¡¨ç¤ºä¸€ç»„ joint pointï¼Œè¿™äº› joint point æˆ–æ˜¯é€šè¿‡é€»è¾‘å…³ç³»ç»„åˆèµ·æ¥ï¼Œæˆ–æ˜¯é€šè¿‡é€šé…ã€æ­£åˆ™è¡¨è¾¾å¼ç­‰æ–¹å¼é›†ä¸­èµ·æ¥ï¼Œå®ƒå®šä¹‰äº†ç›¸åº”çš„ Advice å°†è¦å‘ç”Ÿçš„åœ°æ–¹ã€‚</li></ul></li><li>Adviceï¼š<ul><li>Advice å®šä¹‰äº†åœ¨ pointcut é‡Œé¢å®šä¹‰çš„ç¨‹åºç‚¹å…·ä½“è¦åšçš„æ“ä½œï¼Œå®ƒé€šè¿‡ beforeã€after å’Œ around æ¥åŒºåˆ«æ˜¯åœ¨æ¯ä¸ª joint point ä¹‹å‰ã€ä¹‹åè¿˜æ˜¯ä»£æ›¿æ‰§è¡Œçš„ä»£ç ã€‚</li></ul></li><li>Advice çš„ç±»å‹<ul><li>before advice, åœ¨ join point å‰è¢«æ‰§è¡Œçš„ advice. è™½ç„¶ before advice æ˜¯åœ¨ join point å‰è¢«æ‰§è¡Œ, ä½†æ˜¯å®ƒå¹¶ä¸èƒ½å¤Ÿé˜»æ­¢ join point çš„æ‰§è¡Œ, é™¤éå‘ç”Ÿäº†å¼‚å¸¸(å³æˆ‘ä»¬åœ¨ before advice ä»£ç ä¸­, ä¸èƒ½äººä¸ºåœ°å†³å®šæ˜¯å¦ç»§ç»­æ‰§è¡Œ join point ä¸­çš„ä»£ç )</li><li>after return advice, åœ¨ä¸€ä¸ª join point æ­£å¸¸è¿”å›åæ‰§è¡Œçš„ advice</li><li>after throwing advice, å½“ä¸€ä¸ª join point æŠ›å‡ºå¼‚å¸¸åæ‰§è¡Œçš„ advice</li><li>after(final) advice, æ— è®ºä¸€ä¸ª join point æ˜¯æ­£å¸¸é€€å‡ºè¿˜æ˜¯å‘ç”Ÿäº†å¼‚å¸¸, éƒ½ä¼šè¢«æ‰§è¡Œçš„ advice.</li><li>around advice, åœ¨ join point å‰å’Œ joint point é€€å‡ºåéƒ½æ‰§è¡Œçš„ advice. è¿™ä¸ªæ˜¯æœ€å¸¸ç”¨çš„ advice.</li><li>introductionï¼Œintroductionå¯ä»¥ä¸ºåŸæœ‰çš„å¯¹è±¡å¢åŠ æ–°çš„å±æ€§å’Œæ–¹æ³•ã€‚</li></ul></li></ul><h3 id="Spring-AOP-æºç "><a href="#Spring-AOP-æºç " class="headerlink" title="Spring AOP æºç "></a>Spring AOP æºç </h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token punctuation">[</span>æºç è§£è¯»<span class="token punctuation">]</span><span class="token punctuation">(</span>https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>zhuanlan<span class="token punctuation">.</span>zhihu<span class="token punctuation">.</span>com<span class="token operator">/</span>p<span class="token operator">/</span><span class="token number">44094896</span><span class="token punctuation">)</span><span class="token number">1.</span> <span class="token class-name">AbstractAutowireCapableBeanFactory</span><span class="token punctuation">.</span><span class="token function">createBean</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> beanClass<span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token number">2.</span> <span class="token function">doCreateBean</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">String</span> beanName<span class="token punctuation">,</span> <span class="token keyword">final</span> <span class="token class-name">RootBeanDefinition</span> mbd<span class="token punctuation">,</span> <span class="token keyword">final</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token number">3.</span> <span class="token function">getEarlyBeanReference</span><span class="token punctuation">(</span><span class="token class-name">String</span> beanName<span class="token punctuation">,</span> <span class="token class-name">RootBeanDefinition</span> mbd<span class="token punctuation">,</span> <span class="token class-name">Object</span> bean<span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token number">4.</span> <span class="token class-name">AbstractAutoProxyCreator</span><span class="token punctuation">.</span><span class="token function">getEarlyBeanReference</span><span class="token punctuation">(</span><span class="token class-name">Object</span> bean<span class="token punctuation">,</span> <span class="token class-name">String</span> beanName<span class="token punctuation">)</span>  <span class="token operator">-></span> <span class="token number">5.</span> <span class="token function">wrapIfNecessary</span><span class="token punctuation">(</span><span class="token class-name">Object</span> bean<span class="token punctuation">,</span> <span class="token class-name">String</span> beanName<span class="token punctuation">,</span> <span class="token class-name">Object</span> cacheKey<span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token number">6.</span> <span class="token function">shouldSkip</span><span class="token punctuation">(</span>bean<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> beanName<span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token function">findCandidateAdvisors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token number">7.</span> <span class="token keyword">this</span><span class="token punctuation">.</span>beanFactory<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> <span class="token class-name">Advisor</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token annotation punctuation">@Aspect</span> <span class="token comment">// è¡¨ç¤ºçš„æ˜¯åˆ‡é¢</span><span class="token annotation punctuation">@Component</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderImageAop</span> <span class="token punctuation">&#123;</span><span class="token comment">// åœ¨åˆ‡é¢ä¸­å®šä¹‰çš„åˆ‡ç‚¹ ï¼ˆPointcutï¼‰</span><span class="token comment">// å…¶ä¸­ ButtonBusinessService.process è¡¨ç¤ºçš„æ˜¯è¿æ¥ç‚¹ ï¼ˆJoint pointï¼‰</span>    <span class="token annotation punctuation">@Pointcut</span><span class="token punctuation">(</span><span class="token string">"execution(* hk.com.cre.process.workflow.button.ButtonBusinessService.process(..))"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">pointcut</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token comment">// å¢å¼ºï¼ˆAdviceï¼‰ è¿™äº›ä»£ç ä¼šæ¤å…¥åˆ° ButtonBusinessService çš„ä»£ç†ç±»ä¸­</span><span class="token annotation punctuation">@Around</span><span class="token punctuation">(</span><span class="token string">"pointcut()"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">doAround</span><span class="token punctuation">(</span><span class="token class-name">ProceedingJoinPoint</span> proceedingJoinPoint<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token class-name">ButtonBusinessServicePoxy</span> ç±»å…¶ä¸­æœ‰ä¸ª invoke æ–¹æ³•æ‰§è¡Œçš„å°±æ˜¯ å…·ä½“ç±»çš„ <span class="token function">process</span><span class="token punctuation">(</span><span class="token punctuation">)</span> æ–¹æ³•<span class="token annotation punctuation">@Before</span> å°±æ˜¯å…ˆæ‰§è¡Œ åœ¨è°ƒç”¨ å…·ä½“çš„ invoke   æºç ç±»ï¼š<span class="token class-name">MethodBeforeAdviceAdapter</span>å¦‚æœæ˜¯ <span class="token annotation punctuation">@Around</span> proceedingJoinPoint<span class="token punctuation">.</span><span class="token function">proceed</span><span class="token punctuation">(</span><span class="token punctuation">)</span> è¿™ä¸ªå°±æ˜¯å…·ä½“ç±»çš„æ–¹æ³•<span class="token comment">// æºç æŸ¥çœ‹ org.springframework.aop ä¸‹é¢çš„ç±»</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>LinuxæœåŠ¡å™¨Javaè¿›ç¨‹çªç„¶æ¶ˆå¤±</title>
      <link href="/2021/02/18/Linux-process-disappears/"/>
      <url>/2021/02/18/Linux-process-disappears/</url>
      
        <content type="html"><![CDATA[<h3 id="æ£€æŸ¥åº”ç”¨æ—¥å¿—æ˜¯å¦æœ‰å¼‚å¸¸æ—¥å¿—"><a href="#æ£€æŸ¥åº”ç”¨æ—¥å¿—æ˜¯å¦æœ‰å¼‚å¸¸æ—¥å¿—" class="headerlink" title="æ£€æŸ¥åº”ç”¨æ—¥å¿—æ˜¯å¦æœ‰å¼‚å¸¸æ—¥å¿—"></a>æ£€æŸ¥åº”ç”¨æ—¥å¿—æ˜¯å¦æœ‰å¼‚å¸¸æ—¥å¿—</h3><pre class="line-numbers language-none"><code class="language-none"> -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath&#x3D;$&#123;ç›®å½•&#125;ã€‚å‚æ•°è¯´æ˜ï¼šï¼ˆ1ï¼‰-XX:+HeapDumpOnOutOfMemoryErrorå‚æ•°è¡¨ç¤ºå½“JVMå‘ç”ŸOOMæ—¶ï¼Œè‡ªåŠ¨ç”ŸæˆDUMPæ–‡ä»¶ã€‚ï¼ˆ2ï¼‰-XX:HeapDumpPath&#x3D;$&#123;ç›®å½•&#125;å‚æ•°è¡¨ç¤ºç”ŸæˆDUMPæ–‡ä»¶çš„è·¯å¾„ï¼Œä¹Ÿå¯ä»¥æŒ‡å®šæ–‡ä»¶åç§°ã€‚ä¾‹å¦‚ï¼š-XX:HeapDumpPath&#x3D;$&#123;ç›®å½•&#125;&#x2F;java_heapdump.hprofã€‚å¦‚æœä¸æŒ‡å®šæ–‡ä»¶åï¼Œé»˜è®¤ä¸ºï¼šjava_&lt;pid&gt;_&lt;date&gt;_&lt;time&gt;_heapDump.hprofã€‚**ä¹‹åå¯ä»¥é€šè¿‡ä¸€äº›åˆ†æå·¥å…·æŸ¥çœ‹åº”ç”¨é—®é¢˜**<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="æ£€æŸ¥-JVM-æ˜¯å¦å¼‚å¸¸"><a href="#æ£€æŸ¥-JVM-æ˜¯å¦å¼‚å¸¸" class="headerlink" title="æ£€æŸ¥ JVM æ˜¯å¦å¼‚å¸¸"></a>æ£€æŸ¥ JVM æ˜¯å¦å¼‚å¸¸</h3><pre class="line-numbers language-none"><code class="language-none">å¯åŠ¨åº”ç”¨æ—¶æœ€å¥½æŒ‡ï¼šXX:ErrorFile&#x3D;&#x2F;var&#x2F;log&#x2F;hs_err_pid&lt;pid&gt;.logï¼Œæ²¡æœ‰æŒ‡å®šæ˜¯ç”Ÿæˆåœ¨å·¥ä½œç›®å½•ä¸‹<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="è¢«æ“ä½œç³»ç»ŸOOM-Killer"><a href="#è¢«æ“ä½œç³»ç»ŸOOM-Killer" class="headerlink" title="è¢«æ“ä½œç³»ç»ŸOOM-Killer"></a>è¢«æ“ä½œç³»ç»ŸOOM-Killer</h3><pre class="line-numbers language-none"><code class="language-none">Linux å†…æ ¸æœ‰ä¸ªæœºåˆ¶å«OOM killerï¼ˆOut-Of-Memory killerï¼‰ï¼Œè¯¥æœºåˆ¶ä¼šç›‘æ§é‚£äº›å ç”¨å†…å­˜è¿‡å¤§ï¼Œå°¤å…¶æ˜¯ç¬é—´å¾ˆå¿«æ¶ˆè€—å¤§é‡å†…å­˜çš„è¿›ç¨‹ï¼Œä¸ºäº†é˜²æ­¢å†…å­˜è€—å°½è€Œå†…æ ¸ä¼šæŠŠè¯¥è¿›ç¨‹æ€æ‰ã€‚å› æ­¤ï¼Œä½ å‘ç°javaè¿›ç¨‹çªç„¶æ²¡äº†ï¼Œé¦–å…ˆè¦æ€€ç–‘æ˜¯ä¸æ˜¯è¢«linuxçš„OOM killerç»™å¹²æ‰äº†ï¼ç³»ç»ŸæŠ¥é”™æ—¥å¿—:&#x2F;var&#x2F;log&#x2F;messagesgrep -i &#39;killed process&#39; &#x2F;var&#x2F;log&#x2F;messages  -i æ˜¯å¿½ç•¥å¤§å°å†™æˆ–è€…grep &#39;Out of memory&#39; &#x2F;var&#x2F;log&#x2F;messagesdmesg -T| grep java#æˆ–è€…dmesg -T | grep &#39;Out of memory&#39;# -T æ˜¯æ˜¾ç¤ºæ—¶é—´æˆ³<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>ã€€æ£€æŸ¥äº†ä¸‹ç›‘æ§ï¼Œå‘ç°å¤–ç½‘å¤§é‡çš„æµç¨‹å¯¼è‡´æ“ä½œç³»ç»Ÿ kill äº†è¿›ç¨‹ã€‚ <img src="/img/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%8720210218115721.png" alt="å¾®ä¿¡å›¾ç‰‡20210218115721.png"></p></blockquote><h3 id="è§£å†³æ–¹æ¡ˆ-Linux-Swap-é’ˆå¯¹å°å†…å­˜æœåŠ¡å™¨"><a href="#è§£å†³æ–¹æ¡ˆ-Linux-Swap-é’ˆå¯¹å°å†…å­˜æœåŠ¡å™¨" class="headerlink" title="è§£å†³æ–¹æ¡ˆ -&gt; Linux Swap , é’ˆå¯¹å°å†…å­˜æœåŠ¡å™¨"></a>è§£å†³æ–¹æ¡ˆ -&gt; Linux Swap , é’ˆå¯¹å°å†…å­˜æœåŠ¡å™¨</h3><blockquote><p>SWAP æ¦‚è¿° å½“ç³»ç»Ÿçš„ç‰©ç†å†…å­˜ä¸å¤Ÿç”¨çš„æ—¶å€™ï¼Œå°±éœ€è¦å°†ç‰©ç†å†…å­˜ä¸­çš„ä¸€éƒ¨åˆ†ç©ºé—´é‡Šæ”¾å‡ºæ¥ï¼Œä»¥ä¾›å½“å‰è¿è¡Œçš„ç¨‹åºä½¿ç”¨ã€‚é‚£äº›è¢«é‡Šæ”¾çš„ç©ºé—´å¯èƒ½æ¥è‡ªä¸€äº›å¾ˆé•¿æ—¶é—´æ²¡æœ‰ä»€ä¹ˆæ“ä½œçš„ç¨‹åºï¼Œè¿™äº›è¢«é‡Šæ”¾çš„ç©ºé—´è¢«ä¸´æ—¶ä¿å­˜åˆ°Swapç©ºé—´ä¸­ï¼Œç­‰åˆ°é‚£äº›ç¨‹åºè¦è¿è¡Œæ—¶ï¼Œå†ä»Swapä¸­æ¢å¤ä¿å­˜çš„æ•°æ®åˆ°å†…å­˜ä¸­ã€‚è¿™æ ·ï¼Œç³»ç»Ÿæ€»æ˜¯åœ¨ç‰©ç†å†…å­˜ä¸å¤Ÿæ—¶ï¼Œæ‰è¿›è¡ŒSwapäº¤æ¢ã€‚</p></blockquote><blockquote><p>swap çš„å¤§å°è®¾ç½®ä¸€èˆ¬æ˜¯å’Œå†…å­˜å¤§å°ä¸€æ ·æˆ–è€…è®¾ç½®ä¸ºå†…å­˜å¤§å°çš„2å€<br>å®é™…ä¸Šï¼Œå¹¶ä¸æ˜¯ç­‰æ‰€æœ‰çš„ç‰©ç†å†…å­˜éƒ½æ¶ˆè€—å®Œæ¯•ä¹‹åï¼Œæ‰å»ä½¿ç”¨swapçš„ç©ºé—´ï¼Œä»€ä¹ˆæ—¶å€™ä½¿ç”¨æ˜¯ç”±swappiness å‚æ•°å€¼æ§åˆ¶ã€‚ cat &#x2F;proc&#x2F;sys&#x2F;vm&#x2F;swappiness 60 è¯¥å€¼é»˜è®¤å€¼æ˜¯60. swappiness&#x3D;0çš„æ—¶å€™è¡¨ç¤ºæœ€å¤§é™åº¦ä½¿ç”¨ç‰©ç†å†…å­˜ï¼Œç„¶åæ‰æ˜¯ swapç©ºé—´ï¼Œ<br>swappinessï¼100çš„æ—¶å€™è¡¨ç¤ºç§¯æçš„ä½¿ç”¨swapåˆ†åŒºï¼Œå¹¶ä¸”æŠŠå†…å­˜ä¸Šçš„æ•°æ®åŠæ—¶çš„æ¬è¿åˆ°swapç©ºé—´é‡Œé¢ã€‚<br>æ°¸ä¹…ä¿®æ”¹ï¼š åœ¨&#x2F;etc&#x2F;sysctl.conf æ–‡ä»¶é‡Œæ·»åŠ å¦‚ä¸‹å‚æ•°ï¼š vm.swappiness&#x3D;10<br>sysctl -p ç”Ÿæ•ˆ</p></blockquote><h3 id="å¼€å¯-Swap"><a href="#å¼€å¯-Swap" class="headerlink" title="å¼€å¯ Swap"></a>å¼€å¯ Swap</h3><p><a href="https://blog.csdn.net/ygm_linux/article/details/24532809">https://blog.csdn.net/ygm_linux/article/details/24532809</a><br><a href="https://www.cnblogs.com/williamjie/p/10271347.html">https://www.cnblogs.com/williamjie/p/10271347.html</a></p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux åˆ é™¤å¤§æ–‡ä»¶å†…å®¹</title>
      <link href="/2021/01/28/linux-delete-big-file/"/>
      <url>/2021/01/28/linux-delete-big-file/</url>
      
        <content type="html"><![CDATA[<h3 id="æŸ¥çœ‹å½“å‰ç›®å½•ä¸‹ä¸€çº§å­æ–‡ä»¶å’Œå­ç›®å½•å ç”¨çš„ç£ç›˜å®¹é‡"><a href="#æŸ¥çœ‹å½“å‰ç›®å½•ä¸‹ä¸€çº§å­æ–‡ä»¶å’Œå­ç›®å½•å ç”¨çš„ç£ç›˜å®¹é‡" class="headerlink" title="æŸ¥çœ‹å½“å‰ç›®å½•ä¸‹ä¸€çº§å­æ–‡ä»¶å’Œå­ç›®å½•å ç”¨çš„ç£ç›˜å®¹é‡"></a>æŸ¥çœ‹å½“å‰ç›®å½•ä¸‹ä¸€çº§å­æ–‡ä»¶å’Œå­ç›®å½•å ç”¨çš„ç£ç›˜å®¹é‡</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">du</span> <span class="token parameter variable">-lh</span> --max-depth<span class="token operator">=</span><span class="token number">1</span> <span class="token operator">|</span> <span class="token function">sort</span> <span class="token parameter variable">-nr</span><span class="token function">du</span> <span class="token parameter variable">-m</span> â€“max-depth<span class="token operator">=</span><span class="token number">1</span> <span class="token operator">|</span><span class="token function">sort</span> <span class="token parameter variable">-gr</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="æŸ¥çœ‹æ ¹ç›®å½•ä¸‹å‰10å¤§çš„æ–‡ä»¶å¤¹"><a href="#æŸ¥çœ‹æ ¹ç›®å½•ä¸‹å‰10å¤§çš„æ–‡ä»¶å¤¹" class="headerlink" title="æŸ¥çœ‹æ ¹ç›®å½•ä¸‹å‰10å¤§çš„æ–‡ä»¶å¤¹"></a>æŸ¥çœ‹æ ¹ç›®å½•ä¸‹å‰10å¤§çš„æ–‡ä»¶å¤¹</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">du</span> / <span class="token operator">|</span> <span class="token function">sort</span> <span class="token parameter variable">-nr</span> <span class="token operator">|</span> <span class="token function">head</span> <span class="token parameter variable">-10</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="åˆ é™¤æ–‡ä»¶å†…å®¹"><a href="#åˆ é™¤æ–‡ä»¶å†…å®¹" class="headerlink" title="åˆ é™¤æ–‡ä»¶å†…å®¹"></a>åˆ é™¤æ–‡ä»¶å†…å®¹</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">åˆ é™¤æ–‡ä»¶åˆ°æŒ‡å®šçš„å¤§å° ï¼Œ <span class="token number">0</span> æ˜¯æŒ‡å®šçš„å¤§å°truncate <span class="token parameter variable">-s</span> <span class="token number">0</span> my_fileåˆ é™¤æ–‡ä»¶å†…å®¹<span class="token builtin class-name">echo</span> <span class="token string">""</span> <span class="token operator">></span> my_fileåˆ é™¤my_fileå‰é¢ç¬¬1è¡Œåˆ°10000è¡Œ <span class="token punctuation">(</span>è¿™ä¸ªæ¯”è¾ƒè€—æ—¶<span class="token punctuation">)</span><span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">'1,10000d'</span> my_fileç”¨lsofæ£€æŸ¥åæ‰å‘ç°åŸå› æ˜¯,æœ‰æ–‡ä»¶è¢«åˆ é™¤,è€Œè¿›ç¨‹è¿˜æ´»ç€,å› è€Œé€ æˆè¿˜å ç”¨ç©ºé—´çš„ç°è±¡<span class="token punctuation">[</span>root@/<span class="token punctuation">]</span><span class="token comment"># lsof |grep delete</span>æ ¹æ®lsofåˆ—å‡ºçš„è¿›ç¨‹å·,killè¿™äº›è¿›ç¨‹å,ç©ºé—´å°±é‡Šæ”¾å‡ºæ¥äº†<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è®°ä¸€ä¸ªhibernateå’Œredisç¼“å­˜å¼•èµ·çš„é”™è¯¯</title>
      <link href="/2020/12/18/hibernate-cache-error/"/>
      <url>/2020/12/18/hibernate-cache-error/</url>
      
        <content type="html"><![CDATA[<h3 id="é”™è¯¯ç°è±¡"><a href="#é”™è¯¯ç°è±¡" class="headerlink" title="é”™è¯¯ç°è±¡"></a>é”™è¯¯ç°è±¡</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Caused</span> by<span class="token operator">:</span> <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>hibernate<span class="token punctuation">.</span></span>LazyInitializationException</span><span class="token operator">:</span> failed <span class="token keyword">to</span> <span class="token namespace">lazily</span> initialize a collection<span class="token punctuation">,</span> could not initialize proxy <span class="token operator">-</span> no <span class="token class-name">Session</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>hibernate<span class="token punctuation">.</span>collection<span class="token punctuation">.</span>internal<span class="token punctuation">.</span></span>AbstractPersistentCollection</span><span class="token punctuation">.</span><span class="token function">throwLazyInitializationException</span><span class="token punctuation">(</span><span class="token class-name">AbstractPersistentCollection</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">587</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>hibernate<span class="token punctuation">.</span>collection<span class="token punctuation">.</span>internal<span class="token punctuation">.</span></span>AbstractPersistentCollection</span><span class="token punctuation">.</span><span class="token function">withTemporarySessionIfNeeded</span><span class="token punctuation">(</span><span class="token class-name">AbstractPersistentCollection</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">204</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>hibernate<span class="token punctuation">.</span>collection<span class="token punctuation">.</span>internal<span class="token punctuation">.</span></span>AbstractPersistentCollection</span><span class="token punctuation">.</span><span class="token function">readSize</span><span class="token punctuation">(</span><span class="token class-name">AbstractPersistentCollection</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">148</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>hibernate<span class="token punctuation">.</span>collection<span class="token punctuation">.</span>internal<span class="token punctuation">.</span></span>PersistentBag</span><span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token class-name">PersistentBag</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">261</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>fasterxml<span class="token punctuation">.</span>jackson<span class="token punctuation">.</span>databind<span class="token punctuation">.</span>ser<span class="token punctuation">.</span>std<span class="token punctuation">.</span></span>CollectionSerializer</span><span class="token punctuation">.</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token class-name">CollectionSerializer</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">102</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>fasterxml<span class="token punctuation">.</span>jackson<span class="token punctuation">.</span>databind<span class="token punctuation">.</span>ser<span class="token punctuation">.</span>std<span class="token punctuation">.</span></span>CollectionSerializer</span><span class="token punctuation">.</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token class-name">CollectionSerializer</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">25</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>fasterxml<span class="token punctuation">.</span>jackson<span class="token punctuation">.</span>databind<span class="token punctuation">.</span>ser<span class="token punctuation">.</span></span>BeanPropertyWriter</span><span class="token punctuation">.</span><span class="token function">serializeAsField</span><span class="token punctuation">(</span><span class="token class-name">BeanPropertyWriter</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">704</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>fasterxml<span class="token punctuation">.</span>jackson<span class="token punctuation">.</span>databind<span class="token punctuation">.</span>ser<span class="token punctuation">.</span>std<span class="token punctuation">.</span></span>BeanSerializerBase</span><span class="token punctuation">.</span><span class="token function">serializeFields</span><span class="token punctuation">(</span><span class="token class-name">BeanSerializerBase</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">690</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token number">76</span> common frames omitted<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="åŸå› åˆ†æ"><a href="#åŸå› åˆ†æ" class="headerlink" title="åŸå› åˆ†æ"></a>åŸå› åˆ†æ</h3><p>å¯¼è‡´è¿™ä¸ªçš„åŸå› æ˜¯å› ä¸ºredisä¸­ç¼“å­˜äº†æŸ¥è¯¢çš„æ•°æ®ï¼š<br>ä½¿ç”¨@Cacheable æ³¨è§£ï¼ŒRedisæ•°æ®å­˜å‚¨å¦‚ä¸‹ï¼š</p><blockquote><p>{â€œ@classâ€:â€hk.com.cre.process.basic.dto.SrmcfgProcessDtoâ€,â€serviceItemRelsâ€:[â€œorg.hibernate.collection.internal.PersistentBagâ€,[]],â€cChrDataSourceâ€:null}</p></blockquote><blockquote><p>è¿™é‡Œæœ‰æ„æ€çš„æ˜¯ org.hibernate.collection.internal.PersistentBag å½“redisååºåˆ—è¿™ä¸ªç±»æ—¶ï¼Œæ˜¯æ²¡æœ‰å½“å‰hibernate sessionçš„ï¼Œåœ¨readSize()ä¸­ä¼šè°ƒç”¨ withTemporarySessionIfNeededï¼Œè¿™ä¸ªæ–¹æ³•æ˜¯å…¶ä¸­çš„å…³é”®ç‚¹æ˜¯ allowLoadOutsideTransactionï¼Œå¦‚æœè¿™ä¸ªä¸º true æ˜¯ä¼šå¼€å¯ä¸€ä¸ª readOnly çš„äº‹ç‰©å»æŸ¥è¯¢æ•°æ®çš„ï¼Œä½†æ˜¯rediså®ä¾‹åŒ– PersistentBag åªä¼šè°ƒç”¨æ— å‚æ„é€ å‡½æ•°æ¥å®ä¾‹åŒ–ï¼Œå°±å¯¼è‡´è¿™ä¸ª allowLoadOutsideTransaction ä¸€ç›´æ˜¯false</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Feignä¸åŒæœåŠ¡çš„bean å¦‚ä½•ä¸é‡å¤</title>
      <link href="/2020/12/07/Feign-Different-Bean-Question/"/>
      <url>/2020/12/07/Feign-Different-Bean-Question/</url>
      
        <content type="html"><![CDATA[<h3 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h3><p>é¡¹ç›®ä¸­ä½¿ç”¨äº† Feign ç»„ä»¶ï¼ŒæŒ‡å®š Fallback æ—¶éœ€è¦è¿™ä¸ªç±»æ˜¯åœ¨spring bean ,ä½¿ç”¨ @Component æ ‡è®°ï¼Œç±»åä¸º ATest.class ï¼Œä½¿ç”¨ @Component æ³¨è§£ç”Ÿæˆçš„bean name æ˜¯ç±»åç¬¬ä¸€ä¸ªå­—æ¯å°å†™çš„ï¼Œä¹Ÿå°±æ˜¯ aTestã€‚è¿™æ—¶åŒäº‹ä½¿ç”¨äº† @Bean æ³¨è§£ æ ‡æ³¨ä¸‹é¢çš„æ–¹æ³•ç”Ÿæˆbean , public xxx aTest(){}ã€‚@Bean ç”Ÿæˆ bean çš„è§„åˆ™æ˜¯ä½¿ç”¨çš„æ–¹æ³•åç§°ï¼Œä¹Ÿæ˜¯ aTest ã€‚</p><h3 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h3><p>æœ‰è¶£çš„é—®é¢˜å°±æ¥äº†ï¼Œè¿™æ—¶ç”Ÿæˆçš„éƒ½æ˜¯ aTest ï¼Œspringæ˜¯æ€ä¹ˆå¤„ç†çš„ï¼Ÿåœ¨åŒä¸€ä¸ªé¡¹ç›®ä¸­ï¼Œbean name æ˜¯ä¸å…è®¸é‡å¤çš„ï¼Œå¯åŠ¨ä¼šæŠ¥é”™ã€‚ä½†æ˜¯ä½¿ç”¨çš„ Feign ç»„ä»¶ï¼Œæ¶‰åŠåˆ°å„ä¸ªå¾®æœåŠ¡çš„ç›¸äº’è°ƒç”¨ï¼ŒFeign æ˜¯æ€ä¹ˆéš”ç¦»ä¸åŒæœåŠ¡ä¹‹é—´çš„ bean çš„å‘¢ï¼Ÿä¸åŒå¾®æœåŠ¡ bean name ç›¸åŒä¼šå¯¼è‡´ä»€ä¹ˆé—®é¢˜ï¼Ÿ</p><h3 id="æ–¹æ¡ˆ"><a href="#æ–¹æ¡ˆ" class="headerlink" title="æ–¹æ¡ˆ"></a>æ–¹æ¡ˆ</h3><p>Feign å…¶ä¸­æœ‰ FeignContext extends NamedContextFactory ï¼Œå…¶ä¸­ä½¿ç”¨äº† map ç»“æ„æ¥å­˜å‚¨ä¸åŒçš„ applicationContext ï¼Œæ¯ä¸ªæœåŠ¡éƒ½æœ‰ä¸€ä¸ªå­å®¹å™¨ï¼Œé¦–å…ˆé€šè¿‡æœåŠ¡åè·å–å­å®¹å™¨ï¼Œå†æ ¹æ®Classè·å–åˆ°è¿™ä¸ªå®¹å™¨å†…çš„bean</p><blockquote><p>Map&lt;String, AnnotationConfigApplicationContext&gt; contexts &#x3D; new ConcurrentHashMap();</p></blockquote><h3 id="æºç "><a href="#æºç " class="headerlink" title="æºç "></a>æºç </h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">protected</span> <span class="token class-name">AnnotationConfigApplicationContext</span> <span class="token function">getContext</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>contexts<span class="token punctuation">.</span><span class="token function">containsKey</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">synchronized</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>contexts<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>contexts<span class="token punctuation">.</span><span class="token function">containsKey</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token comment">// æ²¡æœ‰åˆ™å…ˆåˆ›å»º context</span>                    <span class="token keyword">this</span><span class="token punctuation">.</span>contexts<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">createContext</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">AnnotationConfigApplicationContext</span><span class="token punctuation">)</span><span class="token keyword">this</span><span class="token punctuation">.</span>contexts<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">HystrixTargeter</span>  ä¸­è·å– fallback å®ä¾‹<span class="token keyword">private</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> <span class="token class-name">T</span> <span class="token function">getFromContext</span><span class="token punctuation">(</span><span class="token class-name">String</span> fallbackMechanism<span class="token punctuation">,</span> <span class="token class-name">String</span> feignClientName<span class="token punctuation">,</span> <span class="token class-name">FeignContext</span> context<span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span> beanType<span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> targetType<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token comment">// æ ¹æ® feignClientName è·å–ä¸åŒçš„ bean </span>        <span class="token class-name">Object</span> fallbackInstance <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>feignClientName<span class="token punctuation">,</span> beanType<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>fallbackInstance <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalStateException</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"No "</span> <span class="token operator">+</span> fallbackMechanism <span class="token operator">+</span> <span class="token string">" instance of type %s found for feign client %s"</span><span class="token punctuation">,</span> beanType<span class="token punctuation">,</span> feignClientName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>targetType<span class="token punctuation">.</span><span class="token function">isAssignableFrom</span><span class="token punctuation">(</span>beanType<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalStateException</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"Incompatible "</span> <span class="token operator">+</span> fallbackMechanism <span class="token operator">+</span> <span class="token string">" instance. Fallback/fallbackFactory of type %s is not assignable to %s for feign client %s"</span><span class="token punctuation">,</span> beanType<span class="token punctuation">,</span> targetType<span class="token punctuation">,</span> feignClientName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> fallbackInstance<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux å¤§æ–‡ä»¶æŸ¥æ‰¾</title>
      <link href="/2020/11/20/linux-find-big-file/"/>
      <url>/2020/11/20/linux-find-big-file/</url>
      
        <content type="html"><![CDATA[<h3 id="du-å‘½ä»¤ç”¨äºæ˜¾ç¤ºç›®å½•æˆ–æ–‡ä»¶çš„å¤§å°"><a href="#du-å‘½ä»¤ç”¨äºæ˜¾ç¤ºç›®å½•æˆ–æ–‡ä»¶çš„å¤§å°" class="headerlink" title="du å‘½ä»¤ç”¨äºæ˜¾ç¤ºç›®å½•æˆ–æ–‡ä»¶çš„å¤§å°"></a>du å‘½ä»¤ç”¨äºæ˜¾ç¤ºç›®å½•æˆ–æ–‡ä»¶çš„å¤§å°</h3><ul><li>-b æ˜¾ç¤ºç›®å½•æˆ–æ–‡ä»¶å¤§å°æ—¶ï¼Œä»¥byteä¸ºå•ä½ã€‚</li><li>-h ä»¥Kï¼ŒMï¼ŒGä¸ºå•ä½ï¼Œæé«˜ä¿¡æ¯çš„å¯è¯»æ€§ã€‚ <strong>ä½¿ç”¨è¿™ä¸ªä¼šå¯¼è‡´æ’åºé—®é¢˜</strong><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">##è¿”å›å‰åçš„å¤§ç›®å½•</span><span class="token function">du</span> / <span class="token operator">|</span> <span class="token function">sort</span> <span class="token parameter variable">-nr</span> <span class="token operator">|</span> <span class="token function">head</span> <span class="token parameter variable">-10</span><span class="token comment">##æŸ¥æ‰¾å¤§æ–‡ä»¶</span><span class="token function">find</span> / <span class="token parameter variable">-type</span> f <span class="token parameter variable">-size</span> +800M  <span class="token parameter variable">-print0</span> <span class="token operator">|</span> <span class="token function">xargs</span> <span class="token parameter variable">-0</span> <span class="token function">ls</span> <span class="token parameter variable">-l</span><span class="token function">ls</span> <span class="token parameter variable">-lh</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åœ¨ Web ç¨‹åºä¸­ä½¿ç”¨å¤šçº¿ç¨‹å¤„ç†ä»»åŠ¡ï¼ŒRequestContextHolder notifyAttributeAssigned NullPointerException å¼‚å¸¸</title>
      <link href="/2020/11/10/NullPointerException-notifyAttributeAssigned/"/>
      <url>/2020/11/10/NullPointerException-notifyAttributeAssigned/</url>
      
        <content type="html"><![CDATA[<h2 id="èµ·å› "><a href="#èµ·å› " class="headerlink" title="èµ·å› "></a>èµ·å› </h2><p>åœ¨ web ç¨‹åºä¸­ä½¿ç”¨å¤šçº¿ç¨‹å¤„ç†ä»»åŠ¡æŠ¥å¦‚ä¸‹é”™è¯¯</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Caused</span> by<span class="token operator">:</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>NullPointerException</span><span class="token operator">:</span> <span class="token keyword">null</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>catalina<span class="token punctuation">.</span>connector<span class="token punctuation">.</span></span>Request</span><span class="token punctuation">.</span><span class="token function">notifyAttributeAssigned</span><span class="token punctuation">(</span><span class="token class-name">Request</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">1528</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>catalina<span class="token punctuation">.</span>connector<span class="token punctuation">.</span></span>Request</span><span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token class-name">Request</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">1514</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>catalina<span class="token punctuation">.</span>connector<span class="token punctuation">.</span></span>RequestFacade</span><span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token class-name">RequestFacade</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">540</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span>ServletRequestWrapper</span><span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token class-name">ServletRequestWrapper</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">252</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>session<span class="token punctuation">.</span>web<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span>SessionRepositoryFilter</span>$<span class="token class-name">SessionRepositoryRequestWrapper</span><span class="token punctuation">.</span><span class="token function">setCurrentSession</span><span class="token punctuation">(</span><span class="token class-name">SessionRepositoryFilter</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">264</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>session<span class="token punctuation">.</span>web<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span>SessionRepositoryFilter</span>$<span class="token class-name">SessionRepositoryRequestWrapper</span><span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token class-name">SessionRepositoryFilter</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">375</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>session<span class="token punctuation">.</span>web<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span>SessionRepositoryFilter</span>$<span class="token class-name">SessionRepositoryRequestWrapper</span><span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token class-name">SessionRepositoryFilter</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">390</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>session<span class="token punctuation">.</span>web<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span>SessionRepositoryFilter</span>$<span class="token class-name">SessionRepositoryRequestWrapper</span><span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token class-name">SessionRepositoryFilter</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">217</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span>HttpServletRequestWrapper</span><span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequestWrapper</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">240</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">hk<span class="token punctuation">.</span>com<span class="token punctuation">.</span>cre<span class="token punctuation">.</span>process<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span>SessionUtil</span><span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token class-name">SessionUtil</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">127</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">hk<span class="token punctuation">.</span>com<span class="token punctuation">.</span>cre<span class="token punctuation">.</span>process<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span>SessionUtil</span><span class="token punctuation">.</span><span class="token function">getSessionId</span><span class="token punctuation">(</span><span class="token class-name">SessionUtil</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">131</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">hk<span class="token punctuation">.</span>com<span class="token punctuation">.</span>cre<span class="token punctuation">.</span>process<span class="token punctuation">.</span>interceptor<span class="token punctuation">.</span></span>FeignRequestInterceptor</span><span class="token punctuation">.</span>lambda$headerInterceptor$<span class="token function">80</span><span class="token punctuation">(</span><span class="token class-name">FeignRequestInterceptor</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">28</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">feign<span class="token punctuation">.</span></span>SynchronousMethodHandler</span><span class="token punctuation">.</span><span class="token function">targetRequest</span><span class="token punctuation">(</span><span class="token class-name">SynchronousMethodHandler</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">158</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">feign<span class="token punctuation">.</span></span>SynchronousMethodHandler</span><span class="token punctuation">.</span><span class="token function">executeAndDecode</span><span class="token punctuation">(</span><span class="token class-name">SynchronousMethodHandler</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">88</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">feign<span class="token punctuation">.</span></span>SynchronousMethodHandler</span><span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">SynchronousMethodHandler</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">76</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">feign<span class="token punctuation">.</span>hystrix<span class="token punctuation">.</span></span>HystrixInvocationHandler</span>$<span class="token number">1.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">HystrixInvocationHandler</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">108</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>netflix<span class="token punctuation">.</span>hystrix<span class="token punctuation">.</span></span>HystrixCommand</span>$<span class="token number">2.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token class-name">HystrixCommand</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">301</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>netflix<span class="token punctuation">.</span>hystrix<span class="token punctuation">.</span></span>HystrixCommand</span>$<span class="token number">2.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token class-name">HystrixCommand</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">297</span><span class="token punctuation">)</span>at <span class="token class-name"><span class="token namespace">rx<span class="token punctuation">.</span>internal<span class="token punctuation">.</span>operators<span class="token punctuation">.</span></span>OnSubscribeDefer</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token class-name">OnSubscribeDefer</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">46</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java">å…³é”®ç±»å¯¼è‡´ï¼š<span class="token class-name">RequestAttributes</span> requestAttributes <span class="token operator">=</span> <span class="token class-name">RequestContextHolder</span><span class="token punctuation">.</span><span class="token function">getRequestAttributes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// SessionRepositoryFilter&lt;S>.SessionRepositoryRequestWrapper</span><span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span><span class="token punctuation">&#123;</span><span class="token class-name">RequestContextHolder</span><span class="token punctuation">.</span><span class="token function">setRequestAttributes</span><span class="token punctuation">(</span>requestAttributes<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// ä¹‹ååœ¨æƒ³é€šè¿‡è¿™ä¸ªè·å– request é‡Œé¢çš„ä¸œè¥¿å·²ç»æ˜¯è·å–ä¸åˆ°äº†</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">ServletRequestAttributes</span><span class="token punctuation">)</span> <span class="token class-name">RequestContextHolder</span><span class="token punctuation">.</span><span class="token function">getRequestAttributes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token class-name">SessionRepositoryFilter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">S</span><span class="token punctuation">></span></span><span class="token punctuation">.</span>SessionRepositoryRequestWrapper<span class="token punctuation">.</span>HttpSessionWrapper <span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token comment">// è·å–æ—¶æ¯æ¬¡éƒ½æ–°åˆ›å»º session</span>   <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">// ä¹‹åä¼šè°ƒç”¨</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setCurrentSession</span><span class="token punctuation">(</span>currentSession<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// æœ€ç»ˆä¼šè°ƒç”¨ notifyAttributeAssigned()</span><span class="token comment">// åœ¨è¿™ä¸ªè¯·æ±‚é‡Œé¢ context ä¸ºç©º å¯¼è‡´ä¸Šé¢çš„å¼‚å¸¸</span><span class="token class-name">Context</span> context <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>ç¬¬äºŒç§å†™æ³•<span class="token class-name">RequestAttributes</span> requestAttributes <span class="token operator">=</span> <span class="token class-name">RequestContextHolder</span><span class="token punctuation">.</span><span class="token function">getRequestAttributes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// true è®¾ç½®å­çº¿ç¨‹å…±äº«</span><span class="token class-name">RequestContextHolder</span><span class="token punctuation">.</span><span class="token function">setRequestAttributes</span><span class="token punctuation">(</span>requestAttributes<span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="äº‹æ•…æµ‹è¯•çš„æ–¹æ³•ï¼š"><a href="#äº‹æ•…æµ‹è¯•çš„æ–¹æ³•ï¼š" class="headerlink" title="äº‹æ•…æµ‹è¯•çš„æ–¹æ³•ï¼š"></a>äº‹æ•…æµ‹è¯•çš„æ–¹æ³•ï¼š</h2><pre class="line-numbers language-none"><code class="language-none">@RequestMapping(value &#x3D; &quot;&#x2F;help&#x2F;demo&quot;, method &#x3D; RequestMethod.GET, produces &#x3D; MediaType.APPLICATION_JSON_UTF8_VALUE)    public Object demo() &#123;        RequestAttributes requestAttributes &#x3D; RequestContextHolder.getRequestAttributes();        RequestContextHolder.setRequestAttributes(requestAttributes,true);        new Thread(() -&gt; &#123;            try &#123;&#x2F;&#x2F; è¿™é‡Œæ•…æ„è®©ä¸»çº¿ç¨‹ç»“æŸï¼Œä¸‹é¢å°±ä¼šè·å–ä¸åˆ°å€¼                Thread.sleep(10000);            &#125; catch (InterruptedException e) &#123;                e.printStackTrace();            &#125;            &#x2F;&#x2F; RequestContextHolder.setRequestAttributes(requestAttributes);            HttpServletRequest request &#x3D; ((ServletRequestAttributes) RequestContextHolder.getRequestAttributes()).getRequest();&#x2F;&#x2F; è·å–å‚æ•°æˆ–è€… session éƒ½éœ€è¦ä¸»çº¿ç¨‹ä¸ç»“æŸçš„å‰æä¸‹æ‰èƒ½è·å–åˆ°&#x2F;&#x2F; å½“ä¸»è¯·æ±‚ç»“æŸï¼Œå­çº¿ç¨‹é‡Œé¢çš„ request å¯¹è±¡ä¹Ÿéƒ½ä¼šæ¸…é™¤æ•°æ® .&#x2F;&#x2F; å½“ä¸»è¯·æ±‚ç»“æŸ ï¼Œé‚£ä¹ˆ Context context &#x3D; this.getContext(); ä¹Ÿå°±æ˜¯ null äº†ã€‚            request.getParameter(&quot;test&quot;)        &#125;).start();        try &#123;            Thread.sleep(20000);        &#125; catch (InterruptedException e) &#123;            e.printStackTrace();        &#125;&#x2F;&#x2F; try &#123; &#x2F;&#x2F;               Thread.sleep(20000); &#x2F;&#x2F;           &#125; catch (InterruptedException e) &#123; &#x2F;&#x2F;               e.printStackTrace(); &#x2F;&#x2F;           &#125;        return &quot;demo&quot;;    &#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="æºç è§£è¯»ï¼š"><a href="#æºç è§£è¯»ï¼š" class="headerlink" title="æºç è§£è¯»ï¼š"></a>æºç è§£è¯»ï¼š</h2><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// åœ¨ DispatcherServlet extends FrameworkServlet çˆ¶ç±»ä¸­çš„æºç </span><span class="token keyword">protected</span> <span class="token keyword">final</span> <span class="token keyword">void</span> <span class="token function">processRequest</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">long</span> startTime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Throwable</span> failureCause <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>        <span class="token class-name">LocaleContext</span> previousLocaleContext <span class="token operator">=</span> <span class="token class-name">LocaleContextHolder</span><span class="token punctuation">.</span><span class="token function">getLocaleContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">LocaleContext</span> localeContext <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">buildLocaleContext</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">RequestAttributes</span> previousAttributes <span class="token operator">=</span> <span class="token class-name">RequestContextHolder</span><span class="token punctuation">.</span><span class="token function">getRequestAttributes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">ServletRequestAttributes</span> requestAttributes <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">buildRequestAttributes</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">,</span> previousAttributes<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">WebAsyncManager</span> asyncManager <span class="token operator">=</span> <span class="token class-name">WebAsyncUtils</span><span class="token punctuation">.</span><span class="token function">getAsyncManager</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>        asyncManager<span class="token punctuation">.</span><span class="token function">registerCallableInterceptor</span><span class="token punctuation">(</span><span class="token class-name">FrameworkServlet</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">FrameworkServlet<span class="token punctuation">.</span>RequestBindingInterceptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">initContextHolders</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> localeContext<span class="token punctuation">,</span> requestAttributes<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">doService</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ServletException</span> var17<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            failureCause <span class="token operator">=</span> var17<span class="token punctuation">;</span>            <span class="token keyword">throw</span> var17<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> var18<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            failureCause <span class="token operator">=</span> var18<span class="token punctuation">;</span>            <span class="token keyword">throw</span> var18<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> var19<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            failureCause <span class="token operator">=</span> var19<span class="token punctuation">;</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">NestedServletException</span><span class="token punctuation">(</span><span class="token string">"Request processing failed"</span><span class="token punctuation">,</span> var19<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span> <span class="token comment">// é‡ç½® previousAttributes</span>            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">resetContextHolders</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> previousLocaleContext<span class="token punctuation">,</span> previousAttributes<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>requestAttributes <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                requestAttributes<span class="token punctuation">.</span><span class="token function">requestCompleted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>logger<span class="token punctuation">.</span><span class="token function">isDebugEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>failureCause <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token keyword">this</span><span class="token punctuation">.</span>logger<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"Could not complete request"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span><span class="token punctuation">)</span>failureCause<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>asyncManager<span class="token punctuation">.</span><span class="token function">isConcurrentHandlingStarted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token keyword">this</span><span class="token punctuation">.</span>logger<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"Leaving response open for concurrent processing"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                    <span class="token keyword">this</span><span class="token punctuation">.</span>logger<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"Successfully completed request"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">publishRequestHandledEvent</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">,</span> startTime<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span><span class="token punctuation">)</span>failureCause<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="å¼•å‘çš„é—®é¢˜ï¼šè¿™æ ·çš„è¯å¿…é¡»ç­‰å¾…å­çº¿ç¨‹å¤„ç†å®Œæˆï¼Œä¸»çº¿ç¨‹æ‰èƒ½ç»“æŸï¼Œè¿™æ ·åˆå˜æˆåŒæ­¥æ‰§è¡Œäº†ï¼Œå¼‚æ­¥å¤±å»äº†æ„ä¹‰ã€‚"><a href="#å¼•å‘çš„é—®é¢˜ï¼šè¿™æ ·çš„è¯å¿…é¡»ç­‰å¾…å­çº¿ç¨‹å¤„ç†å®Œæˆï¼Œä¸»çº¿ç¨‹æ‰èƒ½ç»“æŸï¼Œè¿™æ ·åˆå˜æˆåŒæ­¥æ‰§è¡Œäº†ï¼Œå¼‚æ­¥å¤±å»äº†æ„ä¹‰ã€‚" class="headerlink" title="å¼•å‘çš„é—®é¢˜ï¼šè¿™æ ·çš„è¯å¿…é¡»ç­‰å¾…å­çº¿ç¨‹å¤„ç†å®Œæˆï¼Œä¸»çº¿ç¨‹æ‰èƒ½ç»“æŸï¼Œè¿™æ ·åˆå˜æˆåŒæ­¥æ‰§è¡Œäº†ï¼Œå¼‚æ­¥å¤±å»äº†æ„ä¹‰ã€‚"></a>å¼•å‘çš„é—®é¢˜ï¼šè¿™æ ·çš„è¯å¿…é¡»ç­‰å¾…å­çº¿ç¨‹å¤„ç†å®Œæˆï¼Œä¸»çº¿ç¨‹æ‰èƒ½ç»“æŸï¼Œè¿™æ ·åˆå˜æˆåŒæ­¥æ‰§è¡Œäº†ï¼Œå¼‚æ­¥å¤±å»äº†æ„ä¹‰ã€‚</h3><h2 id="å¤šçº¿ç¨‹å¦‚ä½•ä¼ é€’-request-å‚æ•°æˆ–è€…-session-ï¼Ÿ"><a href="#å¤šçº¿ç¨‹å¦‚ä½•ä¼ é€’-request-å‚æ•°æˆ–è€…-session-ï¼Ÿ" class="headerlink" title="å¤šçº¿ç¨‹å¦‚ä½•ä¼ é€’ request å‚æ•°æˆ–è€… session ï¼Ÿ"></a>å¤šçº¿ç¨‹å¦‚ä½•ä¼ é€’ request å‚æ•°æˆ–è€… session ï¼Ÿ</h2><ol><li>åœ¨ä¸»çº¿ç¨‹ä¸­è·å–åˆ°éœ€è¦çš„ä¿¡æ¯ï¼Œä½¿ç”¨å‚æ•°ä¼ é€’åˆ°å­çº¿ç¨‹ä¸­</li><li>åŒ…è£… request å°†æ•°æ®å¤åˆ¶ä¸€ä»½åœ¨å†…å­˜ä¸­ï¼Œä½¿ç”¨ ThreadLocal</li></ol>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æµè§ˆå™¨ SameSite å±æ€§è®¾ç½®</title>
      <link href="/2020/09/08/browser-cookies-SameSite-attribute/"/>
      <url>/2020/09/08/browser-cookies-SameSite-attribute/</url>
      
        <content type="html"><![CDATA[<h3 id="1-èµ·å› "><a href="#1-èµ·å› " class="headerlink" title="1. èµ·å› "></a>1. èµ·å› </h3><p>Chrome 51 å¼€å§‹ï¼Œæµè§ˆå™¨çš„ Cookie æ–°å¢åŠ äº†ä¸€ä¸ªSameSiteå±æ€§ï¼Œç”¨æ¥é˜²æ­¢ CSRF æ”»å‡»å’Œç”¨æˆ·è¿½è¸ªã€‚<br>Chrome æµè§ˆå™¨ç‰ˆæœ¬ä» 80 ç‰ˆå é»˜è®¤æ˜¯å°† Cookie è®¾ç½®æˆ Lax</p><h3 id="2-SameSite-å±æ€§å€¼"><a href="#2-SameSite-å±æ€§å€¼" class="headerlink" title="2. SameSite å±æ€§å€¼"></a>2. SameSite å±æ€§å€¼</h3><ul><li>Strict</li><li>Lax</li><li>None<blockquote><p>Strictæœ€ä¸ºä¸¥æ ¼ï¼Œå®Œå…¨ç¦æ­¢ç¬¬ä¸‰æ–¹ Cookieï¼Œè·¨ç«™ç‚¹æ—¶ï¼Œä»»ä½•æƒ…å†µä¸‹éƒ½ä¸ä¼šå‘é€ Cookieã€‚æ¢è¨€ä¹‹ï¼Œåªæœ‰å½“å‰ç½‘é¡µçš„ URL ä¸è¯·æ±‚ç›®æ ‡ä¸€è‡´ï¼Œæ‰ä¼šå¸¦ä¸Š Cookieã€‚Laxè§„åˆ™ç¨ç¨æ”¾å®½ï¼Œå¤§å¤šæ•°æƒ…å†µä¹Ÿæ˜¯ä¸å‘é€ç¬¬ä¸‰æ–¹ Cookieï¼Œä½†æ˜¯å¯¼èˆªåˆ°ç›®æ ‡ç½‘å€çš„ Get è¯·æ±‚é™¤å¤–ã€‚</p></blockquote></li></ul><table><thead><tr><th>è¯·æ±‚ç±»å‹</th><th>ç¤ºä¾‹</th><th>æ­£å¸¸æƒ…å†µ</th><th>Lax</th></tr></thead><tbody><tr><td>é“¾æ¥</td><td>ã€Ša href&#x3D;â€â€¦â€&gt;</td><td>å‘é€ Cookie</td><td>å‘é€ Cookie</td></tr><tr><td>é¢„åŠ è½½</td><td>ã€Šlink rel&#x3D;â€prerenderâ€ href&#x3D;â€â€¦â€&#x2F;&gt;</td><td>å‘é€ Cookie</td><td>å‘é€ Cookie</td></tr><tr><td>GET è¡¨å•</td><td>ã€Šform method&#x3D;â€GETâ€ action&#x3D;â€â€¦â€&gt;</td><td>å‘é€Cookie</td><td>å‘é€ Cookie</td></tr><tr><td>POST è¡¨å•</td><td>ã€Šform method&#x3D;â€POSTâ€ action&#x3D;â€â€¦â€&gt;</td><td>å‘é€ Cookie</td><td>ä¸å‘é€</td></tr><tr><td>iframe</td><td>ã€Šiframe src&#x3D;â€â€¦â€&gt;</td><td>å‘é€ Cookie</td><td>ä¸å‘é€</td></tr><tr><td>AJAX</td><td>$.get(â€œâ€¦â€)</td><td>å‘é€ Cookie</td><td>ä¸å‘é€</td></tr><tr><td>Image</td><td>ã€Šimg src&#x3D;â€â€¦â€ã€‹</td><td>å‘é€ Cookie</td><td>ä¸å‘é€</td></tr></tbody></table><p>Chrome è®¡åˆ’å°†Laxå˜ä¸ºé»˜è®¤è®¾ç½®ã€‚è¿™æ—¶ï¼Œç½‘ç«™å¯ä»¥é€‰æ‹©æ˜¾å¼å…³é—­SameSiteå±æ€§ï¼Œ<strong>å°†å…¶è®¾ä¸ºNoneã€‚ä¸è¿‡ï¼Œå‰ææ˜¯å¿…é¡»åŒæ—¶è®¾ç½®Secureå±æ€§ï¼ˆCookie åªèƒ½é€šè¿‡ HTTPS åè®®å‘é€ï¼‰ï¼Œå¦åˆ™æ— æ•ˆã€‚</strong></p><pre class="line-numbers language-language" data-language="language"><code class="language-language">ä¸‹é¢çš„è®¾ç½®æ— æ•ˆã€‚Set-Cookie: widget_session&#x3D;abc123; SameSite&#x3D;Noneä¸‹é¢çš„è®¾ç½®æœ‰æ•ˆã€‚Set-Cookie: widget_session&#x3D;abc123; SameSite&#x3D;None; Secure<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="3-è¯¥ç”¨å“ªç§æ¨¡å¼ï¼Ÿ"><a href="#3-è¯¥ç”¨å“ªç§æ¨¡å¼ï¼Ÿ" class="headerlink" title="3. è¯¥ç”¨å“ªç§æ¨¡å¼ï¼Ÿ"></a>3. è¯¥ç”¨å“ªç§æ¨¡å¼ï¼Ÿ</h3><p>å‡å¦‚ä½ çš„ç½‘ç«™æœ‰ç”¨ iframe å½¢å¼åµŒåœ¨åˆ«çš„ç½‘ç«™é‡Œçš„éœ€æ±‚ï¼Œé‚£ä¹ˆè¿ Lax ä½ ä¹Ÿä¸èƒ½ç”¨ï¼Œå› ä¸º iframe è¯·æ±‚ä¹Ÿæ˜¯ä¸€ç§å¼‚æ­¥è¯·æ±‚ã€‚æˆ–è€…å‡å¦‚åˆ«çš„ç½‘ç«™æœ‰ä½¿ç”¨ä½ çš„ç½‘ç«™çš„ JSONP æ¥å£ï¼Œé‚£ä¹ˆåŒæ · Lax ä½ ä¹Ÿä¸èƒ½ç”¨ï¼Œæ¯”å¦‚å¤©çŒ«å°±æ˜¯é€šè¿‡æ·˜å®çš„ JSONP æ¥å£æ¥åˆ¤æ–­ç”¨æˆ·æ˜¯å¦ç™»å½•çš„ã€‚</p><p>æœ‰æ—¶å®‰å…¨æ€§å’Œçµæ´»æ€§å°±æ˜¯çŸ›ç›¾çš„ï¼Œéœ€è¦å–èˆã€‚å…·ä½“åˆ¤æ–­å‚ç…§ä¸Šé¢è¡¨æ ¼è®¾ç½®ã€‚</p><h3 id="4-è§£å†³æ–¹æ¡ˆ"><a href="#4-è§£å†³æ–¹æ¡ˆ" class="headerlink" title="4. è§£å†³æ–¹æ¡ˆ"></a>4. è§£å†³æ–¹æ¡ˆ</h3><h4 id="4-1-æ–¹æ¡ˆ1"><a href="#4-1-æ–¹æ¡ˆ1" class="headerlink" title="4.1 æ–¹æ¡ˆ1"></a>4.1 æ–¹æ¡ˆ1</h4><ol><li>åœ¨chromeæµè§ˆå™¨åœ°å€æ è¾“å…¥<a href="chrome://flagså¹¶å›è½¦">chrome://flagså¹¶å›è½¦</a></li><li>åœ¨æœç´¢æ ä¸­è¾“å…¥SameSite by default cookiesæœç´¢ï¼Œå¹¶ç¦ç”¨å¦‚å›¾ä¸­çš„ä¸¤é¡¹è®¾ç½®ï¼Œæ”¹ä¸ºDisabledå³å¯</li><li>é‡å¯æµè§ˆå™¨</li></ol><h4 id="4-2-æ–¹æ¡ˆ2"><a href="#4-2-æ–¹æ¡ˆ2" class="headerlink" title="4.2 æ–¹æ¡ˆ2"></a>4.2 æ–¹æ¡ˆ2</h4><p>å¦‚æœä½¿ç”¨çš„æ˜¯ iframe æ–¹å¼æœ€å¥½è®¾ç½®<br>X-Frame-OptionsHTTP å“åº”æŠ¥å¤´å¯ä»¥è¢«ç”¨æ¥æŒ‡ç¤ºä¸€ä¸ªæµè§ˆå™¨æ˜¯å¦åº”è¯¥è¢«å…è®¸åœ¨ä¸€ä¸ªä»¥å‘ˆç°é¡µé¢ã€Šframeã€‹ï¼Œã€Šiframeã€‹æˆ–ã€Šobjectã€‹æ ‡ç­¾ã€‚é€šè¿‡ç¡®ä¿å…¶å†…å®¹æœªåµŒå…¥å…¶ä»–ç½‘ç«™ï¼Œç½‘ç«™å¯ä»¥ä½¿ç”¨æ­¤åŠŸèƒ½æ¥é¿å… ç‚¹å‡»åŠ«æŒ æ”»å‡»ã€‚</p><pre class="line-numbers language-language" data-language="language"><code class="language-language">apache é…ç½®Header always append X-Frame-Options DENYHeader set X-Frame-Options &quot;ALLOW-FROM https:&#x2F;&#x2F;example.com&#x2F;&quot;Header always edit Set-Cookie &quot;path&#x3D;&#x2F;&quot; &quot;path&#x3D;&#x2F;;  Secure; HttpOnly; SameSite&#x3D;None;&quot; #apache2.4 å®˜æ–¹æ–‡æ¡£#http:&#x2F;&#x2F;httpd.apache.org&#x2F;docs&#x2F;2.4&#x2F;mod&#x2F;mod_session_cookie.html#http:&#x2F;&#x2F;httpd.apache.org&#x2F;docs&#x2F;2.4&#x2F;mod&#x2F;mod_usertrack.htmlNginx é…ç½®add_header X-Frame-Options ALLOWALL; #å…è®¸æ‰€æœ‰åŸŸåiframeadd_header X-Frame-Options DENY; #ä¸å…è®¸ä»»ä½•åŸŸåiframe,åŒ…æ‹¬ç›¸åŒçš„åŸŸåadd_header X-Frame-Options SANEORIGIN; #å…è®¸ç›¸åŒåŸŸåiframe,å¦‚a.test.comå…è®¸b.test.comadd_header X-Frame-Options ALLOW-FROM uri; #å…è®¸æŒ‡å®šåŸŸåiframe å¤šä¸ªç”¨é€—å·åˆ†éš”# åªæ”¯æŒ proxy æ¨¡å¼ä¸‹è®¾ç½®proxy_cookie_path &#x2F; &quot;&#x2F;; httponly; secure; SameSite&#x3D;None&quot;;#http:&#x2F;&#x2F;nginx.org&#x2F;en&#x2F;docs&#x2F;http&#x2F;ngx_http_proxy_module.html#proxy_cookie_path<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Default </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Default </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
